{"version":3,"sources":["webpack://inspection-scheduler/./node_modules/@arcgis/core/views/layers/ImageryLayerView.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/2d/layers/imagery/ImageryGraphicsView2D.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/2d/layers/imagery/ImageryView2D.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/2d/layers/ImageryLayerView2D.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/layers/support/popupUtils.js"],"names":["m","c","super","arguments","this","view","e","o","layer","t","popupEnabled","a","popupTemplate","getRequiredFields","l","geometry","outFields","outSpatialReference","spatialReference","y","resolution","d","type","returnTopmostRaster","w","showNoDataRecords","f","layerOptions","h","returnDomainValues","pixelSize","queryVisibleRasters","then","canResume","timeExtent","isEmpty","prototype","dependsOn","container","_graphicsView","_graphics","_updateGraphics","stationary","i","state","r","xmin","extent","ymin","xmax","ymax","s","size","requestAsImageElement","signal","n","_getVectorFieldExportParams","width","height","fetchImage","renderer","_pixelData","pixelBlock","pixelData","getGraphicsFromPixelData","rasterInfo","dataType","update","set","updating","catch","error","suspended","toMap","attributes","graphics","requestUpdateCallback","requestUpdate","destroy","removeChild","addChild","updateRequested","fullExtent","p","symbolTileSize","Math","max","ceil","floor","x","_bitmapView","strategy","removeAllChildren","version","imageMaxHeight","imageMaxWidth","imageNormalizationSupported","fetchSource","_fetchImage","bind","updateExports","source","HTMLImageElement","requestRender","applyRenderer","filter","applyFilter","children","length","originalPixelBlock","map","intersects","imageElement","clone","imagery","_exportImageVersion","subview","getPixelData","hitTest","increaseRasterJobHandlerUsage","_setSubView","handles","add","watch","on","redraw","decreaseRasterJobHandlerUsage","remove","isUpdating","format","uninstall","attach","install","readOnly","async","fields","lastEditInfoEnabled","objectIdField","u","typeIdField","globalIdField","relationships","includes","push","indexOf","forEach","keyField","defaultPopupTemplateEnabled","defaultPopupTemplate"],"mappings":"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","file":"chunks/6685.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as o}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as t}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as p}from\"../../core/promiseUtils.js\";import i from\"../../geometry/Point.js\";import{combinedViewLayerTimeExtentProperty as a}from\"../../layers/support/commonProperties.js\";import u from\"../../tasks/support/Query.js\";import{getFetchPopupTemplate as n}from\"./support/popupUtils.js\";const m=m=>{let c=class extends m{constructor(){super(...arguments),this.view=null}async fetchPopupFeatures(e,o){const{layer:t}=this;if(!e)return p(new s(\"imagerylayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:t}));const{popupEnabled:a}=t,m=n(t,o);if(!a||!r(m))throw new s(\"imagerylayerview:fetchPopupFeatures\",\"Missing required popupTemplate or popupEnabled\",{popupEnabled:a,popupTemplate:m});const c=await m.getRequiredFields(),l=new u;l.geometry=e,l.outFields=c,l.outSpatialReference=e.spatialReference;const y=this.view.resolution,d=\"2d\"===this.view.type?new i(y,y,this.view.spatialReference):new i(.5*y,.5*y,this.view.spatialReference),{returnTopmostRaster:w,showNoDataRecords:f}=m.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1},h={returnDomainValues:!0,returnTopmostRaster:w,pixelSize:d,showNoDataRecords:f};return t.queryVisibleRasters(l,h).then((e=>e))}canResume(){var e;return!!super.canResume()&&(null==(e=this.timeExtent)||!e.isEmpty)}};return e([o()],c.prototype,\"layer\",void 0),e([o({dependsOn:[\"timeExtent\"]})],c.prototype,\"suspended\",void 0),e([o(a)],c.prototype,\"timeExtent\",void 0),e([o()],c.prototype,\"view\",void 0),c=e([t(\"esri.views.layers.ImageryLayerView\")],c),c};export{m as ImageryLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import t from\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as i}from\"../../../../core/accessorSupport/decorators/property.js\";import{enumeration as r}from\"../../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import{debounce as a,isAbortError as o,resolve as n,after as p}from\"../../../../core/promiseUtils.js\";import h from\"../../../../geometry/Extent.js\";import{createScreenPoint as c}from\"../../../../core/screenUtils.js\";import l from\"../../../../Graphic.js\";import m from\"../../../../support/GraphicsCollection.js\";import d from\"../../../layers/LayerView.js\";import{Container as u}from\"../../engine/Container.js\";import x from\"../graphics/GraphicsView2D.js\";import{LayerView2DMixin as g}from\"../LayerView2D.js\";const y=t.getLogger(\"esri.views.2d.layers.imagery.ImageryGraphicsView2D\");let w=class extends(g(d)){constructor(){super(...arguments),this.container=new u,this._graphicsView=null,this.type=\"Graphics\",this._graphics=new m,this._updateGraphics=a((async(e,t)=>{if(!e.stationary)return;const i=e.state,r=new h({xmin:i.extent.xmin,ymin:i.extent.ymin,xmax:i.extent.xmax,ymax:i.extent.ymax,spatialReference:i.spatialReference}),s=e.state.size[0],a=e.state.size[1],o={};o.timeExtent=this.timeExtent,o.requestAsImageElement=!1,o.signal=t;const n=this._getVectorFieldExportParams({extent:r,width:s,height:a}),c=await this.layer.fetchImage(n.extent,n.width,n.height,o),l=this.layer.renderer;if(\"vector-field\"===l.type){this._pixelData={extent:n.extent,pixelBlock:c.pixelData.pixelBlock};const t=await l.getGraphicsFromPixelData(c.pixelData,\"vector-uv\"===this.layer.rasterInfo.dataType);this._graphicsView.update(e),await p(0).then((()=>{this._graphics.set(\"items\",t)}))}}))}get updating(){var e;return null==(e=this._graphicsView)?void 0:e.updating}update(e){this._updateGraphics(e).catch((e=>{o(e)||y.error(e)}))}hitTest(e,t){if(this.suspended)return n(null);const i=this.view.toMap(c(e,t));return n(new l({attributes:{},geometry:i,layer:this.layer}))}attach(){this._graphicsView=new x({view:this.view,graphics:this._graphics,requestUpdateCallback:()=>this.requestUpdate()})}detach(){this._graphics.destroy(),this._graphicsView.destroy(),this.container.removeChild(this._graphicsView.container),this._graphicsView=null}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._graphicsView.container),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._graphicsView.container),e.removeChild(this.container)}isUpdating(){return this._graphicsView.updating||this.updateRequested}getPixelData(){return this.updating?null:this._pixelData}redraw(){}_getVectorFieldExportParams(e){var t,i;let{extent:r,width:s,height:a}=e;const o=this.layer,n=null==(t=o.fullExtent)?void 0:t.xmin,p=null==(i=o.fullExtent)?void 0:i.ymax;let h;\"vector-field\"===o.renderer.type&&(h=o.renderer.symbolTileSize),h=Math.max(h||0,30),s=Math.ceil(s*(1/h)),a=Math.ceil(a*(1/h));const c=(r.xmax-r.xmin)/s,l=(r.ymax-r.ymin)/a;return r.xmin=n+Math.floor((r.xmin-n)/c)*c,r.xmax=n+Math.ceil((r.xmax-n)/c)*c,r.ymin=p+Math.floor((r.ymin-p)/l)*l,r.ymax=p+Math.ceil((r.ymax-p)/l)*l,{extent:r,width:s,height:a}}};e([i()],w.prototype,\"container\",void 0),e([i()],w.prototype,\"layer\",void 0),e([i()],w.prototype,\"timeExtent\",void 0),e([i({dependsOn:[\"_graphicsView.updating\"]})],w.prototype,\"updating\",null),e([i()],w.prototype,\"_graphicsView\",void 0),e([r({graphics:\"Graphics\"})],w.prototype,\"type\",void 0),w=e([s(\"esri.views.2d.layers.imagery.ImageryGraphicsView2D\")],w);var f=w;export default f;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../../chunks/tslib.es6.js\";import\"../../../../core/has.js\";import t from\"../../../../core/Logger.js\";import\"../../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../../core/accessorSupport/decorators/property.js\";import{enumeration as i}from\"../../../../core/accessorSupport/decorators/enumeration.js\";import{subclass as s}from\"../../../../core/accessorSupport/decorators/subclass.js\";import\"../../../../core/urlUtils.js\";import\"../../../../core/uuid.js\";import\"../../../../portal/support/resourceExtension.js\";import{isAbortError as o,resolve as a}from\"../../../../core/promiseUtils.js\";import{createScreenPoint as n}from\"../../../../core/screenUtils.js\";import p from\"../../../../Graphic.js\";import{mosaicPixelData as l}from\"../../../../layers/support/rasterFunctions/pixelUtils.js\";import m from\"../../../layers/LayerView.js\";import{Container as c}from\"../../engine/Container.js\";import h from\"../../engine/ImageryBitmapSource.js\";import{BitmapContainer as u}from\"../../engine/BitmapContainer.js\";import{LayerView2DMixin as g}from\"../LayerView2D.js\";import d from\"../support/ExportStrategy.js\";const y=t.getLogger(\"esri.views.2d.layers.imagery.ImageryView2D\");let x=class extends(g(m)){constructor(){super(...arguments),this.container=new c,this.type=\"Imagery\",this._bitmapView=null}get updating(){var e;return null==(e=this.strategy)?void 0:e.updating}update(e){this.strategy.update(e).catch((e=>{o(e)||y.error(e)}))}detach(){this.strategy.destroy(),this._bitmapView.removeAllChildren(),this.container.removeAllChildren()}hitTest(e,t){if(this.suspended)return a(null);const r=this.view.toMap(n(e,t));return a(new p({attributes:{},geometry:r,layer:this.layer}))}attach(){const e=this.layer.version>=10,t=this.layer.version>=10.1?this.layer.imageMaxHeight:2048,r=this.layer.version>=10.1?this.layer.imageMaxWidth:2048;this._bitmapView=new u,this.strategy=new d({container:this._bitmapView,imageNormalizationSupported:e,imageMaxHeight:t,imageMaxWidth:r,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})}moveStart(){}viewChange(){}moveEnd(){}install(e){this.container.addChild(this._bitmapView),e.addChild(this.container)}uninstall(e){this.container.removeChild(this._bitmapView),e.removeChild(this.container)}redraw(){this.strategy.updateExports((e=>{e.source instanceof HTMLImageElement?e.requestRender():this.layer.applyRenderer({pixelBlock:e.source.pixelBlock}).then((t=>{const r=e.source;r.pixelBlock=t.pixelBlock,r.filter=e=>this.layer.applyFilter(e),this.container.requestRender()}))}))}isUpdating(){return this.strategy.updating||this.updateRequested}getPixelData(){if(this.updating)return null;const e=this.strategy.container.children;if(1===e.length&&e[0].source)return{extent:e[0].source.extent,pixelBlock:e[0].source.originalPixelBlock};if(e.length>1){const t=this.view.extent,r=e.map((e=>e.source)).filter((e=>e.extent&&e.extent.intersects(t))).map((e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}))),i=l(r,t);return i?{extent:i.extent,pixelBlock:i.pixelBlock}:null}return null}_fetchImage(e,t,r,i){return(i=i||{}).timeExtent=this.timeExtent,i.requestAsImageElement=!0,this.layer.fetchImage(e,t,r,i).then((e=>e.imageElement?e.imageElement:this.layer.applyRenderer(e.pixelData,{signal:i.signal}).then((t=>{const r=new h(t.pixelBlock,t.extent.clone(),e.pixelData.pixelBlock);return r.filter=e=>this.layer.applyFilter(e),r}))))}};e([r()],x.prototype,\"container\",void 0),e([r()],x.prototype,\"layer\",void 0),e([r()],x.prototype,\"strategy\",void 0),e([r()],x.prototype,\"timeExtent\",void 0),e([r({dependsOn:[\"strategy.updating\"]})],x.prototype,\"updating\",null),e([i({imagery:\"Imagery\"})],x.prototype,\"type\",void 0),x=e([s(\"esri.views.2d.layers.imagery.ImageryView2D\")],x);var f=x;export default f;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{resolve as r}from\"../../../core/promiseUtils.js\";import{init as i,watch as a}from\"../../../core/watchUtils.js\";import{RefreshableLayerView as o}from\"../../layers/RefreshableLayerView.js\";import p from\"../../layers/LayerView.js\";import{ImageryLayerView as u}from\"../../layers/ImageryLayerView.js\";import{LayerView2DMixin as h}from\"./LayerView2D.js\";import n from\"./imagery/ImageryGraphicsView2D.js\";import l from\"./imagery/ImageryView2D.js\";let m=class extends(u(o(h(p)))){constructor(){super(...arguments),this._exportImageVersion=-1}get pixelData(){return this.updating?null:this.subview.getPixelData()}get updating(){return!(this.subview&&!this.subview.updating)}hitTest(e,t){return this.suspended||!this.subview?r(null):this.subview.hitTest(e,t)}update(e){var t;null==(t=this.subview)||t.update(e)}attach(){this.layer.increaseRasterJobHandlerUsage(),this._setSubView(),this.handles.add([i(this,\"layer.exportImageServiceParameters.version\",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),this.watch(\"timeExtent\",(()=>{this.subview.timeExtent=this.timeExtent,this.requestUpdate()})),this.layer.on(\"redraw\",(()=>this.subview.redraw())),a(this.layer,\"renderer\",(()=>this._setSubView()))],\"imagerylayerview-update\")}detach(){this.layer.decreaseRasterJobHandlerUsage(),this.subview.destroy(),this.handles.remove(\"imagerylayerview-update\"),this._exportImageVersion=-1}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}async doRefresh(){this.requestUpdate()}isUpdating(){return!this.subview||this.subview.isUpdating()}_setSubView(){var e;let t=\"Imagery\";var s,r;(\"vector-field\"===(null==(e=this.layer.renderer)?void 0:e.type)&&\"lerc\"===this.layer.format&&(t=\"Graphics\"),this.subview&&this.subview.type===t)||(null==(s=this.subview)||s.uninstall(this.container),null==(r=this.subview)||r.destroy(),this.subview=\"Imagery\"===t?new l({layer:this.layer,view:this.view}):new n({layer:this.layer,view:this.view}),this.subview.attach(),this.subview.install(this.container));this.requestUpdate()}};e([t({dependsOn:[\"updating\"]})],m.prototype,\"pixelData\",null),e([t({readOnly:!0,dependsOn:[\"subview.updating\"]})],m.prototype,\"updating\",null),e([t()],m.prototype,\"subview\",void 0),m=e([s(\"esri.views.2d.layers.ImageryLayerView2D\")],m);var d=m;export default d;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n"],"sourceRoot":""}