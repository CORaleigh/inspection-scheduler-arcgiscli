{"version":3,"sources":["webpack://inspection-scheduler/./node_modules/@arcgis/core/views/2d/layers/WMTSLayerView2D.js"],"names":["f","d","super","arguments","this","_handles","_tileStrategy","_fetchQueue","_tileRequests","Map","layer","activeLayer","tileMatrixSetId","tileMatrixSet","e","_getTileMatrixSetBySpatialReference","id","pause","state","update","resume","notifyChange","t","i","tileInfo","spatialReference","s","fullExtent","clone","isWebMercator","isWGS84","_tileInfoView","tileInfoView","process","fetchTile","cachePolicy","acquireTile","releaseTile","add","watch","_refresh","attach","detach","removeAll","destroy","clear","requestUpdate","updateRequested","suspended","length","_bitmapView","createTile","bitmap","x","y","getTileCoords","key","resolution","getTileResolution","width","height","size","r","fulfilled","promise","push","then","source","once","addChild","catch","finally","set","get","abort","delete","removeChild","level","row","col","canResume","reset","tiles","forEach","requestRender","view","tileMatrixSets","find","wkid","indexOf","dependsOn","prototype","readOnly"],"mappings":"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","file":"chunks/8282.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{geographicToWebMercator as r}from\"../../../geometry/support/webMercatorUtils.js\";import l from\"../../../core/Handles.js\";import{RefreshableLayerView as a}from\"../../layers/RefreshableLayerView.js\";import o from\"../tiling/TileInfoView.js\";import h from\"../tiling/TileQueue.js\";import n from\"../tiling/TileStrategy.js\";import u from\"../../layers/LayerView.js\";import{LayerView2DMixin as c}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as p}from\"./BitmapTileLayerView2D.js\";const f=[102113,102100,3857,3785,900913];let d=class extends(a(p(c(u)))){constructor(){super(...arguments),this._handles=new l,this._tileStrategy=null,this._fetchQueue=null,this._tileRequests=new Map,this.layer=null}get tileMatrixSet(){if(this.layer.activeLayer.tileMatrixSetId)return this.layer.activeLayer.tileMatrixSet;const e=this._getTileMatrixSetBySpatialReference(this.layer.activeLayer);return e?(this.layer.activeLayer.tileMatrixSetId=e.id,e):null}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=this.layer.activeLayer,t=this.tileMatrixSet;if(!t)return;const i=t.tileInfo.spatialReference;let s=e.fullExtent&&e.fullExtent.clone();i.isWebMercator?s=r(s):i.isWGS84||(s=t.fullExtent),this._tileInfoView=new o(t.tileInfo,s),this._fetchQueue=new h({tileInfoView:this._tileInfoView,process:e=>this.fetchTile(e)}),this._tileStrategy=new n({cachePolicy:\"keep\",acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this._handles.add(this.watch([\"layer.activeLayer.styleId\",\"tileMatrixSet\"],(()=>this._refresh()))),super.attach()}detach(){super.detach(),this._handles.removeAll(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}async doRefresh(){this.updateRequested||this.suspended||this._refresh()}isUpdating(){return this._fetchQueue.length>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;[i.x,i.y]=this._tileInfoView.getTileCoords([0,0],t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._tileInfoView.getTileCoords(i,t.key);const r={id:e.id,fulfilled:!1,promise:this._fetchQueue.push(t.key).then((e=>{t.bitmap.source=e,t.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(t)})).catch((e=>{s(e)||(t.bitmap.source=null,t.once(\"attach\",(()=>this.requestUpdate())),this._bitmapView.addChild(t))}))};return r.promise.finally((()=>r.fulfilled=!0)),this._tileRequests.set(t,r),this.requestUpdate(),t}releaseTile(e){const t=this._tileRequests.get(e);t.fulfilled||this._fetchQueue.abort(t.id),this._tileRequests.delete(e),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e){return this.layer.fetchTile(e.level,e.row,e.col)}canResume(){const e=super.canResume();return e?null!==this.tileMatrixSet:e}_refresh(){this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>{if(!e.bitmap.source)return;e.bitmap.source=null;const t={id:e.key.id,fulfilled:!1,promise:this._fetchQueue.push(e.key).then((t=>{e.bitmap.source=t,e.requestRender(),this.notifyChange(\"updating\")}))};t.promise.then((()=>t.fulfilled=!0),(()=>t.fulfilled=!0)),this._tileRequests.set(e,t)})),this.notifyChange(\"updating\")}_getTileMatrixSetBySpatialReference(e){const t=this.view.spatialReference;if(!e.tileMatrixSets)return null;let i=e.tileMatrixSets.find((e=>e.tileInfo.spatialReference.wkid===t.wkid));return!i&&t.isWebMercator&&(i=e.tileMatrixSets.find((e=>f.indexOf(e.tileInfo.spatialReference.wkid)>-1))),i}};e([t({dependsOn:[\"tileMatrixSet\"]})],d.prototype,\"suspended\",void 0),e([t({readOnly:!0,dependsOn:[\"view.spatialReference\",\"layer.activeLayer\"]})],d.prototype,\"tileMatrixSet\",null),d=e([i(\"esri.views.2d.layers.WMTSLayerView2D\")],d);var m=d;export default m;\n"],"sourceRoot":""}