{"version":3,"sources":["webpack://inspection-scheduler/./node_modules/@arcgis/core/geometry/support/scaleUtils.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/layers/MapImageLayer.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/layers/support/ExportImageParameters.js"],"names":["e","r","i","extent","o","width","c","spatialReference","U","super","this","alwaysRefetch","dpi","gdbVersion","imageFormat","imageMaxHeight","imageMaxWidth","imageTransparency","labelsVisible","isReference","operationalLayerType","sourceJSON","sublayers","type","url","t","signal","addResolvingPromise","loadFromPortal","supportedTypes","then","_fetchService","supportedImageFormatTypes","indexOf","s","loaded","slice","reverse","flatten","toArray","capabilities","operations","supportsExportMap","exportMap","supportsDynamicLayers","origin","createSublayersForOrigin","a","p","writeSublayerStructure","n","forEach","write","push","originOf","some","Object","keys","length","layers","visibleLayers","filter","visible","map","id","pixelRatio","version","clone","shiftCentralMeridian","layer","scale","toJSON","destroy","rotation","m","wkid","JSON","stringify","l","timeExtent","start","end","time","timeInfo","hasLiveData","bbox","xmin","ymin","xmax","ymax","bboxSR","imageSR","size","responseType","timestamp","query","_ts","customParameters","parsedUrl","path","createExportImageParameters","f","Date","now","dynamicLayers","data","catch","error","returnUpdates","fullExtent","allSublayers","read","ssl","replace","prototype","json","origins","service","source","Boolean","enabled","overridePolicy","ignoreOrigin","readOnly","value","definitionExpression","labelingInfo","opacity","minScale","maxScale","renderer","y","arguments","_scale","view","hasDynamicLayers","visibleSublayers","toExportImageJSON","serviceSublayers","_get","_set","handles","remove","add","on","notifyChange","propertyName","join","reduce","layerDefs","unshift","format","transparent","dependsOn","Number"],"mappings":"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","file":"chunks/2933.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{getMetersPerUnitForSR as t,inchesPerMeter as n}from\"../../core/unitUtils.js\";function e(e,r){const i=r||e.extent,o=e.width,c=t(i&&i.spatialReference);return i&&o?i.width/o*c*n*96:0}function r(e,r){return e/(t(r)*n*96)}function i(e,r){return e*(t(r)*n*96)}function o(t,n){const e=t.extent,i=t.width,o=r(n,e.spatialReference);return e.clone().expand(o*i/e.width)}export{o as getExtentForScale,r as getResolutionForScale,e as getScale,i as getScaleForResolution};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../chunks/tslib.es6.js\";import\"../core/has.js\";import{isSome as r}from\"../core/maybe.js\";import\"../core/Logger.js\";import{Integer as t}from\"../core/accessorSupport/ensureType.js\";import{property as s}from\"../core/accessorSupport/decorators/property.js\";import{reader as o}from\"../core/accessorSupport/decorators/reader.js\";import{subclass as i}from\"../core/accessorSupport/decorators/subclass.js\";import{writer as a}from\"../core/accessorSupport/decorators/writer.js\";import p from\"../core/Error.js\";import\"../core/urlUtils.js\";import\"../core/uuid.js\";import{nameToId as m}from\"../core/accessorSupport/PropertyOrigin.js\";import\"../portal/support/resourceExtension.js\";import{resolve as n,reject as l,isAbortError as c}from\"../core/promiseUtils.js\";import u from\"../geometry/Extent.js\";import y from\"../request.js\";import{loadAll as h}from\"../core/loadAll.js\";import d from\"./Layer.js\";import f from\"../TimeExtent.js\";import{MultiOriginJSONMixin as g}from\"../core/MultiOriginJSONSupport.js\";import{url as j}from\"./support/commonProperties.js\";import{OperationalLayer as b}from\"./mixins/OperationalLayer.js\";import{ArcGISService as x}from\"./mixins/ArcGISService.js\";import{BlendLayer as v}from\"./mixins/BlendLayer.js\";import{CustomParametersMixin as S}from\"./mixins/CustomParametersMixin.js\";import{PortalLayer as w}from\"./mixins/PortalLayer.js\";import{RefreshableLayer as O}from\"./mixins/RefreshableLayer.js\";import{ScaleRangeLayer as L}from\"./mixins/ScaleRangeLayer.js\";import{TemporalLayer as E}from\"./mixins/TemporalLayer.js\";import{HandleOwnerMixin as I}from\"../core/HandleOwner.js\";import{getScale as M}from\"../geometry/support/scaleUtils.js\";import{ArcGISMapService as q}from\"./mixins/ArcGISMapService.js\";import P from\"./support/Sublayer.js\";import{shouldWriteSublayerStructure as N}from\"./support/sublayerUtils.js\";import{SublayersOwner as R}from\"./mixins/SublayersOwner.js\";import{ExportImageParameters as J}from\"./support/ExportImageParameters.js\";let U=class extends(v(E(L(O(R(q(x(b(w(g(S(I(d))))))))))))){constructor(...e){super(...e),this.alwaysRefetch=!1,this.dpi=96,this.gdbVersion=null,this.imageFormat=\"png24\",this.imageMaxHeight=2048,this.imageMaxWidth=2048,this.imageTransparency=!0,this.labelsVisible=!1,this.isReference=null,this.operationalLayerType=\"ArcGISMapServiceLayer\",this.sourceJSON=null,this.sublayers=null,this.type=\"map-image\",this.url=null}normalizeCtorArgs(e,r){return\"string\"==typeof e?{url:e,...r}:e}load(e){const t=r(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:[\"Map Service\"]},e).then((()=>this._fetchService(t)),(()=>this._fetchService(t)))),n(this)}readImageFormat(e,r){const t=r.supportedImageFormatTypes;return t&&t.indexOf(\"PNG32\")>-1?\"png32\":\"png24\"}writeSublayers(e,r,t,s){if(!this.loaded||!e)return;const o=e.slice().reverse().flatten((({sublayers:e})=>e&&e.toArray().reverse())).toArray();let i=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap.supportsDynamicLayers){const e=m(s.origin);if(3===e){const e=this.createSublayersForOrigin(\"service\").sublayers;i=N(o,e,2)}else if(e>3){const e=this.createSublayersForOrigin(\"portal-item\");i=N(o,e.sublayers,m(e.origin))}}const a=[],p={writeSublayerStructure:i,...s};let n=i;o.forEach((e=>{const r=e.write({},p);a.push(r),n=n||\"user\"===e.originOf(\"visible\")}));a.some((e=>Object.keys(e).length>1))&&(r.layers=a),n&&(r.visibleLayers=o.filter((e=>e.visible)).map((e=>e.id)))}createExportImageParameters(e,r,t,s){const o=s&&s.pixelRatio||1;e&&this.version>=10&&(e=e.clone().shiftCentralMeridian());const i=new J({layer:this,scale:M({extent:e,width:r})*o}),a=i.toJSON();i.destroy();const p=!s||!s.rotation||this.version<10.3?{}:{rotation:-s.rotation},m=e&&e.spatialReference,n=m.wkid||JSON.stringify(m.toJSON());a.dpi*=o;const l={};if(null!=s&&s.timeExtent){const{start:e,end:r}=s.timeExtent.toJSON();l.time=e&&r&&e===r?\"\"+e:`${null==e?\"null\":e},${null==r?\"null\":r}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(l.time=\"null,null\");return{bbox:e&&e.xmin+\",\"+e.ymin+\",\"+e.xmax+\",\"+e.ymax,bboxSR:n,imageSR:n,size:r+\",\"+t,...a,...p,...l}}async fetchImage(e,r,t,s){const o={responseType:\"image\"};s&&s.timestamp&&(o.query={...o.query,_ts:s.timestamp}),s&&s.signal&&(o.signal=s.signal),this.customParameters&&Object.keys(this.customParameters).length&&(o.query={...this.customParameters,...o.query});const i=this.parsedUrl.path+\"/export\",a={...this.parsedUrl.query,...this.createExportImageParameters(e,r,t,s),f:\"image\",_ts:this.alwaysRefetch?Date.now():null};if(null!=a.dynamicLayers&&!this.capabilities.exportMap.supportsDynamicLayers)return l(new p(\"mapimagelayer:dynamiclayer-not-supported\",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:a}));o.query?o.query={...a,...o.query}:o.query=a;return y(i,o).then((e=>e.data)).catch((e=>{if(c(e))throw e;throw new p(\"mapimagelayer:image-fetch-error\",`Unable to load image: ${i}`,{error:e})}))}async fetchRecomputedExtents(e={}){const r={...e,query:{returnUpdates:!0,f:\"json\"}},{data:t}=await y(this.url,r),{extent:s,fullExtent:o,timeExtent:i}=t,a=s||o;return{fullExtent:a&&u.fromJSON(a),timeExtent:i&&f.fromJSON({start:i[0],end:i[1]})}}loadAll(){return h(this,(e=>{e(this.allSublayers)}))}async _fetchService(e){if(this.sourceJSON)return void this.read(this.sourceJSON,{origin:\"service\",url:this.parsedUrl});const{data:r,ssl:t}=await y(this.parsedUrl.path,{query:{f:\"json\",...this.parsedUrl.query,...this.customParameters},signal:e});t&&(this.url=this.url.replace(/^http:/i,\"https:\")),this.sourceJSON=r,this.read(r,{origin:\"service\",url:this.parsedUrl})}};e([s()],U.prototype,\"alwaysRefetch\",void 0),e([s()],U.prototype,\"dpi\",void 0),e([s()],U.prototype,\"gdbVersion\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"popupEnabled\",void 0),e([s()],U.prototype,\"imageFormat\",void 0),e([o(\"imageFormat\",[\"supportedImageFormatTypes\"])],U.prototype,\"readImageFormat\",null),e([s({json:{origins:{service:{read:{source:\"maxImageHeight\"}}}}})],U.prototype,\"imageMaxHeight\",void 0),e([s({json:{origins:{service:{read:{source:\"maxImageWidth\"}}}}})],U.prototype,\"imageMaxWidth\",void 0),e([s()],U.prototype,\"imageTransparency\",void 0),e([s({json:{read:!1,write:!1}})],U.prototype,\"labelsVisible\",void 0),e([s({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],U.prototype,\"isReference\",void 0),e([s({type:[\"ArcGISMapServiceLayer\"]})],U.prototype,\"operationalLayerType\",void 0),e([s()],U.prototype,\"sourceJSON\",void 0),e([s({json:{write:{ignoreOrigin:!0}}})],U.prototype,\"sublayers\",void 0),e([a(\"sublayers\",{layers:{type:[P]},visibleLayers:{type:[t]}})],U.prototype,\"writeSublayers\",null),e([s({type:[\"show\",\"hide\",\"hide-children\"]})],U.prototype,\"listMode\",void 0),e([s({json:{read:!1},readOnly:!0,value:\"map-image\"})],U.prototype,\"type\",void 0),e([s(j)],U.prototype,\"url\",void 0),U=e([i(\"esri.layers.MapImageLayer\")],U);var T=U;export default T;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import i from\"../../core/Accessor.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{HandleOwnerMixin as t}from\"../../core/HandleOwner.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import n from\"../../views/View.js\";const o={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let y=class extends(t(i)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(o[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,s)=>(e[s.id]=s.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange(\"scale\"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const s=e.layer;return s&&(s.dpi,s.imageFormat,s.imageTransparency,s.gdbVersion),(this._get(\"version\")||0)+1}set version(e){this._set(\"version\",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const s=this.layer.sublayers,r=s=>{const i=this.scale,a=0===i,t=0===s.minScale||i<=s.minScale,l=0===s.maxScale||i>=s.maxScale;s.visible&&(a||t&&l)&&(s.sublayers?s.sublayers.forEach(r):e.unshift(s))};s&&s.forEach(r);const i=this._get(\"visibleSublayers\");return!i||i.length!==e.length||i.some(((s,r)=>e[r]!==s))?e:i}toJSON(){const e=this.layer;let s={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?s.dynamicLayers=this.dynamicLayers:s={...s,layers:this.layers,layerDefs:this.layerDefs},s}};e([s({readOnly:!0,dependsOn:[\"hasDynamicLayers\",\"visibleSublayers\"]})],y.prototype,\"dynamicLayers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\",\"layer.serviceSublayers\",\"layer.capabilities\"]})],y.prototype,\"hasDynamicLayers\",null),e([s()],y.prototype,\"layer\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layerDefs\",null),e([s({type:Number,dependsOn:[\"view.scale\"]})],y.prototype,\"scale\",null),e([s(a)],y.prototype,\"timeExtent\",void 0),e([s({dependsOn:[\"layers\",\"layerDefs\",\"dynamicLayers\",\"layer.dpi\",\"layer.imageFormat\",\"layer.imageTransparency\",\"layer.gdbVersion\",\"timeExtent\"]})],y.prototype,\"version\",null),e([s({type:n})],y.prototype,\"view\",void 0),e([s({readOnly:!0,dependsOn:[\"layer.sublayers\",\"scale\"]})],y.prototype,\"visibleSublayers\",null),y=e([r(\"esri.layers.mixins.ExportImageParameters\")],y);export{y as ExportImageParameters};\n"],"sourceRoot":""}