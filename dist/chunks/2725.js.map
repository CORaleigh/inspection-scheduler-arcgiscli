{"version":3,"sources":["webpack://inspection-scheduler/./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/layers/TileLayerView.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/2d/layers/TileLayerView2D.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/support/drapedUtils.js"],"names":["t","e","xoffset","Math","max","abs","yoffset","stops","length","n","r","s","size","renderer","event","pointerType","o","filter","type","map","maxSize","minSize","f","floor","visualVariables","symbol","uniqueValueInfos","forEach","classBreakInfos","c","l","layer","this","get","allSublayers","toArray","minScale","maxScale","popupTemplate","popupEnabled","visible","async","createQuery","p","a","geometry","createFetchPopupFeaturesQueryGeometry","outFields","getRequiredFields","queryFeatures","features","then","concat","value","Boolean","prototype","w","_","I","y","super","arguments","_tileStrategy","_fetchQueue","tileInfo","spatialReference","i","equals","view","watch","refresh","addResolvingPromise","resampling","pause","state","update","resume","notifyChange","tileServers","_tileInfoView","fullExtent","tileInfoView","concurrency","process","fetchTile","cachePolicy","acquireTile","releaseTile","requestUpdate","container","requestRender","attach","detach","destroy","clear","removeAllChildren","updateRequested","suspended","reset","tiles","_enqueueTileFetch","_bitmapView","createTile","bitmap","x","getTileCoords","key","resolution","getTileResolution","width","height","addChild","abort","id","removeChild","once","tilemapCache","signal","_fetchImage","_createBlankImage","fetchAvailabilityUpsample","level","row","col","h","u","_resampleImage","has","push","source","error","timestamp","refreshTimestamp","getLODInfoAt","getXForColumn","getYForRow","m","g","round","d","getContext","drawImage","document","createElement","dependsOn","overlayPixelSizeInMapUnits","basemapSpatialReference","xmin","min","ymin","xmax","ymax"],"mappings":"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","file":"chunks/2725.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t,e){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}(t.stops):e}function n(n){const r=n&&n.renderer,s=\"touch\"===(n&&n.event&&n.event.pointerType)?9:6;if(!r)return s;const o=\"visualVariables\"in r?function(t,n){if(!n)return t;const r=n.filter((t=>\"size\"===t.type)).map((n=>{const{maxSize:r,minSize:s}=n;return(e(r,t)+e(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let t=0;t<o;t++)s+=r[t];const f=Math.floor(s/o);return Math.max(f,t)}(s,r.visualVariables):s;if(\"simple\"===r.type)return t(o,r.symbol);if(\"unique-value\"===r.type){let e=o;return r.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===r.type){let e=o;return r.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return r.type,o}export{n as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as o}from\"../../core/accessorSupport/decorators/subclass.js\";import s from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as p,eachAlways as a}from\"../../core/promiseUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";const c=c=>{let l=class extends c{async fetchPopupFeatures(e,t){const{layer:o}=this;if(!e)return p(new s(\"tilelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:o}));if(\"tile\"!==o.type)return p(new s(\"tilelayerview:fetchPopupFeatures\",\"Layer type should be 'tile'\",{type:o.type}));const c=this.get(\"view.scale\"),l=o.allSublayers.toArray().filter((e=>{const r=0===e.minScale||c<=e.minScale,t=0===e.maxScale||c>=e.maxScale;return e.popupTemplate&&e.popupEnabled&&e.visible&&r&&t}));return a(l.map((async o=>{const s=o.createQuery(),p=r(t)?t.event:null,a=i({renderer:o.renderer,event:p});s.geometry=this.createFetchPopupFeaturesQueryGeometry(e,a),s.outFields=await o.popupTemplate.getRequiredFields();return(await o.queryFeatures(s)).features}))).then((e=>[].concat(...e.map((e=>e.value)).filter(Boolean))))}};return e([t()],l.prototype,\"layer\",void 0),l=e([o(\"esri.layers.mixins.TileLayerView\")],l),l};export{c as TileLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import{isNone as t}from\"../../../core/maybe.js\";import i from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../../core/accessorSupport/decorators/subclass.js\";import a from\"../../../core/Error.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{reject as l,isAbortError as o}from\"../../../core/promiseUtils.js\";import{RefreshableLayerView as h}from\"../../layers/RefreshableLayerView.js\";import n from\"../tiling/TileKey.js\";import c from\"../tiling/TileInfoView.js\";import u from\"../tiling/TileQueue.js\";import p from\"../tiling/TileStrategy.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as f}from\"../../support/drapedUtils.js\";import{TileLayerView as g}from\"../../layers/TileLayerView.js\";import{LayerView2DMixin as y}from\"./LayerView2D.js\";import{BitmapTileLayerView2D as d}from\"./BitmapTileLayerView2D.js\";const w=i.getLogger(\"esri.views.2d.layers.TileLayerView2D\"),_=[0,0];let I=class extends(g(h(d(y(m))))){constructor(){super(...arguments),this._tileStrategy=null,this._fetchQueue=null,this.layer=null}initialize(){const e=this.layer.tileInfo,t=e&&e.spatialReference;let i;t||(i=new a(\"layerview:tiling-information-missing\",\"The layer doesn't provide tiling information\",{layer:this.layer})),t.equals(this.view.spatialReference)||(i=new a(\"layerview:spatial-reference-incompatible\",\"The spatial reference of this layer does not meet the requirements of the view\",{layer:this.layer})),this.watch(\"resampling\",(()=>{this.refresh()})),i&&this.addResolvingPromise(l(i))}get resampling(){return!(\"resampling\"in this.layer)||!1!==this.layer.resampling}hitTest(){return null}update(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume(),this.notifyChange(\"updating\")}attach(){const e=\"tileServers\"in this.layer?this.layer.tileServers:null;this._tileInfoView=new c(this.layer.tileInfo,this.layer.fullExtent),this._fetchQueue=new u({tileInfoView:this._tileInfoView,concurrency:e&&10*e.length||10,process:(e,t)=>this.fetchTile(e,t)}),this._tileStrategy=new p({cachePolicy:\"keep\",resampling:this.resampling,acquireTile:e=>this.acquireTile(e),releaseTile:e=>this.releaseTile(e),tileInfoView:this._tileInfoView}),this.requestUpdate(),this.container.requestRender(),super.attach()}detach(){super.detach(),this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null}moveStart(){this.requestUpdate()}viewChange(){this.requestUpdate()}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return f(e,t,this.view)}async doRefresh(){this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach((e=>this._enqueueTileFetch(e))),this.notifyChange(\"updating\"))}isUpdating(){var e;return(null==(e=this._fetchQueue)?void 0:e.length)>0}acquireTile(e){const t=this._bitmapView.createTile(e),i=t.bitmap;return[i.x,i.y]=this._tileInfoView.getTileCoords(_,t.key),i.resolution=this._tileInfoView.getTileResolution(t.key),[i.width,i.height]=this._tileInfoView.tileInfo.size,this._enqueueTileFetch(t),this._bitmapView.addChild(t),this.requestUpdate(),t}releaseTile(e){this._fetchQueue.abort(e.key.id),this._bitmapView.removeChild(e),e.once(\"detach\",(()=>e.destroy())),this.requestUpdate()}async fetchTile(e,i){const r=\"tilemapCache\"in this.layer?this.layer.tilemapCache:null,s=!t(i)&&i.signal;if(!r)try{return await this._fetchImage(e,s)}catch(e){if(!o(e)&&!this.resampling)return this._createBlankImage();throw e}const a=new n(0,0,0,0);let l;try{if(await r.fetchAvailabilityUpsample(e.level,e.row,e.col,a,{signal:s}),a.level!==e.level&&!this.resampling)return this._createBlankImage();l=await this._fetchImage(a,s)}catch(t){if(o(t))throw t;l=await this._fetchImage(e,s)}const{level:h,row:c,col:u}=a;return this.resampling&&h!==e.level?this._resampleImage(l,h,c,u,e.level,e.row,e.col):l}async _enqueueTileFetch(e){if(!this._fetchQueue.has(e.key.id)){try{const t=await this._fetchQueue.push(e.key);e.bitmap.source=t,e.bitmap.width=this._tileInfoView.tileInfo.size[0],e.bitmap.height=this._tileInfoView.tileInfo.size[1],e.once(\"attach\",(()=>this.requestUpdate()))}catch(e){o(e)||w.error(e)}this.requestUpdate()}}async _fetchImage(e,t){return this.layer.fetchTile(e.level,e.row,e.col,{timestamp:this.refreshTimestamp,signal:t})}_resampleImage(e,t,i,r,s,a,l){const o=this._tileInfoView.tileInfo.size,h=this._tileInfoView.getTileResolution(t),n=this._tileInfoView.getTileResolution(s);let c=this._tileInfoView.getLODInfoAt(s);const u=c.getXForColumn(l),p=c.getYForRow(a);c=this._tileInfoView.getLODInfoAt(t);const m=c.getXForColumn(r),f=c.getYForRow(i),g=Math.round((u-m)/h),y=Math.round(-(p-f)/h),d=Math.round(o[0]*(n/h)),w=Math.round(o[1]*(n/h)),_=this._createBlankImage();return _.getContext(\"2d\").drawImage(e,g,y,d,w,0,0,o[0],o[1]),_}_createBlankImage(){const e=this._tileInfoView.tileInfo.size,t=document.createElement(\"canvas\");return[t.width,t.height]=e,t}};e([r({dependsOn:[\"layer.resampling?\"]})],I.prototype,\"resampling\",null),I=e([s(\"esri.views.2d.layers.TileLayerView2D\")],I);var T=I;export default T;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":""}