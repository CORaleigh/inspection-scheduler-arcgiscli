(self.webpackChunkinspection_scheduler=self.webpackChunkinspection_scheduler||[]).push([[7042],{18355:(e,t,i)=>{"use strict";i.d(t,{Q:()=>w,a:()=>M,b:()=>V,c:()=>B,d:()=>Z,e:()=>E,g:()=>k,n:()=>A,t:()=>T});var s=i(59472),r=i(56274),n=i(32656),a=i(39105),o=i(27780),l=i(47005),u=i(80685),c=i(59933),d=i(56885),h=i(93533),p=i(91535),f=i(73127),y=i(31036),_=i(71951);function m(e,t){return e?t?4:3:t?3:2}function I(e,t,i,s,r,n){const a=m(r,n),{coords:o,lengths:l}=s;if(!l)return!1;for(let s=0,r=0;s<l.length;s++,r+=a)if(!g(e,t,i,o[r],o[r+1]))return!1;return!0}function g(e,t,i,s,r){if(!e)return!1;const n=m(t,i),{coords:a,lengths:o}=e;let l=!1,u=0;for(const e of o)l=b(l,a,n,u,e,s,r),u+=e*n;return l}function b(e,t,i,s,r,n,a){let o=e,l=s;for(let e=s,u=s+r*i;e<u;e+=i){l=e+i,l===u&&(l=s);const r=t[e],c=t[e+1],d=t[l],h=t[l+1];(c<a&&h>=a||h<a&&c>=a)&&r+(a-c)/(h-c)*(d-r)<n&&(o=!o)}return o}const S=new r.Xn({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),w=Object.freeze({}),x=new f.Z,R=new f.Z,v=new f.Z,F={esriGeometryPoint:y.fQ,esriGeometryPolyline:y.J6,esriGeometryPolygon:y.eG,esriGeometryMultipoint:y.Iv};function T(e,t,i,s=e.hasZ,r=e.hasM){const n=e.hasZ&&s,a=e.hasM&&r;if(i){const o=(0,y.Nh)(v,t,e.hasZ,e.hasM,"esriGeometryPoint",i,s,r);return(0,y.fQ)(o,n,a)}return(0,y.fQ)(t,n,a)}function E(e,t,i,s,r,n,a=t,o=i){const l=t&&a,u=i&&o,c=s?"coords"in s?s:s.geometry:null;if(!c)return null;if(r){let s=(0,y.zj)(R,c,t,i,e,r,a,o);return n&&(s=(0,y.Nh)(v,s,l,u,e,n)),F[e](s,l,u)}if(n){const s=(0,y.Nh)(v,c,t,i,e,n,a,o);return F[e](s,l,u)}return(0,y.hY)(x,c,t,i,a,o),F[e](x,l,u)}async function M(e,t,i){const{outFields:s,orderByFields:r,groupByFieldsForStatistics:n,outStatistics:a}=e;if(s)for(let e=0;e<s.length;e++)s[e]=s[e].trim();if(r)for(let e=0;e<r.length;e++)r[e]=r[e].trim();if(n)for(let e=0;e<n.length;e++)n[e]=n[e].trim();if(a)for(let e=0;e<a.length;e++)a[e].onStatisticField&&(a[e].onStatisticField=a[e].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),A(e,t,i)}async function A(e,t,i){if(!e)return null;let{where:r}=e;if(e.where=r=r&&r.trim(),(!r||/^1 *= *1$/.test(r)||t&&t===r)&&(e.where=null),!e.geometry)return e;let n=await async function(e){const{geometry:t,distance:i,units:s}=e;if(null==i||"vertexAttributes"in t)return t;const r=t.spatialReference,n=s?S.fromJSON(s):(0,h.qE)(r),a=r&&((0,o.sT)(r)||(0,o.sS)(r))?t:await(0,_._W)(r,o.Zn).then((()=>(0,_.iV)(t,o.Zn)));return(await j().then((e=>e.geodesicBuffer)))(a.spatialReference,a,i,n)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;n=(0,c.aO)(n),n.spatialReference=t}e.geometry=n,await(0,_._W)(n.spatialReference,i);const a=(await(0,p.aX)((0,d.im)(n)))[0];if((0,s.Wi)(a))throw w;const l=a.toJSON(),u=await(0,_.iV)(l,l.spatialReference,i);if(!u)throw w;return u.spatialReference=i,e.geometry=u,e}function B(e){return e&&G in e?JSON.parse(JSON.stringify(e,N)):e}const G="_geVersion",N=(e,t)=>e!==G?t:void 0,O={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},C={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},D={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},U={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function j(){return Promise.all([i.e(5798),i.e(3134)]).then(i.bind(i,93134))}function k(e,t,i,s,r){if((0,d.oU)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=(0,y.Uy)(new f.Z,t,!1,!1);return(0,a.DB)((t=>function(e,t,i,s){return g(e,t,i,s.coords[0],s.coords[1])}(e,!1,!1,t)))}if((0,d.oU)(t)&&"esriGeometryMultipoint"===i){const i=(0,y.Uy)(new f.Z,t,!1,!1);if("esriSpatialRelContains"===e)return(0,a.DB)((e=>I(i,!1,!1,e,s,r)))}if((0,d.YX)(t)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return(0,a.DB)((e=>(0,l.aV)(t,E(i,s,r,e))));if((0,d.YX)(t)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return(0,a.DB)((e=>(0,l.lQ)(t,E(i,s,r,e))));if((0,d.YX)(t)&&"esriSpatialRelIntersects"===e){const e=(0,u.v$)(i);return(0,a.DB)((n=>e(t,E(i,s,r,n))))}return j().then((n=>{const a=n[O[e]].bind(null,t.spatialReference,t);return e=>a(E(i,s,r,e))}))}async function Z(e,t,i){const{spatialRel:s,geometry:r}=e;if(r){if(!0!==C[s])throw new n.Z("feature-store:unsupported-query","Unsupported query spatial relationship",{query:e});if((0,o.JY)(r.spatialReference)&&(0,o.JY)(i)){if(!function(e){return!0===D[(0,d.Ji)(e)]}(r))throw new n.Z("feature-store:unsupported-query","Unsupported query geometry type",{query:e});if(!function(e){return!0===U[e]}(t))throw new n.Z("feature-store:unsupported-query","Unsupported layer geometry type",{query:e});if(e.outSR)return(0,_._W)(e.geometry&&e.geometry.spatialReference,e.outSR)}}}function V(e){if((0,d.YX)(e))return!0;if((0,d.oU)(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1}},69996:(e,t,i)=>{"use strict";i.d(t,{Gv:()=>g,Ue:()=>r,cS:()=>y,fS:()=>I,TC:()=>a,pp:()=>o,JR:()=>_,al:()=>n,t8:()=>f,Tn:()=>p,op:()=>h,dp:()=>d});var s=i(59472);i(52937),i(50897);function r(e=b){return[e[0],e[1],e[2],e[3],e[4],e[5]]}function n(e,t,i,s,n,a,o=r()){return o[0]=e,o[1]=t,o[2]=i,o[3]=s,o[4]=n,o[5]=a,o}function a(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e[4]=Math.max(e[4],t[4]),e[5]=Math.max(e[5],t[5])}function o(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.min(e[2],t[2]),e[3]=Math.max(e[3],t[0]),e[4]=Math.max(e[4],t[1]),e[5]=Math.max(e[5],t[2])}function l(e){return e[0]>=e[3]?0:e[3]-e[0]}function u(e){return e[1]>=e[4]?0:e[4]-e[1]}function c(e){return e[2]>=e[5]?0:e[5]-e[2]}function d(e,t=[0,0,0]){return t[0]=l(e),t[1]=u(e),t[2]=c(e),t}function h(e,t,i=e){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i!==e&&(i[3]=e[3],i[4]=e[4],i[5]=e[5]),i}function p(e,t,i=e){return i[3]=t[0],i[4]=t[1],i[5]=t[2],i!==e&&(i[0]=e[0],i[1]=e[1],i[2]=e[2]),e}function f(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function y(e){return e?f(e,g):r(g)}function _(e,t){return e[0]=t[0],e[1]=t[1],e[2]=Number.NEGATIVE_INFINITY,e[3]=t[2],e[4]=t[3],e[5]=Number.POSITIVE_INFINITY,e}function m(e){return 6===e.length}function I(e,t,i){if((0,s.Wi)(e)||(0,s.Wi)(t))return e===t;if(!m(e)||!m(t))return!1;if(i){for(let s=0;s<e.length;s++)if(!i(e[s],t[s]))return!1}else for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}const g=[1/0,1/0,1/0,-1/0,-1/0,-1/0],b=[0,0,0,0,0,0];r()},97042:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>m});var s=i(59472),r=i(36544),n=i(32656),a=i(39105),o=i(6513),l=i(50897),u=i(31518),c=i(18355),d=i(90440),h=i(3951);const p=r.Z.getLogger("esri.views.2d.layers.features.support.whereUtils"),f={getAttribute:(e,t)=>e.field(t)};async function y(e,t){const s=await i.e(1063).then(i.bind(i,71063));try{const i=s.WhereClause.create(e,t);if(!i.isStandardized){const e=new n.Z("mapview - bad input","Unable to apply filter's definition expression, as expression is not standardized.",i);p.error(e)}return e=>{const t=e.readArcadeFeature();return i.testFeature(t,f)}}catch(t){return p.warn("mapview-bad-where-clause","Encountered an error when evaluating where clause",e),e=>!0}}const _=r.Z.getLogger("esri.views.2d.layers.features.controllers.FeatureFilter"),m=class{constructor(e){this._geometryBounds=(0,l.Ue)(),this._idToVisibility=new Map,this._serviceInfo=e}get hash(){return this._hash}check(e){return this._applyFilter(e)}clear(){const e=this._resetAllHiddenIds();return this.update(),{show:e,hide:[]}}invalidate(){this._idToVisibility.forEach(((e,t)=>{this._idToVisibility.set(t,0)}))}setKnownIds(e){for(const t of e)this._idToVisibility.set(t,1)}setTrue(e){const t=[],i=[],s=new Set(e);return this._idToVisibility.forEach(((e,r)=>{const n=!!(1&this._idToVisibility.get(r)),a=s.has(r);!n&&a?t.push(r):n&&!a&&i.push(r),this._idToVisibility.set(r,a?3:0)})),{show:t,hide:i}}createQuery(){const{geometry:e,spatialRel:t,where:i,timeExtent:s,objectIds:r}=this;return u.Z.fromJSON({geometry:e,spatialRel:t,where:i,timeExtent:s,objectIds:r})}async update(e,t){this._hash=JSON.stringify(e);const i=await(0,c.n)(e,null,t);await(0,a.$6)([this._setGeometryFilter(i),this._setIdFilter(i),this._setAttributeFilter(i),this._setTimeFilter(i)])}async _setAttributeFilter(e){if(!e||!e.where)return this._clause=null,void(this.where=null);this._clause=await y(e.where,this._serviceInfo.fieldsIndex),this.where=e.where}_setIdFilter(e){this._idsToShow=e&&e.objectIds&&new Set(e.objectIds),this._idsToHide=e&&e.hiddenIds&&new Set(e.hiddenIds),this.objectIds=e&&e.objectIds}async _setGeometryFilter(e){if(!e||!e.geometry)return this._spatialQueryOperator=null,this.geometry=null,void(this.spatialRel=null);const t=e.geometry,i=e.spatialRel||"esriSpatialRelIntersects",s=await(0,c.g)(i,t,this._serviceInfo.geometryType,this._serviceInfo.hasZ,this._serviceInfo.hasM);(0,o.$P)(this._geometryBounds,t),this._spatialQueryOperator=s,this.geometry=t,this.spatialRel=i}_setTimeFilter(e){if(this.timeExtent=this._timeOperator=null,e&&e.timeExtent)if(this._serviceInfo.timeInfo)this.timeExtent=e.timeExtent,this._timeOperator=(0,d.y)(this._serviceInfo.timeInfo,e.timeExtent,h.k);else{const t=new n.Z("feature-layer-view:time-filter-not-available","Unable to apply time filter, as layer doesn't have time metadata.",e.timeExtent);_.error(t)}}_applyFilter(e){return this._filterByGeometry(e)&&this._filterById(e)&&this._filterByTime(e)&&this._filterByExpression(e)}_filterByExpression(e){return!this.where||this._clause(e)}_filterById(e){return(!this._idsToHide||!this._idsToHide.size||!this._idsToHide.has(e.getObjectId()))&&(!this._idsToShow||!this._idsToShow.size||this._idsToShow.has(e.getObjectId()))}_filterByGeometry(e){if(!this.geometry)return!0;const t=e.readHydratedGeometry();return!!t&&this._spatialQueryOperator(t)}_filterByTime(e){return!(0,s.pC)(this._timeOperator)||this._timeOperator(e)}_resetAllHiddenIds(){const e=[];return this._idToVisibility.forEach(((t,i)=>{1&t||(this._idToVisibility.set(i,1),e.push(i))})),e}}},90440:(e,t,i)=>{"use strict";function s(e,t){if(!e)return null;const i=t.featureAdapter,{startTimeField:s,endTimeField:r}=e;let n=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;if(s&&r)t.forEach((e=>{const t=i.getAttribute(e,s),o=i.getAttribute(e,r);null==t||isNaN(t)||(n=Math.min(n,t)),null==o||isNaN(o)||(a=Math.max(a,o))}));else{const e=s||r;t.forEach((t=>{const s=i.getAttribute(t,e);null==s||isNaN(s)||(n=Math.min(n,s),a=Math.max(a,s))}))}return{start:n,end:a}}function r(e,t,i){if(!t||!e)return null;const{startTimeField:s,endTimeField:r}=e;if(!s&&!r)return null;const{start:n,end:a}=t;return null===n&&null===a?null:void 0===n&&void 0===a?()=>!1:s&&r?function(e,t,i,s,r){return null!=s&&null!=r?n=>{const a=e.getAttribute(n,t),o=e.getAttribute(n,i);return(null==a||a<=r)&&(null==o||o>=s)}:null!=s?t=>{const r=e.getAttribute(t,i);return null==r||r>=s}:null!=r?i=>{const s=e.getAttribute(i,t);return null==s||s<=r}:void 0}(i,s,r,n,a):function(e,t,i,s){return null!=i&&null!=s&&i===s?s=>e.getAttribute(s,t)===i:null!=i&&null!=s?r=>{const n=e.getAttribute(r,t);return n>=i&&n<=s}:null!=i?s=>e.getAttribute(s,t)>=i:null!=s?i=>e.getAttribute(i,t)<=s:void 0}(i,s||r,n,a)}i.d(t,{R:()=>s,y:()=>r})},3951:(e,t,i)=>{"use strict";i.d(t,{p:()=>d,k:()=>c});var s=i(59472),r=i(35470),n=i(69996),a=i(96233),o=i(41833);function l(e){return(4294901760&e)>>>16}function u(e){return 65535&e}const c={getObjectId:e=>e.getObjectId(),getAttributes:e=>e.readAttributes(),getAttribute:(e,t)=>e.readAttribute(t),cloneWithGeometry:(e,t)=>e,getGeometry:e=>e.readHydratedGeometry(),getCentroid:(e,t)=>e.readCentroid()};class d extends o.J{constructor(e,t){super(e,t),this.featureAdapter=c,this.events=new r.Z,this._featureSetsByInstance=new Map,this._objectIdToDisplayId=new Map,this._spatialIndexInvalid=!0,this._index=(0,a.r)(9,(e=>({minX:this._storage.getXMin(e),minY:this._storage.getYMin(e),maxX:this._storage.getXMax(e),maxY:this._storage.getYMax(e)})))}get storeStatistics(){return{featureCount:0,vertexCount:0}}onTileData(e,t,i){if((0,s.Wi)(t.addOrUpdate))return t;this._featureSetsByInstance.set(t.addOrUpdate.instance,t.addOrUpdate),this._storage=i,t.addOrUpdate._storage=i;const r=t.addOrUpdate.getCursor();for(;r.next();){const t=r.getObjectId(),s=r.instance<<16|r.getIndex();let n=this._objectIdToDisplayId.get(t);n||(n=i.createDisplayId(),this._objectIdToDisplayId.set(t,n),this._spatialIndexInvalid=!0),r.setDisplayId(n),i.setInstanceId(n,s),this.setComputedAttributes(i,r,n,e.scale)}return"update"===t.type&&(this._spatialIndexInvalid=!0),this.events.emit("changed"),t}forEach(e){this._objectIdToDisplayId.forEach((t=>{const i=this._storage.getInstanceId(t),s=this._lookupFeature(i);e(s)}))}forEachUnsafe(e){this._objectIdToDisplayId.forEach((t=>{const i=this._storage.getInstanceId(t),s=l(i),r=u(i),n=this._getFeatureSet(s);n.setIndex(r),e(n)}))}forEachInBounds(e,t){const i=this._searchIndex(e);for(const e of i){const i=this.lookupFeatureByDisplayId(e,this._storage);t((0,s.Wg)(i))}}forEachBounds(e,t,i){this._rebuildIndex();const s=[0,0,0,0];for(const r of e){if(!r.readGeometry())continue;const e=r.getDisplayId();s[0]=this._storage.getXMin(e),s[1]=this._storage.getYMin(e),s[2]=this._storage.getXMax(e),s[3]=this._storage.getYMax(e),t((0,n.JR)(i,s))}}sweepFeatures(e,t,i){this._objectIdToDisplayId.forEach(((s,r)=>{e.has(s)||(t.releaseDisplayId(s),i.unsetAttributeData(s),this._objectIdToDisplayId.delete(r))})),this.events.emit("changed")}sweepFeatureSets(e){this._featureSetsByInstance.forEach(((t,i)=>{e.has(i)||this._featureSetsByInstance.delete(i)}))}lookupObjectId(e,t){const i=this.lookupFeatureByDisplayId(e,t);return(0,s.Wi)(i)?null:i.getObjectId()}lookupDisplayId(e){return this._objectIdToDisplayId.get(e)}lookupFeatureByDisplayId(e,t){const i=t.getInstanceId(e);return this._lookupFeature(i)}lookupByDisplayIdUnsafe(e){const t=this._storage.getInstanceId(e),i=l(t),s=u(t),r=this._getFeatureSet(i);return r?(r.setIndex(s),r):null}hasInstance(e){return this._featureSetsByInstance.has(e)}_rebuildIndex(){if(!this._spatialIndexInvalid)return;this._index.clear();const e=[];this._objectIdToDisplayId.forEach((t=>{const i=this._storage.getInstanceId(t);this._storage.setBounds(t,this._lookupFeature(i))&&e.push(t)})),this._index.load(e),this._spatialIndexInvalid=!1}_lookupFeature(e){const t=l(e),i=u(e),s=this._getFeatureSet(t);if(!s)return null;const r=s.getCursor();return r.setIndex(i),r}_getFeatureSet(e){return this._featureSetsByInstance.get(e)}_searchIndex(e){this._rebuildIndex();const t={minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]};return this._index.search(t)}}},41833:(e,t,i)=>{"use strict";i.d(t,{J:()=>d});var s=i(95830),r=i(59472),n=i(39105),a=i(30927),o=i(23229),l=i(36544);const u=function(e,t,i){e.referencesGeometry();const s=t.readArcadeFeature();try{return e.evaluate({...i,$feature:s})}catch(e){return l.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}},c=i.e(2357).then(i.bind(i,82357));class d{constructor(e,t){this._canCacheExpressionValue=!1,this._sourceInfo=e,this._bitsets={computed:t.getBitset(t.createBitset())}}async updateSchema(e,t){const i=(0,o.Hg)(this._schema,t);if(this._schema=t,!t||(0,r.Wi)(i)||!(0,o.uD)(i,"attributes"))return;(0,s.Z)("esri-2d-update-debug")&&console.debug("Applying Update - Store:",i),this._bitsets.computed.clear(),e.targets[t.name]=!0;const a=t.attributes,l=[],u=[];for(const e in a){const t=a[e];switch(t.type){case"field":break;case"expression":l.push(this._createArcadeComputedField(t));break;case"label-expression":l.push(this._createLabelArcadeComputedField(t));break;case"statistic":u.push(t)}}this._computedFields=await(0,n.$6)(l),this._canCacheExpressionValue=!this._computedFields.some((e=>"expression"===e.type&&e.expression.referencesScale())),this._statisticFields=u}setComputedAttributes(e,t,i,s){const r=this._bitsets.computed;if(!this._canCacheExpressionValue||!r.has(i)){r.set(i);for(const r of this._computedFields){const n=this._evaluateField(t,r,s);switch(r.resultType){case"numeric":e.setComputedNumericAtIndex(i,r.fieldIndex,n);break;case"string":e.setComputedStringAtIndex(i,r.fieldIndex,n)}}}}async _createArcadeComputedField(e){const t=this._sourceInfo.spatialReference,i=this._sourceInfo.fieldsIndex;return{...e,expression:await(0,a.Yi)(e.valueExpression,t,i)}}async _createLabelArcadeComputedField(e){const t=this._sourceInfo.spatialReference,i=this._sourceInfo.fields,{createLabelFunction:s}=await c,r=await s(e.label,i,t);return{...e,builder:r}}_evaluateField(e,t,i){switch(t.type){case"label-expression":{const i=e.readArcadeFeature();return t.builder.evaluate(i)||""}case"expression":{const{expression:s}=t;return u(s,e,{$view:{scale:i}})}}}}}}]);
//# sourceMappingURL=7042.js.map