{"version":3,"sources":["webpack://inspection-scheduler/./node_modules/@arcgis/core/layers/support/ExportImageParameters.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/renderers/support/clickToleranceUtils.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/layers/MapImageLayerView.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/2d/layers/MapImageLayerView2D.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/layers/support/popupUtils.js","webpack://inspection-scheduler/./node_modules/@arcgis/core/views/support/drapedUtils.js"],"names":["o","visible","definitionExpression","labelingInfo","labelsVisible","opacity","minScale","maxScale","renderer","source","y","super","arguments","this","_scale","view","layer","hasDynamicLayers","e","visibleSublayers","map","toExportImageJSON","length","JSON","stringify","serviceSublayers","_get","_set","handles","remove","add","allSublayers","on","notifyChange","propertyName","id","join","filter","reduce","s","scale","layers","layerDefs","dynamicLayers","timeExtent","dpi","imageFormat","imageTransparency","gdbVersion","sublayers","r","i","a","t","l","forEach","unshift","some","format","transparent","readOnly","dependsOn","prototype","type","Number","xoffset","Math","max","abs","yoffset","stops","n","size","event","pointerType","maxSize","minSize","f","floor","visualVariables","symbol","uniqueValueInfos","classBreakInfos","d","u","get","async","popupEnabled","defaultPopupTemplateEnabled","push","sublayer","popupTemplate","toArray","load","catch","createQuery","p","createFetchPopupFeaturesQueryGeometry","geometry","outFields","m","_loadArcadeModules","arcadeUtils","hasGeometryOperations","maxAllowableOffset","width","queryFeatures","features","value","canResume","imageParameters","isEmpty","c","_exportImageVersion","strategy","update","error","imageMaxWidth","imageMaxHeight","version","_bitmapContainer","container","addChild","fetchSource","fetchImage","bind","requestUpdate","imageRotationSupported","imageNormalizationSupported","hidpi","destroy","removeChild","removeAllChildren","updating","updateRequested","timestamp","refreshTimestamp","getRequiredFields","fields","lastEditInfoEnabled","objectIdField","typeIdField","globalIdField","relationships","includes","indexOf","keyField","defaultPopupTemplate","resolution","overlayPixelSizeInMapUnits","basemapSpatialReference","equals","spatialReference","x","xmin","min","ymin","xmax","ymax"],"mappings":"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","file":"chunks/4005.js","sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as s}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as r}from\"../../core/accessorSupport/decorators/subclass.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import i from\"../../core/Accessor.js\";import{combinedViewLayerTimeExtentProperty as a}from\"./commonProperties.js\";import{HandleOwnerMixin as t}from\"../../core/HandleOwner.js\";import{isExportDynamic as l}from\"./sublayerUtils.js\";import n from\"../../views/View.js\";const o={visible:\"visibleSublayers\",definitionExpression:\"layerDefs\",labelingInfo:\"hasDynamicLayers\",labelsVisible:\"hasDynamicLayers\",opacity:\"hasDynamicLayers\",minScale:\"visibleSublayers\",maxScale:\"visibleSublayers\",renderer:\"hasDynamicLayers\",source:\"hasDynamicLayers\"};let y=class extends(t(i)){constructor(){super(...arguments),this._scale=null,this.view=null}destroy(){this.layer=this.view=null}get dynamicLayers(){if(!this.hasDynamicLayers)return null;const e=this.visibleSublayers.map((e=>e.toExportImageJSON()));return e.length?JSON.stringify(e):null}get hasDynamicLayers(){return this.layer&&l(this.visibleSublayers,this.layer.serviceSublayers,this.layer)}set layer(e){this._get(\"layer\")!==e&&(this._set(\"layer\",e),this.handles.remove(\"layer\"),e&&this.handles.add([e.allSublayers.on(\"change\",(()=>this.notifyChange(\"visibleSublayers\"))),e.on(\"sublayer-update\",(e=>this.notifyChange(o[e.propertyName])))],\"layer\"))}get layers(){const e=this.visibleSublayers;return e?e.length?\"show:\"+e.map((e=>e.id)).join(\",\"):\"show:-1\":null}get layerDefs(){const e=this.visibleSublayers.filter((e=>null!=e.definitionExpression));return e.length?JSON.stringify(e.reduce(((e,s)=>(e[s.id]=s.definitionExpression,e)),{})):null}get scale(){return null!=this._scale?this._scale:this.view&&this.view.scale||0}set scale(e){this.view||(this._scale=e,this.notifyChange(\"scale\"))}get version(){const e=this;e.layers,e.layerDefs,e.dynamicLayers,e.timeExtent;const s=e.layer;return s&&(s.dpi,s.imageFormat,s.imageTransparency,s.gdbVersion),(this._get(\"version\")||0)+1}set version(e){this._set(\"version\",e)}get visibleSublayers(){const e=[];if(!this.layer)return e;const s=this.layer.sublayers,r=s=>{const i=this.scale,a=0===i,t=0===s.minScale||i<=s.minScale,l=0===s.maxScale||i>=s.maxScale;s.visible&&(a||t&&l)&&(s.sublayers?s.sublayers.forEach(r):e.unshift(s))};s&&s.forEach(r);const i=this._get(\"visibleSublayers\");return!i||i.length!==e.length||i.some(((s,r)=>e[r]!==s))?e:i}toJSON(){const e=this.layer;let s={dpi:e.dpi,format:e.imageFormat,transparent:e.imageTransparency,gdbVersion:e.gdbVersion||null};return this.hasDynamicLayers&&this.dynamicLayers?s.dynamicLayers=this.dynamicLayers:s={...s,layers:this.layers,layerDefs:this.layerDefs},s}};e([s({readOnly:!0,dependsOn:[\"hasDynamicLayers\",\"visibleSublayers\"]})],y.prototype,\"dynamicLayers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\",\"layer.serviceSublayers\",\"layer.capabilities\"]})],y.prototype,\"hasDynamicLayers\",null),e([s()],y.prototype,\"layer\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layers\",null),e([s({readOnly:!0,dependsOn:[\"visibleSublayers\"]})],y.prototype,\"layerDefs\",null),e([s({type:Number,dependsOn:[\"view.scale\"]})],y.prototype,\"scale\",null),e([s(a)],y.prototype,\"timeExtent\",void 0),e([s({dependsOn:[\"layers\",\"layerDefs\",\"dynamicLayers\",\"layer.dpi\",\"layer.imageFormat\",\"layer.imageTransparency\",\"layer.gdbVersion\",\"timeExtent\"]})],y.prototype,\"version\",null),e([s({type:n})],y.prototype,\"view\",void 0),e([s({readOnly:!0,dependsOn:[\"layer.sublayers\",\"scale\"]})],y.prototype,\"visibleSublayers\",null),y=e([r(\"esri.layers.mixins.ExportImageParameters\")],y);export{y as ExportImageParameters};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nfunction t(t,e){return e?\"xoffset\"in e&&e.xoffset?Math.max(t,Math.abs(e.xoffset)):\"yoffset\"in e&&e.yoffset?Math.max(t,Math.abs(e.yoffset||0)):t:t}function e(t,e){return\"number\"==typeof t?t:t&&t.stops&&t.stops.length?function(t){let e=0,n=0;for(let r=0;r<t.length;r++){const s=t[r].size;\"number\"==typeof s&&(e+=s,n++)}return e/n}(t.stops):e}function n(n){const r=n&&n.renderer,s=\"touch\"===(n&&n.event&&n.event.pointerType)?9:6;if(!r)return s;const o=\"visualVariables\"in r?function(t,n){if(!n)return t;const r=n.filter((t=>\"size\"===t.type)).map((n=>{const{maxSize:r,minSize:s}=n;return(e(r,t)+e(s,t))/2}));let s=0;const o=r.length;if(0===o)return t;for(let t=0;t<o;t++)s+=r[t];const f=Math.floor(s/o);return Math.max(f,t)}(s,r.visualVariables):s;if(\"simple\"===r.type)return t(o,r.symbol);if(\"unique-value\"===r.type){let e=o;return r.uniqueValueInfos.forEach((n=>{e=t(e,n.symbol)})),e}if(\"class-breaks\"===r.type){let e=o;return r.classBreakInfos.forEach((n=>{e=t(e,n.symbol)})),e}return r.type,o}export{n as calculateTolerance};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../chunks/tslib.es6.js\";import\"../../core/has.js\";import{isSome as r}from\"../../core/maybe.js\";import\"../../core/Logger.js\";import\"../../core/accessorSupport/ensureType.js\";import{property as t}from\"../../core/accessorSupport/decorators/property.js\";import{subclass as s}from\"../../core/accessorSupport/decorators/subclass.js\";import o from\"../../core/Error.js\";import\"../../core/urlUtils.js\";import\"../../core/uuid.js\";import\"../../portal/support/resourceExtension.js\";import{reject as a,all as p,eachAlways as i}from\"../../core/promiseUtils.js\";import{loadArcade as u}from\"../../support/arcadeOnDemand.js\";import{calculateTolerance as c}from\"../../renderers/support/clickToleranceUtils.js\";import{getRequiredFields as l,getFetchPopupTemplate as m}from\"./support/popupUtils.js\";const n=n=>{let d=class extends n{async fetchPopupFeatures(e,t){const{layer:s}=this;if(!e)return a(new o(\"mapimagelayerview:fetchPopupFeatures\",\"Nothing to fetch without area\",{layer:s}));const u=this.get(\"view.scale\"),n=[],d=async e=>{const s=0===e.minScale||u<=e.minScale,o=0===e.maxScale||u>=e.maxScale;if(e.visible&&s&&o)if(e.sublayers)e.sublayers.forEach(d);else if(e.popupEnabled){const s=m(e,{...t,defaultPopupTemplateEnabled:!1});r(s)&&n.push({sublayer:e,popupTemplate:s})}},y=s.sublayers.toArray().map(d);await p(y);const f=n.map((async({sublayer:s,popupTemplate:o})=>{await s.load().catch((()=>{}));const a=s.createQuery(),p=r(t)?t.event:null,i=c({renderer:s.renderer,event:p}),u=this.createFetchPopupFeaturesQueryGeometry(e,i);a.geometry=u,a.outFields=await l(s,o);const m=await this._loadArcadeModules(o);m&&m.arcadeUtils.hasGeometryOperations(o)||(a.maxAllowableOffset=u.width/i);return(await s.queryFeatures(a)).features}));return(await i(f)).reduce(((e,r)=>r.value?[...e,...r.value]:e),[]).filter((e=>null!=e))}canResume(){var e,r;return!!super.canResume()&&(null==(e=this.imageParameters)||null==(r=e.timeExtent)||!r.isEmpty)}_loadArcadeModules(e){if(e.get(\"expressionInfos.length\"))return u()}};return e([t()],d.prototype,\"imageParameters\",void 0),e([t()],d.prototype,\"layer\",void 0),e([t({dependsOn:[\"imageParameters.timeExtent\"]})],d.prototype,\"suspended\",void 0),d=e([s(\"esri.views.layers.MapImageLayerView\")],d),d};export{n as MapImageLayerView};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{_ as e}from\"../../../chunks/tslib.es6.js\";import\"../../../core/has.js\";import t from\"../../../core/Logger.js\";import\"../../../core/accessorSupport/ensureType.js\";import{property as r}from\"../../../core/accessorSupport/decorators/property.js\";import{subclass as i}from\"../../../core/accessorSupport/decorators/subclass.js\";import\"../../../core/urlUtils.js\";import\"../../../core/uuid.js\";import\"../../../portal/support/resourceExtension.js\";import{isAbortError as s}from\"../../../core/promiseUtils.js\";import{init as a}from\"../../../core/watchUtils.js\";import{RefreshableLayerView as o}from\"../../layers/RefreshableLayerView.js\";import{ExportImageParameters as p}from\"../../../layers/support/ExportImageParameters.js\";import m from\"../../layers/LayerView.js\";import{createQueryGeometry as h}from\"../../support/drapedUtils.js\";import{MapImageLayerView as n}from\"../../layers/MapImageLayerView.js\";import{BitmapContainer as d}from\"../engine/BitmapContainer.js\";import{LayerView2DMixin as g}from\"./LayerView2D.js\";import u from\"./support/ExportStrategy.js\";const c=t.getLogger(\"esri.views.2d.layers.MapImageLayerView2D\");let l=class extends(n(o(g(m)))){constructor(){super(...arguments),this._exportImageVersion=-1}hitTest(){return null}update(e){this.strategy.update(e).catch((e=>{s(e)||c.error(e)}))}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:r}=this.layer,i=r>=10.3,s=r>=10;this._bitmapContainer=new d,this.container.addChild(this._bitmapContainer),this.strategy=new u({container:this._bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:i,imageNormalizationSupported:s,hidpi:!0}),this.imageParameters=new p({view:this.view,layer:this.layer}),this.handles.add(a(this.imageParameters,\"version\",(e=>{this._exportImageVersion!==e&&(this._exportImageVersion=e,this.requestUpdate())})),\"mapimagelayerview-update\")}detach(){this.strategy.destroy(),this.handles.remove(\"mapimagelayerview-update\"),this.imageParameters.destroy(),this.imageParameters=null,this._exportImageVersion=-1,this.container.removeChild(this._bitmapContainer),this._bitmapContainer.removeAllChildren()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}createFetchPopupFeaturesQueryGeometry(e,t){return h(e,t,this.view)}async doRefresh(){this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,r,i){return this.layer.fetchImage(e,t,r,{timeExtent:this.imageParameters.timeExtent,timestamp:this.refreshTimestamp,...i})}};e([r()],l.prototype,\"strategy\",void 0),e([r({dependsOn:[\"strategy.updating\"]})],l.prototype,\"updating\",void 0),l=e([i(\"esri.views.2d.layers.MapImageLayerView2D\")],l);var y=l;export default y;\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e}from\"../../../core/maybe.js\";import{getFeatureEditFields as p,fixFields as l,hasField as t}from\"../../../layers/support/fieldUtils.js\";async function i(i,d=i.popupTemplate){if(!e(d))return[];const o=await d.getRequiredFields(i.fields),{lastEditInfoEnabled:s}=d,{objectIdField:u,typeIdField:a,globalIdField:n,relationships:f}=i;if(o.includes(\"*\"))return[\"*\"];const r=s?await p(i):[],m=l(i.fields,[...o,...r]);return a&&m.push(a),m&&u&&t(i.fields,u)&&-1===m.indexOf(u)&&m.push(u),m&&n&&t(i.fields,n)&&-1===m.indexOf(n)&&m.push(n),f&&f.forEach((e=>{const{keyField:p}=e;m&&p&&t(i.fields,p)&&-1===m.indexOf(p)&&m.push(p)})),m}function d(p,l){return p.popupTemplate?p.popupTemplate:e(l)&&l.defaultPopupTemplateEnabled&&e(p.defaultPopupTemplate)?p.defaultPopupTemplate:null}export{d as getFetchPopupTemplate,i as getRequiredFields};\n","/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.18/esri/copyright.txt for details.\n*/\nimport{isSome as e,isNone as t}from\"../../core/maybe.js\";import r from\"../../geometry/Extent.js\";import\"../../geometry.js\";import{getMetersPerUnitForSR as n}from\"../../core/unitUtils.js\";import{calculateTolerance as i}from\"../../renderers/support/clickToleranceUtils.js\";function a(t,i,a,o=new r){let s;if(\"2d\"===a.type)s=i*a.resolution;else if(\"3d\"===a.type){const r=a.overlayPixelSizeInMapUnits(t),o=a.basemapSpatialReference;s=e(o)&&!o.equals(a.spatialReference)?n(o)/n(a.spatialReference):i*r}const m=t.x-s,p=t.y-s,c=t.x+s,l=t.y+s,{spatialReference:f}=a;return o.xmin=Math.min(m,c),o.ymin=Math.min(p,l),o.xmax=Math.max(m,c),o.ymax=Math.max(p,l),o.spatialReference=f,o}function o(e,r,n){const o=n.toMap(e);if(t(o))return!1;return a(o,i(),n,s).intersects(r)}const s=new r;export{a as createQueryGeometry,o as intersectsDrapedGeometry};\n"],"sourceRoot":""}