(self.webpackChunkinspection_scheduler=self.webpackChunkinspection_scheduler||[]).push([[8525],{71108:(t,e,i)=>{"use strict";i.d(e,{RL:()=>c,bk:()=>l,Fp:()=>o,UV:()=>h});var s=i(56885),r=i(90169),n=i(69688);function o(t){if(!t)return null;switch(t.type){case"CIMPointSymbol":{const e=t.symbolLayers;return e&&1===e.length?o(e[0]):null}case"CIMVectorMarker":{const e=t.markerGraphics;if(!e||1!==e.length)return null;const i=e[0];if(!i)return null;const s=i.geometry;if(!s)return null;const r=i.symbol;return!r||"CIMPolygonSymbol"!==r.type&&"CIMLineSymbol"!==r.type?null:{geom:s,asFill:"CIMPolygonSymbol"===r.type}}case"sdf":return{geom:t.geom,asFill:t.asFill}}return null}function a(t){let e=1/0,i=-1/0,s=1/0,r=-1/0;for(const n of t)for(const t of n)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<s&&(s=t[1]),t[1]>r&&(r=t[1]);return[e,s,i,r]}function l(t){return t?t.rings?a(t.rings):t.paths?a(t.paths):(0,s.YX)(t)?[t.xmin,t.ymin,t.xmax,t.ymax]:null:null}function h(t,e,i,s,r){const[n,o,a,l]=t;if(a<n||l<o)return[0,0,0];const h=a-n,c=l-o,f=Math.floor(31.5),u=(128-2*(f+1))/Math.max(h,c),m=Math.round(h*u)+2*f,d=Math.round(c*u)+2*f;let p=1;e&&(p=d/u/(e.ymax-e.ymin));let y=0,_=0;if(s)if(r){if(e&&i&&e.ymax-e.ymin>0){const t=(e.xmax-e.xmin)/(e.ymax-e.ymin);y=s.x/(i*t),_=s.y/i}}else y=s.x,_=s.y;return y=.5*(e.xmax+e.xmin)+y*(e.xmax-e.xmin),_=.5*(e.ymax+e.ymin)+_*(e.ymax-e.ymin),y-=n,_-=o,y*=u,_*=u,y+=f,_+=f,[p,y/m-.5,-(_/d-.5)]}function c(t){const e=(i=t.geom)?i.rings?i.rings:i.paths?i.paths:void 0!==i.xmin&&void 0!==i.ymin&&void 0!==i.xmax&&void 0!==i.ymax?[[[i.xmin,i.ymin],[i.xmin,i.ymax],[i.xmax,i.ymax],[i.xmax,i.ymin],[i.xmin,i.ymin]]]:null:null;var i;const s=function(t){let e=1/0,i=-1/0,s=1/0,n=-1/0;for(const r of t)for(const t of r)t[0]<e&&(e=t[0]),t[0]>i&&(i=t[0]),t[1]<s&&(s=t[1]),t[1]>n&&(n=t[1]);return new r.Z(e,s,i-e,n-s)}(e),n=Math.floor(31.5),o=(128-2*(n+1))/Math.max(s.width,s.height),a=Math.round(s.width*o)+2*n,l=Math.round(s.height*o)+2*n,h=[];for(const i of e)if(i&&i.length>1){const e=[];for(const t of i){let[i,r]=t;i-=s.x,r-=s.y,i*=o,r*=o,i+=n-.5,r+=n-.5,e.push([i,r])}if(t.asFill){const t=e.length-1;e[0][0]===e[t][0]&&e[0][1]===e[t][1]||e.push(e[0])}h.push(e)}const c=function(t,e,i,s){const r=e*i,n=new Array(r),o=s*s+1;for(let t=0;t<r;++t)n[t]=o;for(const r of t){const t=r.length;for(let o=1;o<t;++o){const t=r[o-1],a=r[o];let l,h,c,f;t[0]<a[0]?(l=t[0],h=a[0]):(l=a[0],h=t[0]),t[1]<a[1]?(c=t[1],f=a[1]):(c=a[1],f=t[1]);let u=Math.floor(l)-s,m=Math.floor(h)+s,d=Math.floor(c)-s,p=Math.floor(f)+s;u<0&&(u=0),m>e&&(m=e),d<0&&(d=0),p>i&&(p=i);const y=a[0]-t[0],_=a[1]-t[1],x=y*y+_*_;for(let s=u;s<m;s++)for(let r=d;r<p;r++){let o,l,h=(s-t[0])*y+(r-t[1])*_;h<0?(o=t[0],l=t[1]):h>x?(o=a[0],l=a[1]):(h/=x,o=t[0]+h*y,l=t[1]+h*_);const c=(s-o)*(s-o)+(r-l)*(r-l),f=(i-r-1)*e+s;c<n[f]&&(n[f]=c)}}}for(let t=0;t<r;++t)n[t]=Math.sqrt(n[t]);return n}(h,a,l,n);return t.asFill&&function(t,e,i,s,r){for(const n of t){const t=n.length;for(let o=1;o<t;++o){const t=n[o-1],a=n[o];let l,h,c,f;t[0]<a[0]?(l=t[0],h=a[0]):(l=a[0],h=t[0]),t[1]<a[1]?(c=t[1],f=a[1]):(c=a[1],f=t[1]);let u=Math.floor(l),m=Math.floor(h)+1,d=Math.floor(c),p=Math.floor(f)+1;u<s&&(u=s),m>e-s&&(m=e-s),d<s&&(d=s),p>i-s&&(p=i-s);for(let n=d;n<p;++n){if(t[1]>n==a[1]>n)continue;const o=(i-n-1)*e;for(let e=u;e<m;++e)e<(a[0]-t[0])*(n-t[1])/(a[1]-t[1])+t[0]&&(r[o+e]=-r[o+e]);for(let t=s;t<u;++t)r[o+t]=-r[o+t]}}}}(h,a,l,n,c),[f(c,n),a,l]}function f(t,e){const i=2*e,s=t.length,r=new Uint8Array(4*s);for(let e=0;e<s;++e){const s=.5-t[e]/i;(0,n.I)(s,r,4*e)}return r}},93318:(t,e,i)=>{"use strict";i.d(e,{S:()=>A,c:()=>M});var s=i(88263),r=i(36544),n=i(39105),o=i(30927),a=i(78745),l=i(96071),h=i(19546),c=i(49723),f=i(36889),u=i(71108);const m=r.Z.getLogger("esri.symbols.cim.cimAnalyzer");function d(t){switch(t){case"Butt":return 0;case"Square":return 2;case"Round":default:return 1}}function p(t){switch(t){case"Bevel":return 0;case"Miter":return 2;case"Round":default:return 1}}function y(t){switch(t){case"Left":default:return"left";case"Right":return"right";case"Center":return"center";case"Justify":return"justify"}}function _(t){switch(t){case"Top":default:return"top";case"Center":return"middle";case"Baseline":return"baseline";case"Bottom":return"bottom"}}function x(t,e,i,s){let r;t[e]?r=t[e]:(r={},t[e]=r),r[i]=s}function g(t){const e=t.markerPlacement;return e&&e.angleToLine?1:0}async function M(t,e,i,s){const r=i||[];if(!t)return r;let a,l;const h={};if("CIMSymbolReference"!==t.type)return m.error("Expect cim type to be 'CIMSymbolReference'"),r;if(a=t.symbol,l=t.primitiveOverrides,l){const t=[];for(const i of l){const s=i.valueExpressionInfo;if(s&&e){const r=s.expression,n=(0,o.Yi)(r,e.spatialReference,e.fields).then((t=>{t&&x(h,i.primitiveName,i.propertyName,t)}));t.push(n)}else null!=i.value&&x(h,i.primitiveName,i.propertyName,i.value)}await(0,n.all)(t)}switch(a.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":!function(t,e,i,s,r,n){if(!t)return;const o=t.symbolLayers;if(!o)return;let a;const l=f.B$.getSize(t);"CIMPointSymbol"===t.type&&"Map"===t.angleAlignment&&(a=1);let h=o.length;for(;h--;){const c=o[h];if(!c||!1===c.enable)continue;const u=[];switch(f.E0.findApplicableOverrides(c,e,u),c.type){case"CIMSolidFill":b(c,i,u,s,r);break;case"CIMPictureFill":w(c,i,u,s,r);break;case"CIMHatchFill":v(c,i,u,s,r);break;case"CIMGradientFill":S(c,i,u,s,r);break;case"CIMSolidStroke":C(c,i,u,s,r,"CIMPolygonSymbol"===t.type,l);break;case"CIMPictureStroke":L(c,i,u,s,r,"CIMPolygonSymbol"===t.type,l);break;case"CIMGradientStroke":P(c,i,u,s,r,"CIMPolygonSymbol"===t.type,l);break;case"CIMCharacterMarker":if(z(c,i,u,s,r))break;break;case"CIMPictureMarker":if(z(c,i,u,s,r))break;"CIMLineSymbol"===t.type&&(a=g(c)),k(c,i,u,s,r,a,l);break;case"CIMVectorMarker":if(z(c,i,u,s,r))break;"CIMLineSymbol"===t.type&&(a=g(c)),O(c,i,u,s,r,a,l,n);break;default:m.error("Cannot analyze CIM layer",c.type)}}}(a,l,h,e,r,s)}return r}function b(t,e,i,r,n){const o=t.primitiveName,a=(0,h.NO)(t.color),l=(0,s.hP)(JSON.stringify(t)).toString();n.push({type:"fill",templateHash:l,materialHash:0===i.length?l:()=>l,cim:t,materialOverrides:null,colorLocked:t.colorLocked,color:N(o,e,"Color",r,a,R),height:0,angle:0,offsetX:0,offsetY:0,scaleX:1,effects:t.effects})}function w(t,e,i,r,n){const o=t.primitiveName,a=t.tintColor?(0,h.NO)(t.tintColor):{r:255,g:255,b:255,a:1},l=(0,s.hP)(JSON.stringify(t)).toString(),c=(0,s.hP)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();n.push({type:"fill",templateHash:l,materialHash:0===i.length?c:()=>c,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,color:N(o,e,"TintColor",r,a,R),height:N(o,e,"Height",r,t.height),scaleX:N(o,e,"ScaleX",r,t.scaleX),angle:N(o,e,"Rotation",r,t.rotation),offsetX:N(o,e,"OffsetX",r,t.offsetX),offsetY:N(o,e,"OffsetY",r,t.offsetY)})}function v(t,e,i,r,n){const o=["Rotation","OffsetX","OffsetY"],a=i.filter((e=>e.primitiveName!==t.primitiveName&&-1===o.indexOf(e.propertyName))),l=t.primitiveName,h=(0,s.hP)(JSON.stringify(t)).toString(),c=(0,s.hP)(`${t.separation}${JSON.stringify(t.lineSymbol)}`).toString();n.push({type:"fill",templateHash:h,materialHash:0===i.length?c:Z(c,e,a,r),cim:t,materialOverrides:a,colorLocked:t.colorLocked,effects:t.effects,color:{r:255,g:255,b:255,a:1},height:N(l,e,"Separation",r,t.separation),scaleX:1,angle:N(l,e,"Rotation",r,t.rotation),offsetX:N(l,e,"OffsetX",r,t.offsetX),offsetY:N(l,e,"OffsetY",r,t.offsetY)})}function S(t,e,i,r,n){const o=(0,s.hP)(JSON.stringify(t)).toString();n.push({type:"fill",templateHash:o,materialHash:0===i.length?o:Z(o,e,i,r),cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,color:{r:128,g:128,b:128,a:1},height:0,angle:0,offsetX:0,offsetY:0,scaleX:1})}function C(t,e,i,r,n,o,a){const l=(0,s.hP)(JSON.stringify(t)).toString(),c=t.primitiveName,f=(0,h.NO)(t.color),u=void 0!==t.width?t.width:4,m=d(t.capStyle),y=p(t.joinStyle),_=t.miterLimit;n.push({type:"line",templateHash:l,materialHash:0===i.length?l:()=>l,cim:t,materialOverrides:null,isOutline:o,colorLocked:t.colorLocked,effects:t.effects,color:N(c,e,"Color",r,f,R),width:N(c,e,"Width",r,u),cap:N(c,e,"CapStyle",r,m),join:N(c,e,"JoinStyle",r,y),miterLimit:N(c,e,"MiterLimit",r,_),referenceWidth:a,zOrder:D(t.name),isDashed:!1})}function L(t,e,i,r,n,o,a){const l=(0,s.hP)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString(),c=t.primitiveName,f=(0,h.NO)(t.tintColor),u=void 0!==t.width?t.width:4,m=d(t.capStyle),y=p(t.joinStyle),_=t.miterLimit,x=(0,s.hP)(JSON.stringify(t)).toString();n.push({type:"line",templateHash:x,materialHash:0===i.length?l:()=>l,cim:t,materialOverrides:null,isOutline:o,colorLocked:t.colorLocked,effects:t.effects,color:N(c,e,"TintColor",r,f,R),width:N(c,e,"Width",r,u),cap:N(c,e,"CapStyle",r,m),join:N(c,e,"JoinStyle",r,y),miterLimit:N(c,e,"MiterLimit",r,_),referenceWidth:a,zOrder:D(t.name),isDashed:!1})}function P(t,e,i,r,n,o,a){const l=t.primitiveName,h=void 0!==t.width?t.width:4,c=d(t.capStyle),f=p(t.joinStyle),u=t.miterLimit,m=(0,s.hP)(JSON.stringify(t)).toString();n.push({type:"line",templateHash:m,materialHash:0===i.length?m:Z(m,e,i,r),cim:t,materialOverrides:null,isOutline:o,colorLocked:t.colorLocked,effects:t.effects,color:{r:128,g:128,b:128,a:1},width:N(l,e,"Width",r,h),cap:N(l,e,"CapStyle",r,c),join:N(l,e,"JoinStyle",r,f),miterLimit:N(l,e,"MiterLimit",r,u),referenceWidth:a,zOrder:D(t.name),isDashed:!1})}function z(t,e,i,r,n){const o=t.markerPlacement;if(!o||"CIMMarkerPlacementInsidePolygon"!==o.type)return!1;const a=o,l=["Rotation","OffsetX","OffsetY"],h=i.filter((e=>e.primitiveName!==t.primitiveName&&-1===l.indexOf(e.propertyName))),c=(0,s.hP)(JSON.stringify(t)).toString();return n.push({type:"fill",templateHash:c,materialHash:0===i.length?c:Z(c,e,h,r),cim:t,materialOverrides:h,colorLocked:t.colorLocked,effects:t.effects,color:{r:255,g:255,b:255,a:1},height:N(a.primitiveName,e,"StepY",r,a.stepY),scaleX:1,angle:N(a.primitiveName,e,"GridAngle",r,a.gridAngle),offsetX:N(a.primitiveName,e,"OffsetX",r,a.offsetX),offsetY:N(a.primitiveName,e,"OffsetY",r,a.offsetY)}),!0}function k(t,e,i,r,n,o,a){const l=t.primitiveName,c=t.size,f=t.scaleX,u=t.rotation,m=t.offsetX,d=t.offsetY,p=(0,h.NO)(t.tintColor),y=(0,s.hP)(`${t.url}${JSON.stringify(t.colorSubstitutions)}`).toString();let _=!1,x="";for(const t of i)t.primitiveName===l&&(void 0!==t.value?x+=`-${t.primitiveName}-${t.propertyName}-${JSON.stringify(t.value)}`:t.valueExpressionInfo&&(_=!0));n.push({type:"marker",templateHash:(0,s.hP)(JSON.stringify(t)+x).toString(),materialHash:_?()=>y:y,cim:t,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:!1,alignment:o,size:N(l,e,"Size",r,c),scaleX:N(l,e,"ScaleX",r,f),rotation:N(l,e,"Rotation",r,u),offsetX:N(l,e,"OffsetX",r,m),offsetY:N(l,e,"OffsetY",r,d),color:N(l,e,"TintColor",r,p,R),anchorPoint:t.anchorPoint,isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,frameHeight:0,rotateClockwise:t.rotateClockwise,referenceSize:a,sizeRatio:1,markerPlacement:t.markerPlacement})}function O(t,e,i,s,r,n,o,a){const l=t.markerGraphics;if(!l)return;let h=0;if(t.scaleSymbolsProportionally){const e=t.frame;e&&(h=e.ymax-e.ymin)}for(const c of l)if(c){const l=c.symbol;if(!l)continue;switch(l.type){case"CIMPointSymbol":case"CIMLineSymbol":case"CIMPolygonSymbol":T(t,c,i,e,s,r,n,o,h,a);break;case"CIMTextSymbol":I(t,c,e,i,s,r,n,o,h)}}}function I(t,e,i,r,n,o,a,l,c){f.E0.findApplicableOverrides(e,r,[]);const u=e.geometry;if(!("x"in u)||!("y"in u))return;const m=e.symbol,d=(p=m).underline?"underline":p.strikethrough?"line-through":"none";var p;const x=function(t){let e="normal",i="normal";if(t){const s=t.toLowerCase();-1!==s.indexOf("italic")?e="italic":-1!==s.indexOf("oblique")&&(e="oblique"),-1!==s.indexOf("bold")?i="bold":-1!==s.indexOf("light")&&(i="lighter")}return{style:e,weight:i}}(m.fontStyleName);m.font={family:m.fontFamilyName,decoration:d,...x};const g=t.frame,M=u.x-.5*(g.xmin+g.xmax),b=u.y-.5*(g.ymin+g.ymax),w=t.size/c,v=t.primitiveName,S=(m.height||0)*w,C=m.angle||0,L=((m.offsetX||0)+M)*w,P=((m.offsetY||0)+b)*w,z=(0,h.NO)(f.B$.getFillColor(m));let k=(0,h.NO)(f.B$.getStrokeColor(m)),O=f.B$.getStrokeWidth(m);O||(k=(0,h.NO)(f.B$.getFillColor(m.haloSymbol)),O=m.haloSize*w);let I="";for(const t of r)t.primitiveName===v&&void 0!==t.value&&(I+=`-${t.primitiveName}-${t.propertyName}-${JSON.stringify(t.value)}`);const T=JSON.stringify(t.effects)+Number(t.colorLocked)+JSON.stringify(t.anchorPoint)+t.anchorPointUnits+JSON.stringify(t.markerPlacement),F=(0,s.hP)(JSON.stringify(e)+T+I).toString();o.push({type:"text",templateHash:F,materialHash:()=>(0,s.hP)(JSON.stringify(m.font)).toString(),cim:m,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,alignment:a,anchorPoint:{x:t.anchorPoint?t.anchorPoint.x:0,y:t.anchorPoint?t.anchorPoint.y:0},isAbsoluteAnchorPoint:"Relative"!==t.anchorPointUnits,fontName:m.fontFamilyName,decoration:"none",weight:"normal",style:"normal",size:N(v,i,"Size",n,S),angle:N(v,i,"Rotation",n,C),offsetX:N(v,i,"OffsetX",n,L),offsetY:N(v,i,"OffsetY",n,P),horizontalAlignment:y(m.horizontalAlignment),verticalAlignment:_(m.verticalAlignment),text:N(e.primitiveName,i,"TextString",n,e.textString,h.X3,m.textCase),color:z,outlineColor:k,outlineSize:O,referenceSize:l,sizeRatio:1,markerPlacement:t.markerPlacement})}function T(t,e,i,r,n,o,a,l,c,m){const d=e.symbol,p=e.geometry;if(!p)return;const y=d.symbolLayers;if(!y)return;if(m)return void F(t,e,r,i,n,o,a,l,c);let _=y.length;for(;_--;){const m=y[_];if(m&&!1!==m.enable)switch(m.type){case"CIMSolidFill":case"CIMSolidStroke":{const d=(0,u.bk)(p);if(!d)continue;const[y,_,x]=(0,u.UV)(d,t.frame,t.size,t.anchorPoint,"Relative"!==t.anchorPointUnits),g="CIMSolidFill"===m.type,M={type:"sdf",geom:p,asFill:g},b=t.primitiveName,w=t.size,v=t.rotation||0,S=t.offsetX,C=t.offsetY,L=m.primitiveName,P=(0,h.NO)(g?f.B$.getFillColor(m):f.B$.getStrokeColor(m)),z=g?{r:0,g:0,b:0,a:0}:(0,h.NO)(f.B$.getStrokeColor(m)),k=f.B$.getStrokeWidth(m);if(!g&&!k)break;let O=!1,I="";for(const t of i)t.primitiveName!==L&&t.primitiveName!==b||(void 0!==t.value?I+=`-${t.primitiveName}-${t.propertyName}-${JSON.stringify(t.value)}`:t.valueExpressionInfo&&(O=!0));const T=JSON.stringify({...t,markerGraphics:null}),F=(0,s.hP)(JSON.stringify(M)).toString(),D={type:"marker",templateHash:(0,s.hP)(JSON.stringify(e)+JSON.stringify(m)+T+I).toString(),materialHash:O?()=>F:F,cim:M,materialOverrides:null,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:_,y:x},isAbsoluteAnchorPoint:!1,size:N(t.primitiveName,r,"Size",n,w),rotation:N(t.primitiveName,r,"Rotation",n,v),offsetX:N(t.primitiveName,r,"OffsetX",n,S),offsetY:N(t.primitiveName,r,"OffsetY",n,C),scaleX:1,frameHeight:c,rotateClockwise:t.rotateClockwise,referenceSize:l,sizeRatio:y,color:N(L,r,"Color",n,P,R),outlineColor:N(L,r,"Color",n,z,R),outlineWidth:N(L,r,"Width",n,k),markerPlacement:t.markerPlacement};o.push(D);break}default:F(t,e,r,i,n,o,a,l,c)}}}function F(t,e,i,r,n,o,a,h,c){const u=function(t,e){return{type:t.type,enable:!0,name:t.name,colorLocked:t.colorLocked,primitiveName:t.primitiveName,anchorPoint:t.anchorPoint,anchorPointUnits:t.anchorPointUnits,offsetX:0,offsetY:0,rotateClockwise:t.rotateClockwise,rotation:0,size:t.size,billboardMode3D:t.billboardMode3D,depth3D:t.depth3D,frame:t.frame,markerGraphics:[e],scaleSymbolsProportionally:t.scaleSymbolsProportionally,respectFrame:t.respectFrame,clippingPath:t.clippingPath,effects:t.effects}}(t,e);let m=[];const d=["Rotation","OffsetX","OffsetY"];m=r.filter((e=>e.primitiveName!==t.primitiveName||-1===d.indexOf(e.propertyName)));let p="";for(const t of r)void 0!==t.value&&(p+=`-${t.primitiveName}-${t.propertyName}-${JSON.stringify(t.value)}`);const[y,_,x]=f.B$.getTextureAnchor(u),g=t.primitiveName,M=t.rotation||0,b=t.offsetX||0,w=t.offsetY||0,v=(0,s.hP)(JSON.stringify(u)+p).toString(),S={type:"marker",templateHash:v,materialHash:0===m.length?v:Z(v,i,m,n),cim:u,materialOverrides:m,colorLocked:t.colorLocked,effects:t.effects,scaleSymbolsProportionally:t.scaleSymbolsProportionally,alignment:a,anchorPoint:{x:y,y:_},isAbsoluteAnchorPoint:!1,size:t.size,rotation:N(g,i,"Rotation",n,M),offsetX:N(g,i,"OffsetX",n,b),offsetY:N(g,i,"OffsetY",n,w),color:{r:0,g:0,b:0,a:0},outlineColor:{r:0,g:0,b:0,a:0},outlineWidth:0,scaleX:1,frameHeight:c,rotateClockwise:t.rotateClockwise,referenceSize:h,sizeRatio:x/(0,l.F2)(t.size),markerPlacement:t.markerPlacement};o.push(S)}function D(t){if(t&&0===t.indexOf("Level_")){const e=parseInt(t.substr(6),10);if(NaN!==e)return e}return 0}function R(t){if(!t||0===t.length)return null;const e=new a.Z(t).toRgba();return{r:e[0],g:e[1],b:e[2],a:e[3]}}function N(t,e,i,s,r,n,a){const l=e[t];if(l){const t=l[i];if("string"==typeof t||"number"==typeof t||t instanceof Array)return n?n.call(null,t,a):t;if(null!=t&&t instanceof o.mz)return(e,i,o)=>{let l=(0,c.Z)(t,e,{$view:o},s.geometryType,i);return null!==l&&n&&(l=n.call(null,l,a)),null!==l?l:r}}return r}function Z(t,e,i,r){for(const t of i)if(t.valueExpressionInfo){const i=e[t.primitiveName]&&e[t.primitiveName][t.propertyName];i instanceof o.mz&&(t.fn=(t,e,s)=>(0,c.Z)(i,t,{$view:s},r.geometryType,e))}return(e,r,n)=>{for(const t of i)t.fn&&(t.value=t.fn(e,r,n));return(0,s.hP)(t+f.E0.buildOverrideKey(i)).toString()}}function A(t,e){if(!e||0===e.length)return t;const i=JSON.parse(JSON.stringify(t));return f.E0.applyOverrides(i,e),i}},79265:(t,e,i)=>{"use strict";i.d(e,{B:()=>c});i(39105);var s=i(19128),r=(i(54734),i(93318)),n=i(31514),o=i(9709);const a={marker:n.LW.MARKER,fill:n.LW.FILL,line:n.LW.LINE,text:n.LW.TEXT};class l{constructor(t,e,i){this.layers=t,this.data=e,this.hash=this._createHash(),this.rendererKey=i;for(const e of t){const t=a[e.type];e.materialKey=(0,o.jj)(t,this.rendererKey,!1,!1)}}get type(){return"expanded-cim"}_createHash(){let t="";for(const e of this.layers)t+=e.templateHash;return t}}const h=async(t,e)=>new l(await(0,r.c)(t.data,e),t.data,t.rendererKey),c=async(t,e,i)=>{if(!t)return null;if("cim"===t.type)return h(t,e);if("web-style"===t.type){const r=s.Z.fromJSON(t),n={type:"cim",data:(await r.fetchCIMSymbol(i)).data,rendererKey:t.rendererKey};return h(n,e)}return t}},7051:(t,e,i)=>{"use strict";i.d(e,{i:()=>n});var s=i(76074),r=i(50105);class n{static getPlacement(t,e,i){const n=(0,r.W)(e);if(!n)return null;const o=(0,s.GP)(t);return n.execute(o,e,i)}}},19546:(t,e,i)=>{"use strict";function s(t,e,i){const s=t=>{let e=t.length;for(;e--;)if(-1===" /-,\n".indexOf(t.charAt(e)))return!1;return!0},n=[];let o=0,a=-1;do{if(a=e.indexOf("[",o),a>=o){if(a>o){const t=e.substr(o,a-o);n.push([t,null,s(t)])}if(o=a+1,a=e.indexOf("]",o),a>=o){if(a>o){const i=t[e.substr(o,a-o)];i&&n.push([null,i,!1])}o=a+1}}}while(-1!==a);if(o<e.length-1){const t=e.substr(o);n.push([t,null,s(t)])}return t=>{let e="",s=null;for(const i of n){const[r,n,o]=i;if(r)o?s=r:(s&&(e+=s,s=null),e+=r);else{const i=t.attributes[n];i&&(s&&(e+=s,s=null),e+=i)}}return r(e,i)}}function r(t,e){switch("string"!=typeof t&&(t=String(t)),e){case"LowerCase":return t.toLowerCase();case"Allcaps":return t.toUpperCase();default:return t}}function n(t,e,i,s,r,n,o=!0){const a=e/r,l=i/n,h=Math.ceil(a/2),c=Math.ceil(l/2);for(let i=0;i<n;i++)for(let f=0;f<r;f++){const u=4*(f+(o?n-i-1:i)*r);let m=0,d=0,p=0,y=0,_=0,x=0,g=0;const M=(i+.5)*l;for(let s=Math.floor(i*l);s<(i+1)*l;s++){const i=Math.abs(M-(s+.5))/c,r=(f+.5)*a,n=i*i;for(let i=Math.floor(f*a);i<(f+1)*a;i++){let o=Math.abs(r-(i+.5))/h;const a=Math.sqrt(n+o*o);a>=-1&&a<=1&&(m=2*a*a*a-3*a*a+1,m>0&&(o=4*(i+s*e),g+=m*t[o+3],p+=m,t[o+3]<255&&(m=m*t[o+3]/250),y+=m*t[o],_+=m*t[o+1],x+=m*t[o+2],d+=m))}}s[u]=y/d,s[u+1]=_/d,s[u+2]=x/d,s[u+3]=g/p}}function o(t){return t?{r:t[0],g:t[1],b:t[2],a:t[3]/255}:{r:0,g:0,b:0,a:0}}i.d(e,{X3:()=>r,Qs:()=>s,NO:()=>o,TT:()=>n})},49723:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(36544),r=i(32656),n=i(78712);const o=new Map,a=function(t,e,i,a,l){const h=t.referencesGeometry()&&l?function(t,e,i){const{transform:a,hasZ:l,hasM:h}=i;o.has(e)||o.set(e,function(t){const e={};switch(t){case"esriGeometryPoint":return(t,i,s,r)=>(0,n.U1)(i,e,t,s,r);case"esriGeometryPolygon":return(t,i,s,r)=>(0,n.Ie)(i,e,t,s,r);case"esriGeometryPolyline":return(t,i,s,r)=>(0,n.G6)(i,e,t,s,r);case"esriGeometryMultipoint":return(t,i,s,r)=>(0,n.J9)(i,e,t,s,r);default:return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").error(new r.Z("mapview-arcade",`Unable to handle geometryType: ${t}`)),t=>t}}(e));const c=o.get(e)(t.geometry,a,l,h);return{...t,geometry:c}}(e,a,l):e,c=t.repurposeFeature(h);try{return t.evaluate({...i,$feature:c})}catch(t){return s.Z.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",t),null}}},634:(t,e,i)=>{"use strict";i.d(e,{Z:()=>a});var s=i(43862),r=i(78787),n=i(19310);class o{constructor(t){this.insertAfter=null,this.id=t,this.displayRecords=[],this.metrics=[]}copy(){const t=new o(this.id);return t.set(this),t}clone(){const t=new o(this.id);return t.displayRecords=this.displayRecords.map((t=>t.clone())),t.metrics=this.metrics.map((t=>t.clone())),t.insertAfter=this.insertAfter,t}set(t){this.id=t.id,this.displayRecords=t.displayRecords,this.metrics=t.metrics,this.insertAfter=t.insertAfter}serialize(t){return t.push(this.id),(0,r.G)(t,this.metrics),(0,r.G)(t,this.displayRecords),t}static deserialize(t){const e=t.readInt32(),i=new o(e),a={id:e},l=(0,r.h)(t,n.Z);return l.length&&(i.metrics=l),i.displayRecords=(0,r.h)(t,s.Z,a),i}}const a=o},43862:(t,e,i)=>{"use strict";i.d(e,{Z:()=>o});var s=i(83302);const r=class{constructor(){this.vertexData=new Map,this.vertexCount=0,this.indexData=[]}clear(){this.vertexData.clear(),this.vertexCount=0,this.indexData=[]}update(t,e,i){for(const e in t)this.vertexData.set(e,t[e]);for(const e in this.vertexData)null===t[e]&&this.vertexData.delete(e);this.vertexCount=e,this.indexData=i}};class n{constructor(t,e,i,s=0,r=0){this.id=t,this.geometryType=e,this.materialKey=i,this.minZoom=s,this.maxZoom=r,this.meshData=null,this.symbolLevel=0,this.zOrder=0,this.vertexFrom=0,this.vertexCount=0,this.indexFrom=0,this.indexCount=0}get sortKey(){return void 0===this._sortKey&&this._computeSortKey(),this._sortKey}clone(){return this.copy()}copy(){const t=new n(this.id,this.geometryType,this.materialKey);return t.vertexFrom=this.vertexFrom,t.vertexCount=this.vertexCount,t.indexFrom=this.indexFrom,t.indexCount=this.indexCount,t.zOrder=this.zOrder,t.symbolLevel=this.symbolLevel,t.meshData=this.meshData,t.minZoom=this.minZoom,t.maxZoom=this.maxZoom,t}setMeshDataFromBuffers(t,e,i){const n=new r;for(const i in e){const r=e[i].stride,o=e[i].data,a=[],l=(0,s.Y8)(r);for(let e=0;e<r*t.vertexCount/l;++e)a[e]=o[e+r*t.vertexFrom/l];n.vertexData.set(i,a)}n.indexData.length=0;for(let e=0;e<t.indexCount;++e)n.indexData[e]=i[e+t.indexFrom]-t.vertexFrom;n.vertexCount=t.vertexCount,this.meshData=n}readMeshDataFromBuffers(t,e){this.meshData?this.meshData.clear():this.meshData=new r;for(const e in t){const i=t[e].stride,r=t[e].data,n=[],o=(0,s.Y8)(i);for(let t=0;t<i*this.vertexCount/o;++t)n[t]=r[t+i*this.vertexFrom/o];this.meshData.vertexData.set(e,n)}this.meshData.indexData.length=0;for(let t=0;t<this.indexCount;++t)this.meshData.indexData[t]=e[t+this.indexFrom]-this.vertexFrom;this.meshData.vertexCount=this.vertexCount}writeMeshDataToBuffers(t,e,i,r){for(const i in e){const r=e[i].stride,n=this.meshData.vertexData.get(i),o=e[i].data,a=(0,s.Y8)(r);for(let e=0;e<r*this.meshData.vertexCount/a;++e)o[e+r*t/a]=n[e]}for(let e=0;e<this.meshData.indexData.length;++e)r[e+i]=this.meshData.indexData[e]+t;this.vertexFrom=t,this.vertexCount=this.meshData.vertexCount,this.indexFrom=i,this.indexCount=this.meshData.indexData.length}static writeAllMeshDataToBuffers(t,e,i){let s=0,r=0;for(const n of t)n.writeMeshDataToBuffers(s,e,r,i),s+=n.vertexCount,r+=n.indexCount}_computeSortKey(){this._sortKey=(31&this.symbolLevel)<<12|(127&this.zOrder)<<4|7&this.geometryType}serialize(t){return t.push(this.geometryType),t.push(this.materialKey),t.push(this.vertexFrom),t.push(this.vertexCount),t.push(this.indexFrom),t.push(this.indexCount),t.push(this.minZoom),t.push(this.maxZoom),t}static deserialize(t,e){const i=t.readInt32(),s=t.readInt32(),r=new n(e.id,i,s);return r.vertexFrom=t.readInt32(),r.vertexCount=t.readInt32(),r.indexFrom=t.readInt32(),r.indexCount=t.readInt32(),r.minZoom=t.readInt32(),r.maxZoom=t.readInt32(),r}}const o=n},19310:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var s=i(36544),r=i(71286),n=i(27851),o=i(30026),a=i(78787);const l=s.Z.getLogger("esri/views/2d/engine/webgl/collisions/Metric");class h{constructor(t,e,i,s,r){this.id=t,this.range=e,this.boxes=null,this.minZoom=-1,this.size=0,this.directionX=0,this.directionY=0,this.offsetX=0,this.offsetY=0,this.placementPadding=0,this.anchor=(0,n.f)(i,s),this.baseZoom=r}add(t,e,i){t.x=t.x+e,t.y=t.y+i,this.bounds?this.boxes?(this.boxes.push(t),this.bounds.extend(t)):(this.boxes=[this.bounds,t],this.bounds=this.bounds.clone(),this.bounds.extend(t)):this.bounds=t}computeIndex(){const t=this.anchor[0],e=this.anchor[1],i=Math.floor(t/r.V8),s=Math.floor(e/r.V8);this.xBucket=i,this.yBucket=s;const n=r.I_/r.V8;if(this.hasVV)return this.xOverflow=n,void(this.yOverflow=n);this.xOverflow=Math.min(n,Math.ceil(2*this.bounds.width/r.V8)),this.yOverflow=Math.min(n,Math.ceil(2*this.bounds.height/r.V8))}findCollisionDelta(t){const e=this.bounds.findCollisionDelta(t.bounds),i=this.boxes&&this.boxes.length,s=t.boxes&&t.boxes.length;return Math.abs(e)>r.o4||!i&&!s?e:i&&s?this._boxesToBoxes(t):i?this._boxesToBox(t):this._boxToBoxes(t)}computeVVOffset(t,e){e||l.error("mapview-labeling",`Unable to compute label offset. Expected an evaluator function but found ${e}`);let i=this.size;if(this.hasVV){const s=e(t);i=isNaN(s)||null==s||s===1/0?this.size:s}this._computeOffset(i)}setPlacementOffset(t,e,i,s,r){this.hasVV=t,this.size=e,this.placementPadding=Math.round(i),this.directionX=s,this.directionY=r}clone(){const t=new h(this.id,this.range,this.anchor[0],this.anchor[1],this.baseZoom);return t.minZoom=this.minZoom,this.bounds&&(t.bounds=this.bounds.clone()),this.boxes&&(t.boxes=this.boxes.map((t=>t.clone()))),t.xBucket=this.xBucket,t.yBucket=this.yBucket,t.xOverflow=this.xOverflow,t.yOverflow=this.yOverflow,t.hasVV=this.hasVV,t.size=this.size,t.directionX=this.directionX,t.directionY=this.directionY,t.offsetX=this.offsetX,t.offsetY=this.offsetY,t}_boxToBoxes(t){let e=-1/0;for(const i of t.boxes){const t=this.bounds.findCollisionDelta(i);e=Math.max(t,e)}return e}_boxesToBox(t){let e=this.boxes[0].findCollisionDelta(t.bounds);for(let i=1;i<this.boxes.length;i++){const s=this.boxes[i].findCollisionDelta(t.bounds);e=Math.max(s,e)}return e}_boxesToBoxes(t){let e=-1/0;for(let i=0;i<this.boxes.length;i++){const s=this.boxes[i];for(const i of t.boxes){const t=s.findCollisionDelta(i);e=Math.max(t,e)}}return e}_computeOffset(t){this.offsetX=this.directionX*(t/2+this.placementPadding),this.offsetY=this.directionY*(t/2+this.placementPadding)}serialize(t){return t.push(this.id),this.bounds.serialize(t),t.push(this.range.from),t.push(this.range.count),t.push(this.anchor[0]),t.push(this.anchor[1]),t.push(this.baseZoom),t.push(this.hasVV?1:0),t.push(this.size),t.writeF32(this.directionX),t.writeF32(this.directionY),t.push(this.offsetX),t.push(this.offsetY),t.push(this.placementPadding),(0,a.G)(t,this.boxes),t}static deserialize(t){const e=t.readInt32(),i=o.Z.deserialize(t),s={from:t.readInt32(),count:t.readInt32()},r=t.readInt32(),n=t.readInt32(),l=t.readInt32(),c=t.readInt32(),f=t.readInt32(),u=t.readF32(),m=t.readF32(),d=t.readInt32(),p=t.readInt32(),y=t.readInt32(),_=(0,a.h)(t,o.Z),x=new h(e,s,r,n,l);return x.bounds=i,x.boxes=_,x.setPlacementOffset(!!c,f,y,u,m),x.offsetX=d,x.offsetY=p,x.computeIndex(),c||x._computeOffset(f),x}}const c=h},76939:(t,e,i)=>{"use strict";i.d(e,{_:()=>h});var s=i(43862),r=i(78787),n=i(19310),o=i(634);const a=class{constructor(t){this._pos=0,this._buffer=t,this._i32View=new Int32Array(this._buffer),this._f32View=new Float32Array(this._buffer)}readInt32(){return this._i32View[this._pos++]}readF32(){return this._f32View[this._pos++]}};var l=i(7637);class h{constructor(t,e){this.vertexVectorsMap=t,this._currentIndex=-1,this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[];const i=4*(4*e.features+1),s=4*(8*e.records+1),r=4*(20*e.metrics+1);this._bufDisplayObjects=new l.Z(Uint32Array,i+4),this._bufDisplayRecords=new l.Z(Uint32Array,s+4),this._bufMetrics=new l.Z(Uint32Array,r+4),this._bufDisplayObjects.push(0),this._bufDisplayRecords.push(0),this._bufMetrics.push(0)}get vertexBuffersMap(){if(!this._vertexBuffersMap){this._vertexBuffersMap={};for(let t=0;t<this.vertexVectorsMap.length;t++)this._vertexBuffersMap[t]=this.vertexVectorsMap[t].intoBuffers();this.vertexVectorsMap=null}return this._vertexBuffersMap}get(t){return this.vertexVectorsMap[t]}currentDisplayRecordCount(){return this._bufDisplayRecords[this._currentRecordOffset]}writeDisplayObject(t,e){this._bufDisplayObjects.incr(0),this._currentIndex=this._bufDisplayObjects.push(t),this._bufDisplayObjects.push(e),this._bufDisplayObjects.push(0),this._bufDisplayObjects.push(0),this._currentRecordOffset=0,this._currentMetricOffset=0,this._currentMetrics=[]}hasDisplayRecords(){return!(0===this._currentRecordOffset)}endDisplayObject(){this.hasDisplayRecords()?this._currentMetrics&&(0===this._currentMetricOffset&&(this._bufDisplayObjects.setValue(this._currentIndex+3,this._bufMetrics.length),this._currentMetricOffset=this._bufMetrics.length),(0,r.G)(this._bufMetrics,this._currentMetrics)):this._rollbackDisplayObject()}writeDisplayRecord(t,e,i,s,r,n,o=0,a=0){0===this._currentRecordOffset&&(this._currentRecordOffset=this._bufDisplayRecords.push(0),this._bufDisplayObjects.setValue(this._currentIndex+2,this._currentRecordOffset)),this._bufDisplayRecords.incr(this._currentRecordOffset),this._bufDisplayRecords.push(t),this._bufDisplayRecords.push(e),this._bufDisplayRecords.push(i),this._bufDisplayRecords.push(s),this._bufDisplayRecords.push(r),this._bufDisplayRecords.push(n),this._bufDisplayRecords.push(o),this._bufDisplayRecords.push(a)}writeMetrics(t){t&&this._currentMetrics.push(...t)}static deserializeDisplayObjects(t){const{bufDisplayObjects:e,bufMetrics:i,bufRecords:l}=t,h=new a(e),c=new a(l),f=new a(i),u=[];let m=h.readInt32();for(c.readInt32(),f.readInt32();m--;){const t=h.readInt32(),e=h.readInt32(),i=h.readInt32(),a=h.readInt32(),l=new o.Z(t);0!==e&&(l.insertAfter=e),0!==i&&(l.displayRecords=(0,r.h)(c,s.Z,{id:t})),0!==a&&(l.metrics=(0,r.h)(f,n.Z)),u.push(l)}return u}encode(t,e){const i={};for(let t=0;t<this.vertexVectorsMap.length;t++){const s=this.vertexVectorsMap[t];i[t]={},s.transfer(i[t],e)}t.bufDisplayObjects=this._bufDisplayObjects.buffer(),t.bufRecords=this._bufDisplayRecords.buffer(),t.bufMetrics=this._bufMetrics.buffer(),e.push(t.bufDisplayObjects),e.push(t.bufMetrics),e.push(t.bufRecords),t.vertexBuffersMap=i,this.destroy()}destroy(){this.vertexVectorsMap=null,this._bufDisplayObjects=null,this._bufDisplayRecords=null,this._bufMetrics=null}_rollbackDisplayObject(){this._bufDisplayObjects.decr(0),this._bufDisplayObjects.seek(this._bufDisplayObjects.length-4),this._currentIndex=this._bufDisplayObjects.length}}},65767:(t,e,i)=>{"use strict";i.d(e,{g:()=>n});var s=i(83302);class r{constructor(t,e,i){this.data=t,this.stride=e,this.vertexCount=i}static decode(t){const e=(0,s.e2)(t.data,t.stride),i=t.stride,n=t.vertexCount;return new r(e,i,n)}static fromVertexVector(t){const e=(0,s.e2)(t.data.buffer(),t.stride),i=t.stride,n=t.vertexCount;return new r(e,i,n)}}class n{constructor(t,e,i){this.geometryType=t,this.indexBuffer=new Uint32Array(e),this.namedBuffers=i}static decode(t){const e=t.geometryType,i=t.indexBuffer,s={};for(const e in t.namedBuffers)s[e]=r.decode(t.namedBuffers[e]);return new n(e,i,s)}static fromVertexVectors(t){const e=t.geometryType,i=t.indexVector.buffer(),s={};for(const e in t.namedVectors)s[e]=r.fromVertexVector(t.namedVectors[e]);return new n(e,i,s)}}},29342:(t,e,i)=>{"use strict";i.d(e,{j:()=>J});i(95830);var s=i(59472),r=i(39105),n=i(71286),o=i(31514),a=i(76939),l=i(83302),h=i(7637),c=i(65767);class f{constructor(t,e){this.data=t,this.stride=e}get vertexCount(){const t=this.stride/4,e=this.data.length/t;return e!==(0|e)&&console.debug("Corrupted stride"),e}transfer(t,e){const i=this.data.buffer();t.vertexCount=this.vertexCount,t.data=i,t.stride=this.stride,e.push(i)}}class u{constructor(t,e,i=!1){this.geometryType=t,this.indexVector=new h.Z(Uint32Array,6*e),this.namedVectors={};const s=(0,l.$_)(t,i);for(const t in s){const i=s[t];let r;switch(i%4){case 0:case 2:r=new h.Z(Uint32Array,i*e);break;case 1:case 3:r=new h.Z(Uint8Array,i*e)}this.namedVectors[t]=new f(r,i)}}get(t){return this.namedVectors[t].data}getVector(t){return this.namedVectors[t]}transfer(t,e){const i=this.indexVector.buffer(),s={};e.push(i);for(const t in this.namedVectors){const i=this.namedVectors[t];s[t]={},i.transfer(s[t],e)}t.geometryType=this.geometryType,t.indexBuffer=i,t.namedBuffers=s,this.destroy()}intoBuffers(){const t=c.g.fromVertexVectors(this);return this.destroy(),t}destroy(){this.indexVector=null,this.namedVectors=null}}var m=i(36544),d=i(32656),p=i(33655),y=i(96071),_=i(32651),x=i(53986),g=i(49269),M=i(9709),b=i(51482),w=i(19310),v=i(33577);function S(t){return t.length-1}function C(t){let e=0;for(let i=0;i<S(t);i++)e+=L(t,i);return e}function L(t,e,i=1){const[s,r]=function(t,e){return t[e+1]}(t,e);return Math.sqrt(s*s+r*r)*i}class P{constructor(t,e,i,s,r){this._segments=t,this._index=e,this._distance=i,this._xStart=s,this._yStart=r,this._done=!1}static create(t){return new P(t,0,0,t[0][0],t[0][1])}clone(){return new P(this._segments,this._index,this._distance,this.xStart,this.yStart)}equals(t){return this._index===t._index||t._index===this._index-1&&(0===this._distance||1===t._distance)||t._index===this._index+1&&(1===this._distance||0===t._distance)}leq(t){return this._index<t._index||this._index===t._index&&this._distance<=t._distance}geq(t){return this._index>t._index||this._index===t._index&&this._distance>=t._distance}get _segment(){return this._segments[this._index+1]}get angle(){const t=this.dy,e=(0*t+-1*-this.dx)/(1*this.length);let i=Math.acos(e);return t>0&&(i=2*Math.PI-i),i}get xStart(){return this._xStart}get yStart(){return this._yStart}get x(){return this.xStart+this.distance*this.dx}get y(){return this.yStart+this.distance*this.dy}get dx(){return this._segment[0]}get dy(){return this._segment[1]}get xMidpoint(){return this.xStart+.5*this.dx}get yMidpoint(){return this.yStart+.5*this.dy}get xEnd(){return this.xStart+this.dx}get yEnd(){return this.yStart+this.dy}get length(){const{dx:t,dy:e}=this;return Math.sqrt(t*t+e*e)}get remainingLength(){return this.length*(1-this._distance)}get backwardLength(){return this.length*this._distance}get distance(){return this._distance}get done(){return this._done}hasPrev(){return this._index-1>=0}hasNext(){return this._index+1<S(this._segments)}next(){return this.hasNext()?(this._xStart+=this.dx,this._yStart+=this.dy,this._distance=0,this._index+=1,this):null}prev(){return this.hasPrev()?(this._index-=1,this._xStart-=this.dx,this._yStart-=this.dy,this._distance=1,this):(this._done=!0,null)}_seekBackwards(t,e){const i=this.backwardLength;if(t<=i)return this._distance=(i-t)/this.length,this;let s=this.backwardLength;for(;this.prev();){if(s+this.length>t)return this._seekBackwards(t-s);s+=this.length}return this._distance=0,e?this:null}seek(t,e=!1){if(t<0)return this._seekBackwards(Math.abs(t),e);if(t<=this.remainingLength)return this._distance=(this.backwardLength+t)/this.length,this;let i=this.remainingLength;for(;this.next();){if(i+this.length>t)return this.seek(t-i,e);i+=this.length}return this._distance=1,e?this:null}}function z(t,e,i){const s=C(t),r=P.create(t),n=s/2,o=(s-e)/2,a=Math.floor(o/e),l=n-a*e;r.seek(l);for(let t=-a;t<=a;t++)r.x<512&&r.x>=0&&r.y<512&&r.y>=0&&i(r.clone(),t,n+t*e,s),r.seek(e)}function k(t,e){const i=1e-6;if(e<=0)return;const s=t.length;if(s<3)return;const r=[];let n=0;r.push(0);for(let e=1;e<s;e++)n+=(0,v.TK)(t[e],t[e-1]),r.push(n);e=Math.min(e,.2*n);const o=[];o.push(t[0][0]),o.push(t[0][1]);const a=t[s-1][0],l=t[s-1][1],h=(0,v.lu)([0,0],t[0],t[1]);(0,v.Fv)(h),t[0][0]+=e*h[0],t[0][1]+=e*h[1],(0,v.lu)(h,t[s-1],t[s-2]),(0,v.Fv)(h),t[s-1][0]+=e*h[0],t[s-1][1]+=e*h[1];for(let t=1;t<s;t++)r[t]+=e;r[s-1]+=e;const c=.5*e;for(let n=1;n<s-1;n++){let a=0,l=0,h=0;for(let s=n-1;s>=0&&!(r[s+1]<r[n]-c);s--){const o=c+r[s+1]-r[n],f=r[s+1]-r[s],u=r[n]-r[s]<c?1:o/f;if(Math.abs(u)<i)break;const m=u*u,d=u*o-.5*m*f,p=u*f/e,y=t[s+1],_=t[s][0]-y[0],x=t[s][1]-y[1];a+=p/d*(y[0]*u*o+.5*m*(o*_-f*y[0])-m*u*f*_/3),l+=p/d*(y[1]*u*o+.5*m*(o*x-f*y[1])-m*u*f*x/3),h+=p}for(let o=n+1;o<s&&!(r[o-1]>r[n]+c);o++){const s=c-r[o-1]+r[n],f=r[o]-r[o-1],u=r[o]-r[n]<c?1:s/f;if(Math.abs(u)<i)break;const m=u*u,d=u*s-.5*m*f,p=u*f/e,y=t[o-1],_=t[o][0]-y[0],x=t[o][1]-y[1];a+=p/d*(y[0]*u*s+.5*m*(s*_-f*y[0])-m*u*f*_/3),l+=p/d*(y[1]*u*s+.5*m*(s*x-f*y[1])-m*u*f*x/3),h+=p}o.push(a/h),o.push(l/h)}o.push(a),o.push(l);for(let e=0,i=0;e<s;e++)t[e][0]=o[i++],t[e][1]=o[i++]}var O=i(37521);const I=m.Z.getLogger("esri.views.2d.engine.webgl.WGLLabelTemplate"),T=function(t){const e=new Map;return t=>(e.has(t)||e.set(t,(t=>{let e=0;if(0===t)return 1/0;for(;!(t%2);)e++,t/=2;return e})(t)),e.get(t))}(),F=t=>Math.floor(127*t+127),D=t=>Math.floor(10*t),R=t=>Math.round(t*(254/360)),N=(t,e)=>(0,x.UJ)(Math.round(8*t),Math.round(8*e));class Z extends O.Z{constructor(t,e,i,s){super(t,i.font.size,i.haloSize||0,i.color&&(0,b.aH)(i.color)||0,i.haloColor&&(0,b.aH)(i.haloColor)||0,i.horizontalAlignment,i.verticalAlignment,(0,g.N)(e.labelPlacement)?1:0,i.font.decoration,!1,i.angle||0,i.xoffset,i.yoffset,i.lineWidth,i.lineHeight,null,null),this._outLineLabelAngle=0,this._refPlacementPadding=0,this._refPlacementDirX=0,this._refPlacementDirY=0,this._refOffsetX=0,this._refOffsetY=0,this.geometryType=o.LW.LABEL;const r=function(t,e){const i=!!t.minScale&&e.scaleToZoom(t.minScale)||0;return(0,p.uZ)(i,0,25.5)}(e,s),a=function(t,e){const i=!!t.maxScale&&e.scaleToZoom(t.maxScale)||255;return(0,p.uZ)(i,0,25.5)}(e,s),l=e.labelPlacement,[h,c]=(0,_.qv)(l);this._xAlignD=h,this._yAlignD=c,this._minZoom=r,this._maxZoom=a,this._refPlacementPadding=(0,y.F2)(i.haloSize)+n.Iw;const f=M.Gq.load(t);f.sdf=!0,this._materialKey=f.data}static fromLabelClass(t,e){if("center-along"===t.labelPlacement){const e=t.symbol;e.xoffset=0,e.yoffset=0,e.angle=0,e.font.decoration="none"}return new Z(t.materialKey,t,t.symbol,e)}get _shapedBox(){return(0,s.Wg)(this._shapingInfo).bounds}bindReferenceTemplate(t){let e=(0,_.g)(this._xAlignD),i=(0,_.tf)(this._yAlignD);if(this._refOffsetX=0,this._refOffsetY=0,(0,s.Wi)(t))return void(this._refSymbolAndPlacementOffset=(0,x.Jz)(0,0,F(e),F(i)));if("circle"===t.boundsType&&(e||i)){const t=Math.sqrt(e*e+i*i);e/=t,i/=t}const r=Math.max(t.height,t.width),n=4*this._refPlacementPadding;this._refSymbolAndPlacementOffset=(0,x.Jz)(n,r,F(e),F(i)),this._referenceSize=r,this._refPlacementDirX=e,this._refPlacementDirY=i,this._refOffsetX=t.xOffset,this._refOffsetY=t.yOffset}writeMesh(t,e,i,r,n,o){if((0,s.Wi)(this._shapingInfo))return;const a=new Array,l=this._shapingInfo,h="esriGeometryPolygon"===i.geometryType?i.readLegacyCentroid():i.readLegacyGeometry();if(h){switch(this.current={out:t,outVecs:e,outMetrics:a,inId:n,inShaping:l,zoomLevel:o},r){case"esriGeometryPolyline":this._placeLineLabels(h);break;case"esriGeometryPoint":case"esriGeometryPolygon":this._placePointLabels(h);break;default:((t,e="mapview-labeling")=>{I.error(new d.Z(e,t))})("mapview-labeling",`Geometry of type ${r} is not supported`)}t.writeMetrics(this.current.outMetrics)}}_isVisible(t,e){const i=D(this.current.zoomLevel);return D(t)<=i&&i<=D(e)}_placePointLabels(t){const{out:e,outVecs:i,outMetrics:s,inId:r}=this.current;this._writeGlyphs(e,i,r,t,s)}_placeLineLabels(t){const e=function(t,e){const i=e;for(let e=0;e<t.length;e++){let s=t[e];const r=[];r.push(s[0]);for(let t=1;t<s.length;t++){let[e,i]=r[t-1];e+=s[t][0],i+=s[t][1],r.push([e,i])}k(r,i);const n=[];n.push(r[0]);for(let t=1;t<r.length;t++){const[e,i]=r[t-1],[s,o]=r[t],a=Math.round(s-e),l=Math.round(o-i);n.push([a,l])}t[e]=n,s=n}return t}(t.paths,this.current.inShaping.bounds.width),i=this._placeSubdivGlyphs.bind(this),s=(this._shapedBox.width+128)/4;for(const t of e)z(t,s,i)}_placeSubdivGlyphs(t,e,i,s){const r=T(e),n=this._shapedBox.width/4,o=Math.min(i,s-i),a=(0,p.k3)(o/(4+n/2)),l=0===e?a:Math.min(r,a),h=Math.max(this._minZoom,this.current.zoomLevel+2-l),c=this.current.zoomLevel-h,f=this._shapedBox.width/2*Math.pow(2,c);this.current.inShaping.isMultiline?0===e&&this._placeStraight(t,h):this._placeCurved(t,h,f)}_placeStraight(t,e){const{out:i,outVecs:s,outMetrics:r,inId:n}=this.current;this._writeGlyphs(i,s,n,t,r,e)}_placeCurved(t,e,i){const s={from:this.current.out.currentDisplayRecordCount(),count:-1},r=new w.Z(this.current.inId,s,t.x,t.y,e),n=t.clone(),o=t.angle*(180/Math.PI)%360,a=(t.angle*(180/Math.PI)+180)%360;this._outLineLabelAngle=R(o),this._placeFirst(n,r,e,1),this._placeBack(t,n,r,e,i,1),this._placeForward(t,n,r,e,i,1),this._outLineLabelAngle=R(a),this._placeFirst(n,r,e,0),this._placeBack(t,n,r,e,i,0),this._placeForward(t,n,r,e,i,0),r.range.count=this.current.out.currentDisplayRecordCount()-r.range.from,r.bounds&&this.current.outMetrics.push(r)}_placeBack(t,e,i,s,r,n){const o=t.clone();let a=t.backwardLength+0;for(;o.prev()&&!(a>=r);)this._placeOnSegment(o,e,i,a,s,-1,n),a+=o.length+0}_placeForward(t,e,i,s,r,n){const o=t.clone();let a=t.remainingLength+0;for(;o.next()&&!(a>=r);)this._placeOnSegment(o,e,i,a,s,1,n),a+=o.length+0}_placeFirst(t,e,i,s){const r=t,n=this.current.inShaping,o=n.glyphs,a=this.current.zoomLevel,{out:l,outVecs:h,inId:c}=this.current,f=N(r.x,r.y);for(const r of o){const o=r.x>n.bounds.x?s:1-s,u=o*t.remainingLength+(1-o)*t.backwardLength,m=Math.abs(r.x+r.width/2-n.bounds.x),d=Math.max(0,a+(0,p.k3)(m/(u+0))),y=Math.max(i,d);r.maxZoom=25,r.angle=t.angle+(1-s)*Math.PI,r.minZoom=y,this._writeGlyph(l,h,r,c,f),s&&this._isVisible(r.minZoom,r.maxZoom)&&e.add(r.bounds,0,0)}}_placeOnSegment(t,e,i,s,r,n,o){const a=this.current.inShaping.glyphs,{out:l,outVecs:h,inId:c}=this.current,f=this.current.inShaping,u=this.current.zoomLevel,m=t.dx/t.length,d=t.dy/t.length,y={x:t.x+s*-n*m,y:t.y+s*-n*d},_=N(y.x,y.y);for(const m of a){const a=m.x>f.bounds.x?o:1-o;if(!(a&&1===n||!a&&-1===n))continue;const d=Math.abs(m.x+m.width/2-f.bounds.x),y=Math.max(0,u+(0,p.k3)(d/s)-.1),x=Math.max(r,u+(0,p.k3)(d/(s+t.length+0)));0!==y&&(m.angle=t.angle+(1-o)*Math.PI,m.minZoom=x,m.maxZoom=y,this._writeGlyph(l,h,m,c,_),o&&this._isVisible(m.minZoom,m.maxZoom)&&i.add(m.bounds,t.x-e.x,t.y-e.y))}}_writeGlyphs(t,e,i,r,n,o=this._minZoom){const a=this._shapingInfo;if((0,s.Wi)(a))return;if(r.x<0||r.x>=512||r.y<0||r.y>=512)return;const l=t.currentDisplayRecordCount(),h=N(r.x+this._refOffsetX,r.y-this._refOffsetY),c=new w.Z(i,{from:l,count:-1},r.x+this._refOffsetX,r.y-this._refOffsetY,o);for(const s of a.glyphs)s.minZoom=o,s.maxZoom=this._maxZoom,this._writeGlyph(t,e,s,i,h);c.range.count=t.currentDisplayRecordCount()-c.range.from,c.bounds=a.boundsT;const f=M.Gq.load(this._materialKey),u=this._refPlacementDirX,m=this._refPlacementDirY,d=f.vvSizeFieldStops||f.vvSizeMinMaxValue||f.vvSizeScaleStops||f.vvSizeUnitValue;c.setPlacementOffset(d,this._referenceSize,this._refPlacementPadding,u,m),n.push(c)}_writeGlyph(t,e,i,s,r){const n=M.m2.load(this._materialKey);n.textureBinding=i.textureBinding;const o=e.indexVector.length,a=e.getVector("geometry").vertexCount,l=this._writeIndices(e),h=this._writeVertex(e,s,r,i);t.writeDisplayRecord(this.geometryType,n.data,a,h,o,l)}_writeVertexCommon(t,e,i,s){const r=this._color,n=this._haloColor,o=(0,x.Jz)(0,0,this._size,this._haloSize),a=Math.max(s.minZoom,this._minZoom),l=Math.min(s.maxZoom,this._maxZoom),h=(0,x.Jz)(D(a),D(l),this._outLineLabelAngle,0);t.push(i),t.push(e),t.push(r),t.push(n),t.push(o),t.push(this._refSymbolAndPlacementOffset),t.push(h)}}const A=Z;var B=i(16878),V=i(10321);class J{constructor(t,e,i){this._isDD=!1,this._geometryType=t,this._idField=e,this._templateStore=i}update(t,e){this._isDD="simple"===t.mesh.matcher.type&&t.mesh.matcher.isDotDensity,(0,s.pC)(t.mesh.labels)&&this._setLabelTemplates(t.mesh.labels,e)}_setLabelTemplates(t,e){this._labelTemplates=t.map((t=>A.fromLabelClass(t,e)))}get templates(){return this._templateStore}createMeshData(t){const e=new Array(5),i=this._labelTemplates&&this._labelTemplates.length>0,s="esriGeometryPolyline"===this._geometryType?n.YP:n.Qg;return e[o.LW.MARKER]=new u(o.LW.MARKER,4*t),e[o.LW.FILL]=new u(o.LW.FILL,t,this._isDD),e[o.LW.LINE]=new u(o.LW.LINE,t),e[o.LW.TEXT]=new u(o.LW.TEXT,4*t),e[o.LW.LABEL]=new u(o.LW.LABEL,i?4*s:0),new a._(e,{features:t,records:t,metrics:0})}async analyze(t,e,i,s,n){if((0,r.isAborted)(n))return;let o;"dictionary"===e.type&&(o=await e.analyze(this._idField,t.copy(),i,s,n));let a=0;for(;t.next();){let r;if(r=o?o[a++]:e.match(this._idField,t,this._geometryType,i,s),t.setGroupId(r),(0,V.S)(r)){const e=this._templateStore.getDynamicTemplateGroup(r);for(const r of e)r&&r.analyze&&r.analyze(this._templateStore,t,i,s)}}return this._templateStore.finalize(n)}async analyzeGraphics(t,e,i,s,n){if((0,r.isAborted)(n))return;const o=t.getCursor();for(e&&await e.analyze(this._idField,o.copy(),i,s,n);o.next();){let t=o.getGroupId();if(null!=t&&-1!==t||(t=e.match(this._idField,o,o.geometryType,i,s),o.setGroupId(t)),(0,V.S)(t)){const e=this._templateStore.getDynamicTemplateGroup(t);for(const t of e)t&&t.analyze&&t.analyze(this._templateStore,o,i,s)}o.setGroupId(t)}return this._templateStore.finalize(n)}writeGraphic(t,e){const i=e.getGroupId(),s=e.getDisplayId(),r=this._templateStore.getTemplateGroup(i),n=e.geometryType;if(null!=s){if((0,V.S)(i))for(const t of r)t.bindFeature(e,null,null);if(r){t.writeDisplayObject(s,e.readGraphic().insertAfter);for(const i of r){if(!i)continue;const r=t.get(i.geometryType);i.writeMesh(t,r,e,n,s)}}}}writeCursor(t,e,i,r,n,o){const a=e.getGroupId(),l=e.getDisplayId(),h=this._templateStore.getTemplateGroup(a);if(null==l)return;if(!h)return;if(t.writeDisplayObject(l,0),(0,V.S)(a))for(const t of h)t.bindFeature(e,i,r);for(const i of h){const s=t.get(i.geometryType);!i.needsPixelBuffer&&e.hasFilter()||i.writeMesh(t,s,e,this._geometryType,l)}const c=t.hasDisplayRecords();if((0,s.pC)(o)&&c){const i=o&&this._findLabelRef(h);this._writeLabels(t,e,l,o,i,n)}t.endDisplayObject()}_findLabelRef(t){for(const e of t)if(e instanceof B.Z)return e;return null}_writeLabels(t,e,i,r,n,o){for(const a of r)if((0,s.pC)(a)&&a){const{glyphs:s,rtl:r,index:l}=a,h=this._labelTemplates[l],c=t.get(h.geometryType);h.bindReferenceTemplate(n),h.bindTextInfo(s,r),h.writeMesh(t,c,e,this._geometryType,i,o)}}}},44055:(t,e,i)=>{"use strict";i.d(e,{f:()=>x});var s=i(36544),r=i(32656),n=i(39105),o=i(30927),a=i(19546),l=i(40365),h=i(49723),c=i(79265),f=i(36933);const u=s.Z.getLogger("esri/views/2d/engine/webgl/util/Matcher");class m{constructor(){this.type="feature",this._defaultResult=null}static async fromBasicRenderer(t,e,i){const s=new m;if(t.symbol){const r=await(0,c.B)(t.symbol,i),n=e.createTemplateGroup(r,null);s.setDefault(n)}return s}size(){return 1}getDefault(){return this._defaultResult}setDefault(t){this._defaultResult=t}match(t,e,i,s,r){return this.getDefault()}async analyze(t,e,i,s,r){return null}}class d extends m{constructor(t,e,i,s){super(),this.type="interval",this._intervals=[],this._isMaxInclusive=e,this._fieldIndex=s,this._field=t,this._normalizationInfo=i}static async fromCBRenderer(t,e,i){const{isMaxInclusive:s,normalizationField:r,normalizationTotal:o,normalizationType:a}=t,l=t.field,h=new d(l,s,{normalizationField:r,normalizationTotal:o,normalizationType:a},t.fieldIndex),f=await(0,c.B)(t.backgroundFillSymbol,i);await(0,n.all)(t.intervals.map((async t=>{const s=await(0,c.B)(t.symbol,i),r=await e.createTemplateGroup(s,f),n={min:t.min,max:t.max};h.add(n,r)})));const u=await(0,c.B)(t.defaultSymbol,i);if(u){const t=await e.createTemplateGroup(u,f);h.setDefault(t)}return h}add(t,e){this._intervals.push({interval:t,result:e}),this._intervals.sort(((t,e)=>t.interval.min-e.interval.min))}size(){return super.size()+this._intervals.length}match(t,e,i,s,r){if(null==this._fieldIndex&&!this._field)return this.getDefault();const n=null!=this._fieldIndex?e.getComputedNumericAtIndex(this._fieldIndex):this._getValueFromField(e);if(!n&&(null==n||isNaN(n)))return this.getDefault();for(let t=0;t<this._intervals.length;t++){const{interval:e,result:i}=this._intervals[t],s=n>=e.min,r=this._isMaxInclusive?n<=e.max:n<e.max;if(s&&r)return i}return this.getDefault()}_needsNormalization(){const t=this._normalizationInfo;return t&&(t.normalizationField||t.normalizationTotal||t.normalizationType)}_getValueFromField(t){const e=t.readAttribute(this._field);if(!this._needsNormalization())return e;const{normalizationField:i,normalizationTotal:s,normalizationType:r}=this._normalizationInfo,n=!!i&&t.readAttribute(i);if(r)switch(r){case"esriNormalizeByField":return n?e/n:void 0;case"esriNormalizeByLog":return Math.log(e)*Math.LOG10E;case"esriNormalizeByPercentOfTotal":return e/s*100;default:return void u.error(`Found unknown normalization type: ${r}`)}else u.error("Normalization is required, but no type was set!")}}class p extends m{constructor(t,e,i){super(),this.type="map",this._nullResult=null,this._resultsMap=new Map,this._fieldsIndex=i,this._fields=t,this._seperator=e||""}static async fromUVRenderer(t,e,i){const s=t.fieldDelimiter,r=[t.field];t.field2&&r.push(t.field2),t.field3&&r.push(t.field3);const o=await(0,c.B)(t.backgroundFillSymbol,i),a=new p(r,s,t.fieldIndex);await(0,n.all)(t.map.map((async t=>{const s=await(0,c.B)(t.symbol,i),r=await e.createTemplateGroup(s,o);"<Null>"===t.value?a.setNullResult(r):a.add(t.value,r)})));const l=await(0,c.B)(t.defaultSymbol,i);if(l){const t=await e.createTemplateGroup(l,o);a.setDefault(t)}return a}setNullResult(t){this._nullResult=t}add(t,e){this._resultsMap.set(t.toString(),e)}size(){return super.size()+this._resultsMap.size}match(t,e,i,s,r){if(null==this._fieldsIndex&&!this._fields)return this.getDefault();const n=null!=this._fieldsIndex?e.getComputedStringAtIndex(this._fieldsIndex):this._getValueFromFields(e);if(null!==this._nullResult&&(null==n||""===n||"<Null>"===n))return this._nullResult;if(!n&&null==n)return this.getDefault();const o=n.toString();return this._resultsMap.has(o)?this._resultsMap.get(o):this.getDefault()}_getValueFromFields(t){const e=[];for(const i of this._fields){const s=t.readAttribute(i);e.push(s)}return e.join(this._seperator)}}class y extends m{constructor(t,e,i,s){super(),this.type="dictionary",this._groupIdCache=new l.Z(100),this._renderer=t,this._fieldMap=t.fieldMap,this._symbolFields=t.getSymbolFields(),this._templates=e,this._info=i,this._scaleFn=s}static async fromDictionaryRenderer(t,e,s){const r=(await Promise.resolve().then(i.bind(i,43925))).default.fromJSON(t.renderer);await r.fetchResources({spatialReference:s.spatialReference,fields:s.fields});const n=await async function(t,e){const i=t||1;if("number"==typeof i)return(t,e,s)=>i;const s=await(0,o.Yi)(i,e.spatialReference,e.fields);return(t,i,r)=>(0,h.Z)(s,t,{$view:r},e.geometryType,i)||1}(r.scaleExpression,s);return new y(r,e,s,n)}async _analyzeFeature(t,e,i,s){const n=t.readLegacyFeature(),o=this._scaleFn(n,e,i),l=this._attributeHash(n)+"-"+o,h=this._groupIdCache.get(l);if(h)return h;const m={...i,spatialReference:this._info.spatialReference,abortOptions:s,fields:this._info.fields},d=await this._renderer.getSymbolAsync(n,m),p=(0,f.PY)(d,this._renderer),y=(0,c.B)(p,this._info,s).then((t=>{if("expanded-cim"!==t.type)return u.error(new r.Z("mapview-bad-type",`Found unexpected type ${t.type} in dictionary response`)),null;t.hash+="-"+o;for(const e of t.layers)e.scaleFactor=o,e.templateHash+="-"+o,"text"===e.type&&"string"==typeof e.text&&e.text.indexOf("[")>-1&&(e.text=(0,a.Qs)(this._fieldMap,e.text,e.cim.textCase));return this._templates.createTemplateGroup(t,null)}));return this._groupIdCache.put(l,y,1),y}async analyze(t,e,i,s,r){const o=e.getCursor(),a=[];for(;o.next();)a.push(this._analyzeFeature(o,i,s,r));return(0,n.all)(a)}match(t,e,i,s,r){return null}_attributeHash(t){let e="";for(const i of this._symbolFields){const s=this._fieldMap[i];s&&(e+=t.attributes[s]+"-")}return e}}const _=s.Z.getLogger("esri/views/2d/engine/webgl/mesh/factories/matcherUtils");async function x(t,e,i){switch(t.type){case"simple":return m.fromBasicRenderer(t,e,i);case"map":return p.fromUVRenderer(t,e,i);case"interval":return d.fromCBRenderer(t,e,i);case"dictionary":return y.fromDictionaryRenderer(t,e,i);default:return _.error(new r.Z("mapview-mesh:invalid-renderer","Unable to handle unknown renderer type")),null}}},49181:(t,e,i)=>{"use strict";i.d(e,{Z:()=>m});var s=i(59472),r=i(96071),n=i(31036),o=i(14286),a=i(42738),l=i(87561),h=i(27851),c=i(53986),f=i(31514),u=i(7051);const m=t=>class extends t{constructor(...t){super(...t),this.angle=0,this.xOffset=0,this.yOffset=0,this.width=0,this.height=0,this.boundsType="square",this._anchorX=0,this._anchorY=0,this._computedWidth=0,this._computedHeight=0,this.geometryType=f.LW.MARKER}writeMeshWithGeometry(t,e,i,r,o,a){const l=e.indexVector,h=e.get("geometry"),c=e.getVector("geometry"),f=c.vertexCount,u=f,m=l.length;if((0,s.pC)(this._markerPlacement)){const t=null!=a?a:i.readLegacyGeometry();this._writePlacedMarkers(h,l,f,o,t)}else{const t=a?(0,n.oB)((0,n.GH)(a),2):"esriGeometryPolygon"===r?i.readCentroid():i.readUnquantizedGeometry();if(!t)return;if(t.isPoint){const[e,i]=t.coords;this._writeVertices(h,o,this._getPos(e,i)),this._writeIndices(l,f)}else t.forEachVertex(((t,e)=>{const i=c.vertexCount;this._writeVertices(h,o,this._getPos(t,e)),this._writeIndices(l,i)}))}const d=e.getVector("geometry").vertexCount-u,p=l.length-m;t.writeDisplayRecord(this.geometryType,this._materialKey,u,d,m,p)}_applyTransformation(t,e,i=0){(0,a.i)(t),(0,a.t)(t,t,(0,h.f)(this.xOffset,-this.yOffset)),this.angle+i!==0&&(0,a.r)(t,t,.017453292519944444*(this.angle+i));const s=this._computedWidth,r=this._computedHeight,n=(this._anchorX-.5)*s,l=(this._anchorY-.5)*r;(0,o.s)(e,n,l),(0,o.t)(e,e,t),this._offsetUpperLeft=(0,c.UJ)(16*e[0],16*e[1]),(0,o.s)(e,n+s,l),(0,o.t)(e,e,t),this._offsetUpperRight=(0,c.UJ)(16*e[0],16*e[1]),(0,o.s)(e,n,l+r),(0,o.t)(e,e,t),this._offsetBottomLeft=(0,c.UJ)(16*e[0],16*e[1]),(0,o.s)(e,n+s,l+r),(0,o.t)(e,e,t),this._offsetBottomRight=(0,c.UJ)(16*e[0],16*e[1])}_writePlacedMarkers(t,e,i,n,o){const a=u.i.getPlacement(o,(0,s.Wg)(this._markerPlacement),(0,r.F2)(1));if(!a)return;const c=(0,h.c)(),f=(0,l.c)();let m=0,d=a.next();for(;null!=d;)d.tx>=-128&&d.tx<=640&&d.ty>=-128&&d.ty<=640&&(this._applyTransformation(f,c,d.getAngle()/.017453292519944444),this._writeVertices(t,n,this._getPos(d.tx,d.ty)),this._writeIndices(e,i+m),m+=4),d=a.next()}_getPos(t,e){return(0,c.UJ)(Math.round(8*t),Math.round(8*e))}_writeVertices(t,e,i){t.push(i),t.push(this._offsetUpperLeft),t.push(this._texUpperLeft),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(i),t.push(this._offsetUpperRight),t.push(this._texUpperRight),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(i),t.push(this._offsetBottomLeft),t.push(this._texBottomLeft),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth),t.push(i),t.push(this._offsetBottomRight),t.push(this._texBottomRight),t.push(this._bitestAndDistRatio),t.push(e),t.push(this._fillColor),t.push(this._outlineColor),t.push(this._sizeOutlineWidth)}_writeIndices(t,e){const i=e;t.push(i+0),t.push(i+1),t.push(i+2),t.push(i+1),t.push(i+3),t.push(i+2)}}},34635:(t,e,i)=>{"use strict";i.d(e,{Z:()=>u});var s=i(59472),r=i(96071),n=i(31036),o=i(71286),a=i(53986),l=i(17134),h=i(31514),c=i(9709),f=i(7051);const u=t=>class extends t{constructor(...t){super(...t),this._isCIM=!1,this.geometryType=h.LW.TEXT,this._aux=(0,a.Jz)(0,0,this._referenceSize,this._bitset)}bindTextInfo(t,e){t&&t.length?this._shapingInfo=(0,s.Po)(t,(t=>(0,l.Nr)(t,e,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:o.xm*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM}))):this._shapingInfo=null}writeMeshWithGeometry(t,e,i,r,o,a){if((0,s.pC)(this._textPlacement)){const s=null!=a?a:i.readLegacyGeometry();return this._writePlacedText(t,e,o,s)}const l=a?(0,n.oB)((0,n.GH)(a),2):"esriGeometryPolygon"===r?i.readCentroid():i.readUnquantizedGeometry();if(l){if(l.isPoint){const[i,s]=l.coords;return this._writeGlyphs(t,e,o,{x:i,y:s})}l.forEachVertex(((i,s)=>this._writeGlyphs(t,e,o,{x:i,y:s})))}}_writePlacedText(t,e,i,n){const o=this._shapingInfo;if((0,s.Wi)(o))return;const l=c.m2.load(this._materialKey),h=(0,s.Wg)(this._textPlacement),u=f.i.getPlacement(n,h,(0,r.F2)(1));if(!u)return;let m,d,p=u.next();for(;null!=p;){d=(0,a.UJ)(Math.round(8*p.tx),Math.round(8*p.ty)),m=p.getAngle(),o.setRotation(m);for(const s of o.glyphs){l.textureBinding=s.textureBinding;const r=e.getVector("geometry").vertexCount,n=e.indexVector.length,o=this._writeIndices(e),a=this._writeVertex(e,i,d,s);t.writeDisplayRecord(this.geometryType,l.data,r,a,n,o)}o.setRotation(-m),p=u.next()}}_writeGlyphs(t,e,i,r){const n=this._shapingInfo;if((0,s.Wi)(n))return;const o=c.m2.load(this._materialKey),l=(0,a.UJ)(Math.round(8*r.x),Math.round(8*r.y));for(const s of n.glyphs){o.textureBinding=s.textureBinding;const r=e.getVector("geometry").vertexCount,n=e.indexVector.length,a=this._writeIndices(e),h=this._writeVertex(e,i,l,s);t.writeDisplayRecord(this.geometryType,o.data,r,h,n,a)}}_writeVertexCommon(t,e,i,s){const r=this._color,n=this._haloColor,o=(0,a.Jz)(0,0,this._referenceSize,this._bitset),l=(0,a.Jz)(0,0,this._size,this._haloSize);t.push(i),t.push(e),t.push(r),t.push(n),t.push(l),t.push(o)}_writeVertex(t,e,i,s){const r=t.get("geometry");return this._writeVertexCommon(r,e,i,s),r.push(s.offsets.upperLeft),r.push(s.texcoords.upperLeft),this._writeVertexCommon(r,e,i,s),r.push(s.offsets.upperRight),r.push(s.texcoords.upperRight),this._writeVertexCommon(r,e,i,s),r.push(s.offsets.lowerLeft),r.push(s.texcoords.lowerLeft),this._writeVertexCommon(r,e,i,s),r.push(s.offsets.lowerRight),r.push(s.texcoords.lowerRight),4}_writeIndices(t){const e=t.getVector("geometry").vertexCount,i=t.indexVector;return i.push(e+0),i.push(e+1),i.push(e+2),i.push(e+1),i.push(e+3),i.push(e+2),6}}},16878:(t,e,i)=>{"use strict";i.d(e,{Z:()=>d});var s=i(59472),r=i(96071),n=i(71286),o=i(87561),a=i(27851),l=i(53986),h=i(9709),c=i(51482),f=i(60733),u=i(49181);class m extends((0,u.Z)(f.Z)){constructor(t,e,i,s,r,c,f,u,m,d,p,y,_,x,g,M,b,w,v,S,C){super(),this.angle=s,this.height=f,this.width=c,this.xOffset=e*v,this.yOffset=i*v,this._markerPlacement=S,this.effects=C,this._anchorX=.5-(.5+M)*g.width/g.width,this._anchorY=.5-(.5+b)*g.height/g.height;const L=(1===x?1:0)|(p?1:0)<<1|(_?1:0)<<2|(y?1:0)<<3,P=g&&g.sdf,z=h.mE.load(t);z.sdf=P,z.pattern=!0,z.textureBinding=g.textureBinding,this._materialKey=z.data,this._fillColor=r,this._outlineColor=m,this._sizeOutlineWidth=(0,l.Jz)(Math.round(Math.min(Math.sqrt(128*c),255)),Math.round(Math.min(Math.sqrt(128*f),255)),Math.round(Math.min(Math.sqrt(128*d),255)),Math.round(Math.min(Math.sqrt(128*u),255)));const k=g.rect.x+n.fL,O=g.rect.y+n.fL,I=k+g.width,T=O+g.height;this._texUpperLeft=(0,l.UJ)(k,O),this._texUpperRight=(0,l.UJ)(I,O),this._texBottomLeft=(0,l.UJ)(k,T),this._texBottomRight=(0,l.UJ)(I,T),c*=w,f*=w,c*=v,f*=v;const F=Math.round(Math.min(64*w,255));this._bitestAndDistRatio=(0,l.Jz)(0,0,L,F),this._computedWidth=c,this._computedHeight=f;const D=(0,a.c)(),R=(0,o.c)();this._applyTransformation(R,D)}static fromCIMMarker(t,e){const i=e&&e.width||1,n=e&&e.height||1,o=t.size,a=i/n*t.scaleX,l=t.scaleSymbolsProportionally&&t.frameHeight?o/t.frameHeight:1,h=(0,c.t2)(t.color),f=(0,c.t2)(t.outlineColor),u=(0,r.F2)(o),d=u*a,p=(0,r.F2)(t.offsetX||0),y=(0,r.F2)(t.offsetY||0),_=(0,r.F2)(t.outlineWidth||0)*l,x=t.alignment||0,g=(0,r.F2)(t.referenceSize);let M=t.rotation||0;t.rotateClockwise||(M=-M);let b=0,w=0;const v=t.anchorPoint;return v&&(t.isAbsoluteAnchorPoint?o&&(b=-v.x/(o*a),w=v.y/o):(b=v.x,w=v.y)),new m(t.materialKey,p,y,M,h,d,u,g,f,_,t.colorLocked,t.scaleSymbolsProportionally,!1,x,e,b,w,t.sizeRatio,(0,s.Pt)(t.scaleFactor,1),t.markerPlacement,t.effects)}static fromPictureMarker(t,e){const i=Math.round((0,r.F2)(t.width)),s=Math.round((0,r.F2)(t.height)),o=n.ru,a=Math.round((0,r.F2)(t.xoffset||0)),l=Math.round((0,r.F2)(t.yoffset||0));return new m(t.materialKey,a,l,t.angle,o,i,s,s,0,0,!1,!1,!1,0,e,0,0,1,1,null,null)}static fromSimpleMarker(t,e){const i=(0,c.aH)(t.color),s=Math.round((0,r.F2)(t.size)),n=s,o=Math.round((0,r.F2)(t.xoffset||0)),a=Math.round((0,r.F2)(t.yoffset||0)),l=t.style,h=t.outline,f=0|(h&&h.color&&(0,c.aH)(h.color)),u=0|(h&&h.width&&Math.round((0,r.F2)(h.width))),d=new m(t.materialKey,o,a,t.angle,i,s,n,n,f,u,!1,!1,"esriSMSCross"===l||"esriSMSX"===l,0,e,0,0,126/64,1,null,null);return d.boundsType="esriSMSCircle"===l?"circle":"square",d}static fromLineSymbolMarker(t,e){const i=(0,c.aH)(t.color),s=Math.round((0,r.F2)(6*t.lineWidth)),n=s,o="cross"===t.style||"x"===t.style;let a;switch(t.placement){case"begin-end":a="Both";break;case"begin":a="JustBegin";break;case"end":a="JustEnd";break;default:a="None"}const l={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:a,offsetAlongLine:0},h=new m(t.materialKey,0,0,0,i,s,n,n/6,i,o?Math.round((0,r.F2)(t.lineWidth)):0,!1,!1,o,1,e,0,0,126/64,1,l,null);return h.boundsType="circle"===t.style?"circle":"square",h}}const d=m},60733:(t,e,i)=>{"use strict";i.d(e,{Z:()=>c});var s=i(59472),r=i(56885),n=i(31514),o=i(76074),a=i(94403),l=i(50105);class h{static executeEffects(t,e){const i=(0,o.GP)(e);let s=new a.M(i);for(const e of t){const t=(0,l.h)(e);t&&(s=t.execute(s,e,1.3333333333333333))}return s}static next(t){const e=t.next();return(0,o.wp)(e),e}}const c=class{get needsPixelBuffer(){return!!this.effects||this.geometryType===n.LW.MARKER||this.geometryType===n.LW.TEXT||this.geometryType===n.LW.LABEL}writeMesh(t,e,i,n,o){if((0,s.Wi)(this.effects))return this.writeMeshWithGeometry(t,e,i,n,o);const a=h.executeEffects(this.effects,i.readLegacyGeometry());let l=h.next(a);for(;l;)this.writeMeshWithGeometry(t,e,i,(0,r.Ji)(l),o,l),l=h.next(a)}writeMeshWithGeometry(t,e,i,s,r,n){}bindFeature(t,e,i){}}},10321:(t,e,i)=>{"use strict";i.d(e,{W:()=>Jt,S:()=>Vt});var s=i(36544),r=i(32656),n=i(39105),o=i(5684),a=i(32307),l=i(36933),h=i(37521),c=i(16878),f=i(33655),u=i(96071),m=i(71286),d=i(53986),p=i(9709),y=i(51482),_=i(96540),x=i(33577),g=i(31036),M=i(31514),b=i(73127),w=i(61078);function v(t,e,i,s,r,n,o){Y=0;const a=(s-i)*n,l=r&&r.length,h=l?(r[0]-i)*n:a;let c,f,u,m,d,p=S(e,i,s,0,h,n,!0);if(p&&p.next!==p.prev){if(l&&(p=function(t,e,i,s,r,n){const o=new Array;for(let r=0,a=s.length;r<a;r++){const l=S(t,e,i,s[r]*n,r<a-1?s[r+1]*n:i*n,n,!1);l===l.next&&(l.steiner=!0),o.push(I(l))}o.sort(V);for(const t of o)T(t,r),r=C(r,r.next);return r}(e,i,s,r,p,n)),a>80*n){c=u=e[0+i*n],f=m=e[1+i*n];for(let t=n;t<h;t+=n){const s=e[t+i*n],r=e[t+1+i*n];c=Math.min(c,s),f=Math.min(f,r),u=Math.max(u,s),m=Math.max(m,r)}d=Math.max(u-c,m-f),d=0!==d?1/d:0}L(p,t,n,c,f,d,o,0)}}function S(t,e,i,s,r,n,o){let a;if(o===function(t,e,i,s,r,n){let o=0;for(let i=s,a=r-n;i<r;i+=n)o+=(t[a+e*n]-t[i+e*n])*(t[i+1+e*n]+t[a+1+e*n]),a=i;return o}(t,e,0,s,r,n)>0)for(let i=s;i<r;i+=n)a=k(i+e*n,t[i+e*n],t[i+1+e*n],a);else for(let i=r-n;i>=s;i-=n)a=k(i+e*n,t[i+e*n],t[i+1+e*n],a);return a&&B(a,a.next)&&(O(a),a=a.next),a}function C(t,e=t){if(!t)return t;let i,s=t;do{if(i=!1,s.steiner||!B(s,s.next)&&0!==D(s.prev,s,s.next))s=s.next;else{if(O(s),s=e=s.prev,s===s.next)break;i=!0}}while(i||s!==e);return e}function L(t,e,i,s,r,n,o,a){if(!t)return;!a&&n&&(t=F(t,s,r,n));let l=t;for(;t.prev!==t.next;){const h=t.prev,c=t.next;if(n?z(t,s,r,n):P(t))e.push(h.index/i+o),e.push(t.index/i+o),e.push(c.index/i+o),O(t),t=c.next,l=c.next;else if((t=c)===l){a?1===a?L(t=J(t,e,i,o),e,i,s,r,n,o,2):2===a&&G(t,e,i,s,r,n,o):L(C(t),e,i,s,r,n,o,1);break}}}function P(t){const e=t.prev,i=t,s=t.next;if(D(e,i,s)>=0)return!1;let r=t.next.next;const n=r;let o=0;for(;r!==t.prev&&(0===o||r!==n);){if(o++,N(e.x,e.y,i.x,i.y,s.x,s.y,r.x,r.y)&&D(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function z(t,e,i,s){const r=t.prev,n=t,o=t.next;if(D(r,n,o)>=0)return!1;const a=r.x<n.x?r.x<o.x?r.x:o.x:n.x<o.x?n.x:o.x,l=r.y<n.y?r.y<o.y?r.y:o.y:n.y<o.y?n.y:o.y,h=r.x>n.x?r.x>o.x?r.x:o.x:n.x>o.x?n.x:o.x,c=r.y>n.y?r.y>o.y?r.y:o.y:n.y>o.y?n.y:o.y,f=A(a,l,e,i,s),u=A(h,c,e,i,s);let m=t.prevZ,d=t.nextZ;for(;m&&m.z>=f&&d&&d.z<=u;){if(m!==t.prev&&m!==t.next&&N(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&D(m.prev,m,m.next)>=0)return!1;if(m=m.prevZ,d!==t.prev&&d!==t.next&&N(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&D(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;m&&m.z>=f;){if(m!==t.prev&&m!==t.next&&N(r.x,r.y,n.x,n.y,o.x,o.y,m.x,m.y)&&D(m.prev,m,m.next)>=0)return!1;m=m.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&N(r.x,r.y,n.x,n.y,o.x,o.y,d.x,d.y)&&D(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function k(t,e,i,s){const r=U.create(t,e,i);return s?(r.next=s.next,r.prev=s,s.next.prev=r,s.next=r):(r.prev=r,r.next=r),r}function O(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function I(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function T(t,e){if(e=function(t,e){let i=e;const s=t.x,r=t.y;let n,o=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){const t=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(t<=s&&t>o){if(o=t,t===s){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!n)return null;if(s===o)return n.prev;const a=n,l=n.x,h=n.y;let c,f=1/0;for(i=n.next;i!==a;)s>=i.x&&i.x>=l&&s!==i.x&&N(r<h?s:o,r,l,h,r<h?o:s,r,i.x,i.y)&&(c=Math.abs(r-i.y)/(s-i.x),(c<f||c===f&&i.x>n.x)&&Z(i,t)&&(n=i,f=c)),i=i.next;return n}(t,e)){const i=X(e,t);C(i,i.next)}}function F(t,e,i,s){for(let r;r!==t;r=r.next){if(r=r||t,null===r.z&&(r.z=A(r.x,r.y,e,i,s)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,F(t,e,i,s);r.prevZ=r.prev,r.nextZ=r.next}return t.prevZ.nextZ=null,t.prevZ=null,function(t){let e,i=1;for(;;){let s,r=t;t=null,e=null;let n=0;for(;r;){n++,s=r;let o=0;for(;o<i&&s;o++)s=s.nextZ;let a=i;for(;o>0||a>0&&s;){let i;0===o?(i=s,s=s.nextZ,a--):0!==a&&s?r.z<=s.z?(i=r,r=r.nextZ,o--):(i=s,s=s.nextZ,a--):(i=r,r=r.nextZ,o--),e?e.nextZ=i:t=i,i.prevZ=e,e=i}r=s}if(e.nextZ=null,i*=2,n<2)return t}}(t)}function D(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function R(t,e,i,s){return!!(B(t,e)&&B(i,s)||B(t,s)&&B(i,e))||D(t,e,i)>0!=D(t,e,s)>0&&D(i,s,t)>0!=D(i,s,e)>0}function N(t,e,i,s,r,n,o,a){return(r-o)*(e-a)-(t-o)*(n-a)>=0&&(t-o)*(s-a)-(i-o)*(e-a)>=0&&(i-o)*(n-a)-(r-o)*(s-a)>=0}function Z(t,e){return D(t.prev,t,t.next)<0?D(t,e,t.next)>=0&&D(t,t.prev,e)>=0:D(t,e,t.prev)<0||D(t,t.next,e)<0}function A(t,e,i,s,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-s)*r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function B(t,e){return t.x===e.x&&t.y===e.y}function V(t,e){return t.x-e.x}function J(t,e,i,s){let r=t;do{const n=r.prev,o=r.next.next;!B(n,o)&&R(n,r,r.next,o)&&Z(n,o)&&Z(o,n)&&(e.push(n.index/i+s),e.push(r.index/i+s),e.push(o.index/i+s),O(r),O(r.next),r=t=o),r=r.next}while(r!==t);return r}function G(t,e,i,s,r,n,o){let a=t;do{let t=a.next.next;for(;t!==a.prev;){if(a.index!==t.index&&W(a,t)){let l=X(a,t);return a=C(a,a.next),l=C(l,l.next),L(a,e,i,s,r,n,o,0),void L(l,e,i,s,r,n,o,0)}t=t.next}a=a.next}while(a!==t)}function W(t,e){return t.next.index!==e.index&&t.prev.index!==e.index&&!function(t,e){let i=t;do{if(i.index!==t.index&&i.next.index!==t.index&&i.index!==e.index&&i.next.index!==e.index&&R(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&Z(t,e)&&Z(e,t)&&function(t,e){let i=t,s=!1;const r=(t.x+e.x)/2,n=(t.y+e.y)/2;do{i.y>n!=i.next.y>n&&i.next.y!==i.y&&r<(i.next.x-i.x)*(n-i.y)/(i.next.y-i.y)+i.x&&(s=!s),i=i.next}while(i!==t);return s}(t,e)}function X(t,e){const i=U.create(t.index,t.x,t.y),s=U.create(e.index,e.x,e.y),r=t.next,n=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,s.next=i,i.prev=s,n.next=s,s.prev=n,s}class U{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}static create(t,e,i){const s=E[Y++];return s.index=t,s.x=e,s.y=i,s.prev=null,s.next=null,s.z=null,s.prevZ=null,s.nextZ=null,s.steiner=!1,s}}const E=new Array;let Y=0;for(let t=0;t<8096;t++)E.push(new U);const H=new(i(15451).Z),K=new w.b(0,0,0,1,128);function j(t,e,i){let s=0;for(let r=1;r<i;r++){const i=t[2*(e+r-1)],n=t[2*(e+r-1)+1];s+=(t[2*(e+r)]-i)*(t[2*(e+r)+1]+n)}return s}function q(t,e,i,s,r){let n=0;for(let o=i;o<s;o+=3){const i=2*(t.getValue(o)-r),s=2*(t.getValue(o+1)-r),a=2*(t.getValue(o+2)-r);n+=Math.abs((e[i]-e[a])*(e[s+1]-e[i+1])-(e[i]-e[s])*(e[a+1]-e[i+1]))}return n}K.setExtent(m.I_);const $=t=>class extends t{constructor(...t){super(...t),this.forceLibtess=!1,this.geometryType=M.LW.FILL}writeMeshWithGeometry(t,e,i,s,r,n){const o=p.dk.load(this._materialKey),a=e.indexVector,l=e.getVector("geometry"),h=l.vertexCount,c=a.length;let f=n?(0,g.oB)((0,g.GH)(n),2):i.readUnquantizedGeometry();if(!f)return;if(f=function(t){if(!function(t,e,i){let s=0;for(let e=0;e<t.lengths.length;e++){const r=t.lengths[e];for(let e=0;e<r;e++){const r=t.coords[2*(e+s)],n=t.coords[2*(e+s)+1];if(r<-128||r>i||n<-128||n>i)return!0}s+=r}return!1}(t,0,m.I_+128))return t;K.reset(3);let e=0;for(let i=0;i<t.lengths.length;i++){const s=t.lengths[i];let r=t.coords[2*(0+e)],n=t.coords[2*(0+e)+1];K.moveTo(r,n);for(let i=1;i<s;i++)r=t.coords[2*(i+e)],n=t.coords[2*(i+e)+1],K.lineTo(r,n);K.close(),e+=s}const i=K.result(!1);if(!i)return null;const s=[],r=[];for(const t of i){let e=0;for(const i of t)r.push(i.x),r.push(i.y),e++;s.push(e)}return new b.Z(s,r)}(f),!f)return;let u=f.coords;!this.forceLibtess&&function(t,e,i){const{coords:s,lengths:r,hasIndeterminateRingOrder:n}=e;if(n)return!1;const o=t.length;let a=0;for(let e=0;e<r.length;){let n=e,l=r[e],h=j(s,a,l);const c=[];for(;++n<r.length;){const t=r[n],e=j(s,a+l,t);if(!(e>0))break;h+=e,c.push(a+l),l+=t}const f=t.length;v(t,s,a,a+l,c,2,i);const u=q(t,s,f,t.length,i),m=Math.abs(h);if(Math.abs((u-m)/Math.max(1e-7,m))>1e-5)return t.seek(o),!1;e=n,a+=l}return!0}(a,f,h)||(u=[],function(t,e,i,s){const r=[],{coords:n,lengths:o}=i;H.beginPolygon(t,r);let a=0;for(let t=0;t<o.length;t++){const e=i.lengths[t];H.beginContour();for(let t=0;t<e;t++){const e=[n[2*(a+t)],n[2*(a+t)+1],0];H.addVertex(e,e)}H.endContour(),a+=e}H.endPolygon();for(let t=0;t<r.length;t++)e.push(r[t]+s)}(u,a,f,h)),this._write(l,i,r,u,o);const d=l.vertexCount-h,y=a.length-c;t.writeDisplayRecord(this.geometryType,this._materialKey,h,d,c,y)}_write(t,e,i,s,r){for(let n=0;n<s.length;n+=2){const o=(0,d.UJ)(1*s[n],1*s[n+1]);t.data.push(o),t.data.push(i),r.dotDensity?t.data.writeF32(1/Math.abs(e.readGeometryArea())):(t.data.push(this.fillColor),t.data.push(this.tl),t.data.push(this.br),t.data.push(this.aux1),t.data.push(this.aux2),t.data.push(this.aux3))}}};var Q=i(93318),tt=i(60733);const et=s.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMeshTemplate"),it=class extends tt.Z{constructor(t){super(),this._ongoingMaterialRequestMap=new Map,this._materialCache=new Map,this._dynamicPropertyMap=new Map,this._cimLayer=t}analyze(t,e,i,s){const r=e.readLegacyFeature(),o=this._materialCache,a=this._cimLayer.materialHash;if(!a)return et.error("A Dynamic mesh template must have a material hash value or function!"),(0,n.reject)(null);const l="function"==typeof a?a(r,i,s):a;if(o.has(l)){const t=o.get(l);return(0,n.resolve)(t)}if(this._ongoingMaterialRequestMap.has(l))return this._ongoingMaterialRequestMap.get(l);const h=(0,Q.S)(this._cimLayer.cim,this._cimLayer.materialOverrides);h.mosaicHash=l;const c=t.getMosaicItem(h).then((t=>(this._ongoingMaterialRequestMap.delete(l),o.set(l,t),t))).catch((t=>(this._ongoingMaterialRequestMap.delete(l),et.error(".analyze()",t.message),null)));return this._ongoingMaterialRequestMap.set(l,c),c}};class st extends($(it)){constructor(t){if(super(t),(0,x.mf)(t.color)){const e=(e,i,s)=>{const r=t.color(e,i,s);return r&&(0,y.t2)(r)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this.fillColor=e&&(0,y.t2)(e)||0}let e=0;(0,x.mf)(t.height)||(e=t.height||0),this._dynamicPropertyMap.set("_height",((i,s,r)=>(0,x.mf)(t.height)?t.height(i,s,r):e));let i=0;(0,x.mf)(t.offsetX)||(i=(0,u.F2)(t.offsetX||0)+128,i>255&&(i=255)),this._dynamicPropertyMap.set("_offsetX",((e,s,r)=>{if((0,x.mf)(t.offsetX)){let i=(0,u.F2)(t.offsetX(e,s,r))+128;return i>255&&(i=255),i}return i}));let s=1;(0,x.mf)(t.scaleX)||(s=t.scaleX||1),this._dynamicPropertyMap.set("_scaleX",((e,i,r)=>(0,x.mf)(t.scaleX)?t.scaleX(e,i,r):s));let r=0;(0,x.mf)(t.offsetY)||(r=(0,u.F2)(-t.offsetY||0)+128,r>255&&(r=255)),this._dynamicPropertyMap.set("_offsetY",((e,i,s)=>{if((0,x.mf)(t.offsetY)){let r=(0,u.F2)(-t.offsetY(e,i,s))+128;return r>255&&(r=255),r}return r}));let n=0;(0,x.mf)(t.angle)||(n=(0,_.Or)(t.angle)||0),this._dynamicPropertyMap.set("_angle",((e,i,s)=>(0,x.mf)(t.angle)?(0,_.Or)(t.angle(e,i,s)):n)),this.effects=t.effects,this._cimFillLayer=t,this._fillMaterialKey=p.dk.load(t.materialKey)}static fromCIMFill(t){return new st(t)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)}));const r=this._fillMaterialKey,n=this._materialCache,o=this._cimFillLayer;this.aux3=(0,d.Jz)(0,0,this._angle,o.colorLocked?1:0);const l=(0,o.materialHash)(s,e,i),h=n.get(l);let c=null;if(h&&(0,a.ok)(h.spriteMosaicItem)&&(c=h.spriteMosaicItem),c){const{rect:t,width:e,height:i}=c,s=t.x+m.fL,n=t.y+m.fL,o=s+e,a=n+i;let l=(0,f.Sf)((0,u.F2)(this._height));l>255?l=255:l<=0&&(l=(0,f.Sf)(a-n));let h=(0,f.Sf)((0,u.F2)(this._height/i*e||0));h>255?h=255:h<=0&&(h=(0,f.Sf)(o-s));const p=this._scaleX,y=1;this.tl=(0,d.UJ)(s,n),this.br=(0,d.UJ)(o,a),this.aux1=(0,d.Jz)(h,l,this._offsetX,this._offsetY),this.aux2=(0,d.UJ)(128*p,128*y),r.sdf=c.sdf,r.pattern=!0,r.textureBinding=c.textureBinding}else this.tl=0,this.br=0,this.aux1=0,this.aux2=0,r.sdf=!1,r.pattern=!1,r.textureBinding=0;this._materialKey=r.data}}const rt=st;i(95830);var nt=i(96225);const ot=m.I_+16,at=new w.b(0,0,0,1,16);at.setExtent(m.I_);const lt=new Uint32Array(9),ht=new Uint32Array(36),ct=new Uint32Array(3),ft=new Uint32Array(6),ut=t=>e=>{const i=Math.ceil(1024*t._halfWidth),s=Math.ceil(1024*t._halfReferenceWidth);e.entry0=t.offset+t.vertexCount++;{const r=(0,d.UJ)(e.distance,i),n=(0,d.Jz)(Math.round(31*e.prevNormal.x),Math.round(31*e.prevNormal.y),Math.round(0),Math.round(-31)),o=(0,d.Jz)(0,0,0,t._bitset);ht[0]=(0,d.UJ)(8*e.currentVertex.x,8*e.currentVertex.y),ht[1]=t.id,ht[2]=t._fillColor,ht[3]=n,ht[4]=r,ht[5]=t._tl,ht[6]=t._br,ht[7]=o,ht[8]=(0,d.UJ)(s,0)}e.entry2=t.offset+t.vertexCount++;{const r=(0,d.UJ)(e.distance,i),n=(0,d.Jz)(Math.round(31*-e.prevNormal.x),Math.round(31*-e.prevNormal.y),Math.round(0),Math.round(31)),o=(0,d.Jz)(0,0,0,t._bitset);ht[9]=(0,d.UJ)(8*e.currentVertex.x,8*e.currentVertex.y),ht[10]=t.id,ht[11]=t._fillColor,ht[12]=n,ht[13]=r,ht[14]=t._tl,ht[15]=t._br,ht[16]=o,ht[17]=(0,d.UJ)(s,0)}e.exit0=t.offset+t.vertexCount++;{const r=(0,d.UJ)(e.distance,i),n=(0,d.Jz)(Math.round(31*e.nextNormal.x),Math.round(31*e.nextNormal.y),Math.round(0),Math.round(-31)),o=(0,d.Jz)(0,0,0,t._bitset);ht[18]=(0,d.UJ)(8*e.currentVertex.x,8*e.currentVertex.y),ht[19]=t.id,ht[20]=t._fillColor,ht[21]=n,ht[22]=r,ht[23]=t._tl,ht[24]=t._br,ht[25]=o,ht[26]=(0,d.UJ)(s,0)}e.exit2=t.offset+t.vertexCount++;{const r=(0,d.UJ)(e.distance,i),n=(0,d.Jz)(Math.round(31*-e.nextNormal.x),Math.round(31*-e.nextNormal.y),Math.round(0),Math.round(31)),o=(0,d.Jz)(0,0,0,t._bitset);ht[27]=(0,d.UJ)(8*e.currentVertex.x,8*e.currentVertex.y),ht[28]=t.id,ht[29]=t._fillColor,ht[30]=n,ht[31]=r,ht[32]=t._tl,ht[33]=t._br,ht[34]=o,ht[35]=(0,d.UJ)(s,0)}t.geometryBuf.writeRegion(ht)},mt=t=>e=>{ft[0]=e.leftExit0,ft[1]=e.rightEntry0,ft[2]=e.leftExit2,ft[3]=e.rightEntry0,ft[4]=e.rightEntry2,ft[5]=e.leftExit2,t.indexCount+=6,t.indexBuf.writeRegion(ft)},dt=t=>class extends t{constructor(...t){super(...t),this.tessellationProperties={_fillColor:null,_tl:null,_br:null,_halfWidth:null,_bitset:null,_halfReferenceWidth:null,id:null,indexBuf:null,indexCount:null,geometryBuf:null,vertexCount:null,offset:null},this._tessellationOptions={},this.geometryType=M.LW.LINE}writeMeshWithGeometry(t,e,i,s,r,n){const o=e.indexVector,a=e.get("geometry"),l=e.getVector("geometry").vertexCount,h=o.length,c=null!=n?n:i.readLegacyGeometry();if(!c)return;switch(s){case"esriGeometryPolyline":{const t=this._clipLines(c.paths);if(0===t.length)return;this._write(o,a,l,r,t);break}case"esriGeometryPolygon":{const t=this._clipLines(c.rings);if(0===t.length)return;this._write(o,a,l,r,t);break}}const f=this.tessellationProperties.vertexCount,u=this.tessellationProperties.indexCount;t.writeDisplayRecord(this.geometryType,this._materialKey,l,f,h,u)}_clipLines(t){const e=[];let i=!1,s=0;for(;s<t.length;){const r=[],n=t[s];at.reset(2);let[o,a]=n[0];if(i)at.moveTo(o,a);else{if(o<-16||o>ot||a<-16||a>ot){i=!0;continue}r.push({x:o,y:a})}let l=!1;const h=n.length;for(let t=1;t<h;++t)if(o+=n[t][0],a+=n[t][1],i)at.lineTo(o,a);else{if(o<-16||o>ot||a<-16||a>ot){l=!0;break}r.push({x:o,y:a})}if(l)i=!0;else{if(i){const t=at.resultWithStarts();if(t)for(const i of t)e.push(i)}else e.push({line:r,start:0});s++,i=!1}}return e}_write(t,e,i,s,r){this.tessellationProperties.id=s,this.tessellationProperties.indexBuf=t,this.tessellationProperties.indexCount=0,this.tessellationProperties.geometryBuf=e,this.tessellationProperties.vertexCount=0,this.tessellationProperties.offset=i;for(const t of r){const e=t.line;e.length<2||(this._tessellationOptions.initialDistance=t.start%65535,this._tessellationCallbacks instanceof nt.lw&&(this._tessellationCallbacks.capType=this._capType,this._tessellationCallbacks.joinType=this._joinType),(0,nt.GE)(e,this._tessellationOptions,this._tessellationCallbacks),(0,nt.Eq)())}}_initializeTessellator(t){const e=p.a.load(this._materialKey);if(this._tessellationOptions.trackDistance=this._isDashed||this._hasPattern,this._tessellationOptions.thin=!t&&this.tessellationProperties._halfWidth<m.OM/2&&!(e.vvSizeFieldStops||e.vvSizeMinMaxValue||e.vvSizeScaleStops||e.vvSizeUnitValue),this._tessellationOptions.wrapDistance=65535,this._tessellationOptions.outerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableOuterBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.innerBisectorAutoSplitThreshold=.2631578947368421,this._tessellationOptions.enableInnerBisectorSplit=this._isDashed||this._hasPattern,this._tessellationOptions.thin)this._tessellationCallbacks={vertex:ut(this.tessellationProperties),bridge:mt(this.tessellationProperties)};else{const t=new nt.lw((t=>(e,i,s,r,n,o,a,l,h)=>{const c=(0,d.UJ)(h,Math.ceil(1024*t._halfWidth)),f=(0,d.Jz)(Math.round(31*n),Math.round(31*o),Math.round(31*a),Math.round(31*l)),u=(0,d.Jz)(31*s,31*r,0,t._bitset);return lt[0]=(0,d.UJ)(8*e,8*i),lt[1]=t.id,lt[2]=t._fillColor,lt[3]=f,lt[4]=c,lt[5]=t._tl,lt[6]=t._br,lt[7]=u,lt[8]=(0,d.UJ)(Math.ceil(1024*t._halfReferenceWidth),0),t.geometryBuf.writeRegion(lt),t.offset+t.vertexCount++})(this.tessellationProperties),(t=>(e,i,s)=>{ct[0]=e,ct[1]=i,ct[2]=s,t.indexCount+=3,t.indexBuf.writeRegion(ct)})(this.tessellationProperties));t.miterLimitCosine=this._miterLimitCosine,t.textured=this._isDashed||this._hasPattern,t.joinOnUTurn=this._joinOnUTurn,this._tessellationCallbacks=t}}};class pt extends(dt(it)){constructor(t){super(t),this._cimLineLayer=t;let e=0;if((0,x.mf)(t.width)||(e=.5*(0,u.F2)(t.width)),this._dynamicPropertyMap.set("_halfWidth",((i,s,r)=>(0,x.mf)(t.width)?.5*(0,u.F2)(t.width(i,s,r)):e)),(0,x.mf)(t.cap)?this._dynamicPropertyMap.set("_capType",t.cap):this._capType=t.cap,(0,x.mf)(t.join)?this._dynamicPropertyMap.set("_joinType",t.join):this._joinType=t.join,(0,x.mf)(t.color)){const e=(e,i,s)=>{const r=t.color(e,i,s);return r&&(0,y.t2)(r)||0};this._dynamicPropertyMap.set("_fillColor",e)}else{const e=t.color;this._fillColor=e&&(0,y.t2)(e)||0}if((0,x.mf)(t.miterLimit)){const e=(e,i,s)=>(0,x.NW)(t.miterLimit(e,i,s));this._dynamicPropertyMap.set("_miterLimitCosine",e)}else this._miterLimitCosine=(0,x.NW)(t.miterLimit);this._scaleFactor=t.scaleFactor||1,this._isDashed=t.isDashed,this.effects=t.effects,this.tessellationProperties._bitset=t.colorLocked?1:0,this._materialKey=t.materialKey,this._initializeTessellator(!0)}static fromCIMLine(t){return new pt(t)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)})),this._halfWidth*=this._scaleFactor;const r=this._materialCache,n=(0,this._cimLineLayer.materialHash)(s,e,i),o=r.get(n);let l=null;if(o&&(0,a.ok)(o.spriteMosaicItem)&&(l=o.spriteMosaicItem),l){this._hasPattern=!0;const{rect:t,width:e,height:i}=l,s=t.x+m.fL,r=t.y+m.fL,n=s+e,o=r+i;this.tessellationProperties._tl=(0,d.UJ)(s,r),this.tessellationProperties._br=(0,d.UJ)(n,o)}else this._hasPattern=!1,this.tessellationProperties._tl=0,this.tessellationProperties._br=0;this.tessellationProperties._fillColor=this._fillColor,this.tessellationProperties._halfWidth=this._halfWidth,this.tessellationProperties._halfReferenceWidth=this.tessellationProperties._halfWidth;const h=p.a.load(this._materialKey);l&&(h.sdf=l.sdf,h.pattern=!0,h.textureBinding=l.textureBinding),this._materialKey=h.data}}const yt=pt;var _t=i(59472),xt=i(87561),gt=i(27851),Mt=i(49181);const bt=(0,gt.c)(),wt=(0,xt.c)(),vt=s.Z.getLogger("esri.views.2d.engine.webgl.WGLDynamicMarkerTemplate");class St extends((0,Mt.Z)(it)){constructor(t){if(super(t),this._cimMarkerLayer=t,(0,x.mf)(t.color)){const e=(e,i,s)=>(0,y.t2)(t.color(e,i,s));this._dynamicPropertyMap.set("_fillColor",e)}else this._fillColor=(0,y.t2)(t.color);if((0,x.mf)(t.outlineColor)){const e=(e,i,s)=>(0,y.t2)(t.outlineColor(e,i,s));this._dynamicPropertyMap.set("_outlineColor",e)}else this._outlineColor=(0,y.t2)(t.outlineColor);if((0,x.mf)(t.size)){const e=(e,i,s)=>(0,u.F2)(t.size(e,i,s));this._dynamicPropertyMap.set("_size",e)}else this._size=(0,u.F2)(t.size);if((0,x.mf)(t.scaleX)?this._dynamicPropertyMap.set("_scaleX",t.scaleX):this._scaleX=t.scaleX,(0,x.mf)(t.offsetX)){const e=(e,i,s)=>(0,u.F2)(t.offsetX(e,i,s));this._dynamicPropertyMap.set("xOffset",e)}else this.xOffset=(0,u.F2)(t.offsetX);if((0,x.mf)(t.offsetY)){const e=(e,i,s)=>(0,u.F2)(t.offsetY(e,i,s));this._dynamicPropertyMap.set("yOffset",e)}else this.yOffset=(0,u.F2)(t.offsetY);if((0,x.mf)(t.outlineWidth)){const e=(e,i,s)=>(0,u.F2)(t.outlineWidth(e,i,s));this._dynamicPropertyMap.set("_outlineWidth",e)}else this._outlineWidth=(0,u.F2)(t.outlineWidth);(0,x.mf)(t.rotation)?this._dynamicPropertyMap.set("_angle",t.rotation):this._angle=t.rotation,this._scaleFactor=(0,_t.Pt)(t.scaleFactor,1),this._markerPlacement=t.markerPlacement,this.effects=t.effects,this._bitSet=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1|(t.scaleSymbolsProportionally?1:0)<<3,this._materialKey=t.materialKey}static fromCIMMarker(t){return new St(t)}bindFeature(t,e,i){const s=t.readLegacyFeature();this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)}));const n=this._cimMarkerLayer.materialHash,o="function"==typeof n?n(s,e,i):n,l=this._materialCache.get(o);if(!l||!(0,a.ok)(l.spriteMosaicItem)||!l.spriteMosaicItem)return void vt.error(new r.Z("mapview-cim","Encountered an error when binding feature"));const h=l.spriteMosaicItem,c=this._cimMarkerLayer.sizeRatio,f=h.width/h.height*this._scaleX,y=this._cimMarkerLayer.rotateClockwise?this._angle:-this._angle;let _=this._size,x=_*f;const g=this.xOffset,M=this.yOffset;this.xOffset*=this._scaleFactor,this.yOffset*=this._scaleFactor;const b=this._cimMarkerLayer.scaleSymbolsProportionally&&this._cimMarkerLayer.frameHeight?this._size/(0,u.F2)(this._cimMarkerLayer.frameHeight):1,w=this._outlineWidth*b,v=(0,u.F2)(this._cimMarkerLayer.referenceSize);let S=0,C=0;const L=this._cimMarkerLayer.anchorPoint;L&&(this._cimMarkerLayer.isAbsoluteAnchorPoint?this._size&&(S=-L.x/(this._size*f),C=L.y/this._size):(S=L.x,C=L.y)),this._sizeOutlineWidth=(0,d.Jz)(Math.round(Math.min(Math.sqrt(128*x),255)),Math.round(Math.min(Math.sqrt(128*_),255)),Math.round(Math.min(Math.sqrt(128*w),255)),Math.round(Math.min(Math.sqrt(128*v),255))),this.angle=y;const P=Math.round(Math.min(64*c,255));this._bitestAndDistRatio=(0,d.Jz)(0,0,this._bitSet,P);const z=h.rect.x+m.fL,k=h.rect.y+m.fL,O=z+h.width,I=k+h.height;this._texUpperLeft=(0,d.UJ)(z,k),this._texUpperRight=(0,d.UJ)(O,k),this._texBottomLeft=(0,d.UJ)(z,I),this._texBottomRight=(0,d.UJ)(O,I);const T=p.mE.load(this._materialKey);T.sdf=h.sdf,T.pattern=!0,T.textureBinding=h.textureBinding,this._materialKey=T.data,this._anchorX=.5-(.5+S)*h.width/h.width,this._anchorY=.5-(.5+C)*h.height/h.height,x*=c,_*=c,x*=this._scaleFactor,_*=this._scaleFactor,x*=h.rect.width/h.width,_*=h.rect.height/h.height,this._computedWidth=x,this._computedHeight=_,this._applyTransformation(wt,bt),this.xOffset=g,this.yOffset=M}}const Ct=St;var Lt=i(44840),Pt=i(32651),zt=i(34635);class kt extends((0,zt.Z)(it)){constructor(t){super(t),this._horizontalAlignment="center",this._verticalAlignment="middle",this._textToGlyphs=new Map;const e=t.scaleFactor||1;if(this._cimTextLayer=t,(0,x.mf)(t.color)){const e=(e,i,s)=>(0,y.t2)(t.color(e,i,s));this._dynamicPropertyMap.set("_color",e)}else this._color=(0,y.t2)(t.color);if((0,x.mf)(t.color)){const e=(e,i,s)=>(0,y.t2)(t.outlineColor(e,i,s));this._dynamicPropertyMap.set("_haloColor",e)}else this._haloColor=(0,y.t2)(t.outlineColor);let i,s,r;if((0,x.mf)(t.size)||(i=Math.min(Math.round((0,u.F2)(t.size*t.sizeRatio)),127)),this._dynamicPropertyMap.set("_size",((e,s,r)=>(0,x.mf)(t.size)?Math.min(Math.round((0,u.F2)(t.size(e,s,r)*t.sizeRatio)),127):i)),(0,x.mf)(t.outlineSize)){const e=(e,i,s)=>Math.min(Math.floor(5*(0,u.F2)(t.outlineSize(e,i,s)*t.sizeRatio)),127);this._dynamicPropertyMap.set("_haloSize",e)}else this._haloSize=Math.min(Math.floor(5*(0,u.F2)(t.outlineSize*t.sizeRatio)),127);(0,x.mf)(t.offsetX)||(s=Math.round((0,u.F2)(t.offsetX*t.sizeRatio))),this._dynamicPropertyMap.set("_xOffset",((e,i,r)=>(0,x.mf)(t.offsetX)?Math.round((0,u.F2)(t.offsetX(e,i,r)*t.sizeRatio)):s)),(0,x.mf)(t.offsetY)||(r=Math.round((0,u.F2)(t.offsetY*t.sizeRatio))),this._dynamicPropertyMap.set("_yOffset",((e,i,s)=>(0,x.mf)(t.offsetY)?Math.round((0,u.F2)(t.offsetY(e,i,s)*t.sizeRatio)):r)),(0,x.mf)(t.angle)?this._dynamicPropertyMap.set("_angle",t.angle):this._angle=t.angle,(0,x.mf)(t.horizontalAlignment)?this._dynamicPropertyMap.set("_horizontalAlignment",t.horizontalAlignment):this._horizontalAlignment=t.horizontalAlignment,(0,x.mf)(t.verticalAlignment)?this._dynamicPropertyMap.set("_verticalAlignment",t.verticalAlignment):this._verticalAlignment=t.verticalAlignment,this._scaleFactor=e,(0,x.mf)(t.text)?this._dynamicPropertyMap.set("_text",t.text):this._text=t.text;const n=Math.min(Math.round((0,u.F2)(t.referenceSize*t.sizeRatio)),127);this._referenceSize=Math.round(Math.sqrt(256*n)),this._materialKey=t.materialKey;const o=p.qr.load(this._materialKey);o.sdf=!0,this._bitset=(1===t.alignment?1:0)|(t.colorLocked?1:0)<<1,this._materialKey=o.data,this._decoration="none",this._lineHeight=1,this._lineWidth=512,this._textPlacement=t.markerPlacement,this.effects=t.effects,this._isCIM=!0}static fromCIMText(t){return new kt(t)}async analyze(t,e,i,s){const r=e.readLegacyFeature(),n=function(t,e,i,s){return"string"==typeof t.text?t.text:"function"==typeof t.text?t.text(e,i,s):""}(this._cimTextLayer,r,i,s),o=await t.getMosaicItem(this._cimTextLayer.cim,(0,Lt._)(n));return this._textToGlyphs.set(n,o.glyphMosaicItems),o}bindFeature(t,e,i){const s=t.readLegacyFeature();if(this._dynamicPropertyMap.forEach(((t,r)=>{this[r]=t(s,e,i)})),!this._text||0===this._text.length)return void(this._shapingInfo=null);this._size*=this._scaleFactor,this._scale=this._size/24,this._xOffset*=this._scaleFactor,this._yOffset*=this._scaleFactor,this._xAlignD=(0,Pt.kH)(this._horizontalAlignment||"center"),this._yAlignD=(0,Pt.b7)(this._verticalAlignment||"baseline");const r=this._textToGlyphs.get(this._text);this.bindTextInfo(r,!1)}}const Ot=kt;class It extends($(tt.Z)){constructor(t,e,i,s,r,n,o,a,l){super(),this.effects=l;const h=p.dk.load(t);e&&(h.sdf=e.sdf,h.pattern=!0,h.textureBinding=e.textureBinding),this.fillColor=i,this.tl=s,this.br=r,this.aux1=n,this.aux2=o,this.aux3=a,this._materialKey=h.data}static fromCIMFill(t,e){const i=t.color,s=i&&(0,y.t2)(i)||0,r=t.materialKey;if(!e){const e=(0,d.Jz)(0,0,0,t.colorLocked?1:0);return new It(r,null,s,0,0,0,0,e,t.effects)}const{rect:n,width:o,height:a}=e,l=n.x+m.fL,h=n.y+m.fL,c=l+o,p=h+a;let x=(0,f.Sf)((0,u.F2)(t.height||0));x>255?x=255:x<=0&&(x=(0,f.Sf)(p-h));let g=(0,f.Sf)((0,u.F2)(t.height/a*o||0));g>255?g=255:g<=0&&(g=(0,f.Sf)(c-l));let M=(0,u.F2)(t.offsetX||0)+128;M>255&&(M=255);let b=(0,u.F2)(-t.offsetY||0)+128;b>255&&(b=255);const w=t.scaleX||1,v=(0,d.UJ)(l,h),S=(0,d.UJ)(c,p),C=(0,d.Jz)(g,x,M,b),L=(0,d.UJ)(128*w,128),P=(0,d.Jz)(0,0,(0,_.s5)(t.angle),t.colorLocked?1:0);return new It(r,e,s,v,S,C,L,P,t.effects)}static fromSimpleFill(t,e,i=!1){const{color:s}=t,r=s&&"esriSFSNull"!==t.style&&(0,y.aH)(s)||0,n=(0,d.Jz)(0,0,0,i?255:0),o=t.materialKey;if(!e)return new It(o,null,r,0,0,0,0,n,null);const{rect:a,width:l,height:h}=e,c=a.x+m.fL,u=a.y+m.fL,p=c+l,_=u+h,x=(0,d.UJ)(c,u),g=(0,d.UJ)(p,_),M=(0,d.Jz)((0,f.Sf)(p-c),(0,f.Sf)(_-u),0,0),b=(0,d.UJ)(128,128);return new It(o,e,r,x,g,M,b,n,null)}static fromPictureFill(t,e,i=!1){const s=m.ru,{rect:r,width:n,height:o}=e,a=r.x+m.fL,l=r.y+m.fL,h=a+n,c=l+o,p=(0,d.UJ)(a,l),y=(0,d.UJ)(h,c);let _=(0,f.Sf)((0,u.F2)(t.width));_>255&&(_=255);let x=(0,f.Sf)((0,u.F2)(t.height));x>255&&(x=255);let g=(0,u.F2)(t.xoffset)+128;g>255&&(g=255);let M=(0,u.F2)(-t.yoffset)+128;M>255&&(M=255);const b=(0,d.Jz)(_,x,g,M),w=(0,d.UJ)(128*t.xscale,128*t.yscale),v=(0,d.Jz)(0,0,0,i?255:0),S=t.materialKey;return new It(S,e,s,p,y,b,w,v,null)}}const Tt=It;var Ft=i(83302);const Dt=s.Z.getLogger("esri.views.2d.engine.webgl.WGLLineTemplate");class Rt extends(dt(tt.Z)){constructor(t,e,i,s,r,n,o,a,l,h,c,f,u,m,d,y){super();const _=p.a.load(t);e&&(_.sdf=e.sdf,_.pattern=!0,_.textureBinding=e.textureBinding),this._capType=s,this._joinType=r,this._miterLimitCosine=(0,x.NW)(n),this.tessellationProperties._fillColor=o,this.tessellationProperties._tl=a,this.tessellationProperties._br=l,this._hasPattern=h,this._isDashed=c,this._joinOnUTurn=d,this._isColorLocked=f,this._zOrder=m,this.effects=y,this._materialKey=_.data,this.tessellationProperties._bitset=f?1:0,this.tessellationProperties._halfWidth=.5*i,this.tessellationProperties._halfReferenceWidth=.5*u,this._initializeTessellator(!1)}static fromCIMLine(t,e,i){const s=t.color,r=t.scaleFactor||1,n=t.isDashed;let o=t.cap;n&&1===o&&(o=2);const a=t.join,l=(0,u.F2)(t.width)*r,h=(0,u.F2)(t.referenceWidth),c=(0,u.F2)(t.miterLimit),f=s&&(0,y.t2)(s)||0;if(!e)return new Rt(t.materialKey,e,l,o,a,c,f,0,0,!1,n,t.colorLocked,h,t.zOrder,i,t.effects);const{rect:p,width:_,height:x}=e,g=p.x+m.fL,M=p.y+m.fL,b=g+_,w=M+x,v=(0,d.UJ)(g,M),S=(0,d.UJ)(b,w);return new Rt(t.materialKey,e,l,o,a,c,f,v,S,!0,n,t.colorLocked,h,t.zOrder,i,t.effects)}static fromSimpleLine(t,e,i){const{color:s}=t,r="esriSLSSolid"!==t.style&&"esriSLSNull"!==t.style,n=(0,Ft.ws)(t.cap||"round",r),o=(0,Ft.xV)(t.join||"round");let a=s&&"esriSLSNull"!==t.style&&(0,y.aH)(s)||0;"esriSLSNull"===t.style&&(a=0);const l=(0,u.F2)(t.width),h=t.miterLimit;if(!e)return new Rt(t.materialKey,e,l,n,o,h,a,0,0,!1,r,!1,l,0,i,null);const{rect:c,width:f,height:p}=e,_=c.x+m.fL,x=c.y+m.fL,g=_+f,M=x+p,b=(0,d.UJ)(_,x),w=(0,d.UJ)(g,M);return new Rt(t.materialKey,e,l,n,o,h,a,b,w,!0,r,!1,l,0,i,null)}static fromPictureLineSymbol(t,e,i,s){return Dt.error("PictureLineSymbol support does not exist!"),null}}const Nt=Rt;const Zt=s.Z.getLogger("esri.views.2d.engine.webgl.mesh.templates.WGLTemplateStore"),At=new Array;function Bt(t,e){const i=t.length;return t.push(null),e.then((e=>t[i]=e)),t}function Vt(t){return!!(1&t)}class Jt{constructor(t,e){this._idCounter=1,this._templateIdCounter=1,this._idToTemplateGroup=new Map,this._symbolToTemplate=new Map,this._fetchQueue=[],this._idToResolver=new Map,this._cimTemplateCache=new Map,this._cimAnalyses=[],this._lock=new class{constructor(){this._resolver=null}isHeld(){return!!this._resolver}acquire(){return this._resolver?this._resolver.promise.then((()=>this.acquire())):(this._resolver=(0,n.createResolver)(),(0,n.resolve)())}release(){const t=this._resolver;this._resolver=null,t.resolve()}},this._fetchResource=t,this._joinOnUTurn=e}get _markerError(){return this._errorTemplates.marker[0]}get _fillError(){return this._errorTemplates.fill[0]}get _lineError(){return this._errorTemplates.line[0]}get _textError(){return this._errorTemplates.line[0]}createTemplateGroup(t,e){this._initErrorTemplates();const i=t.hash;if(this._symbolToTemplate.has(i))return this._symbolToTemplate.get(i);const s=new Array;e&&this._createMeshTemplates(s,e,!0),this._createMeshTemplates(s,t,!1);const r=this._createGroupId("expanded-cim"===t.type);return this._idToTemplateGroup.set(r,s),this._symbolToTemplate.set(i,r),r}getTemplateGroup(t){return this._idToTemplateGroup.has(t)?this._idToTemplateGroup.get(t):At}getDynamicTemplateGroup(t){return this._idToTemplateGroup.has(t)?(Vt(t)||Zt.error("mapview-template-store",`Id ${t} does not refer to a dynamic template`),this._idToTemplateGroup.get(t)):At}getMosaicItem(t,e){const i=this._createTemplateId(),s=(0,n.create)((t=>this._idToResolver.set(i,t)));return this._fetchQueue.push({symbol:t,id:i,glyphIds:e}),s}finalize(t){return this._fetchQueue.length||this._lock.isHeld()?function(t,e,i){return t.acquire().then((()=>e(i))).then((()=>t.release())).catch((e=>{throw t.release(),e}))}(this._lock,this._fetchAllQueuedResources.bind(this),t):(0,n.resolve)()}_initErrorTemplates(){this._errorTemplates||(this._errorTemplates={fill:this._createMeshTemplates([],(0,l.PY)(o.kD),!1),marker:this._createMeshTemplates([],(0,l.PY)(o.G),!1),line:this._createMeshTemplates([],(0,l.PY)(o.mW),!1)})}_fetchAllQueuedResources(t){if(!this._fetchQueue.length)return(0,n.resolve)();const e=this._fetchQueue,i=this._cimAnalyses;return this._fetchQueue=[],this._cimAnalyses=[],(0,n.all)(i).then((()=>this._fetchResource(e,t).then((t=>{for(const{id:e,mosaicItem:i}of t)this._idToResolver.get(e)(i),this._idToResolver.delete(e)})))).catch((t=>{(0,n.isAbortError)(t)?this._fetchQueue=this._fetchQueue.concat(e):function(t){return"worker:port-closed"===t.name}(t)||Zt.error(new r.Z("mapview-template-store","Unable to fetch requested texture resources",t))}))}_createGroupId(t){return this._idCounter++<<1|(t?1:0)}_createTemplateId(){return this._templateIdCounter++}async _createSMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return(0,a.ok)(e,Zt)?c.Z.fromSimpleMarker(t,e):this._markerError}async _createPMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return(0,a.ok)(e,Zt)?c.Z.fromPictureMarker(t,e):this._markerError}async _createSFS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return(0,a.ok)(i,Zt)?Tt.fromSimpleFill(t,i,e):this._fillError}async _createPFS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return(0,a.ok)(i,Zt)?Tt.fromPictureFill(t,i,e):this._fillError}async _createSLS(t,e){const{spriteMosaicItem:i}=await this.getMosaicItem(t);return(0,a.ok)(i,Zt)?Nt.fromSimpleLine(t,i,this._joinOnUTurn):this._lineError}async _createLMS(t){const{spriteMosaicItem:e}=await this.getMosaicItem(t);return(0,a.ok)(e,Zt)?c.Z.fromLineSymbolMarker(t,e):this._markerError}async _createTS(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t);return h.Z.fromText(t,e)}async _createCIMText(t){const{glyphMosaicItems:e}=await this.getMosaicItem(t.cim,(0,Lt._)(t.text));return t.cim.mosaicHash=t.materialHash,(0,a.ok)(e,Zt)?h.Z.fromCIMText(t,e):this._textError}async _createCIMFill(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return(0,a.ok)(e,Zt)?Tt.fromCIMFill(t,e):this._fillError}async _createCIMLine(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return(0,a.ok)(e,Zt)?Nt.fromCIMLine(t,e,this._joinOnUTurn):this._lineError}async _createCIMMarker(t){t.cim.mosaicHash=t.materialHash;const{spriteMosaicItem:e}=await this.getMosaicItem(t.cim);return(0,a.ok)(e,Zt)?c.Z.fromCIMMarker(t,e):this._markerError}async _createCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let i;switch(t.type){case"marker":i=this._createCIMMarker(t);break;case"line":i=this._createCIMLine(t);break;case"fill":i=this._createCIMFill(t);break;case"text":i=this._createCIMText(t)}return i.then((t=>this._cimTemplateCache.set(e,t))),i}_createDynamicCIM(t){const e=t.templateHash;if(this._cimTemplateCache.has(e))return this._cimTemplateCache.get(e);let i;switch(t.type){case"marker":i=Ct.fromCIMMarker(t);break;case"line":i=yt.fromCIMLine(t);break;case"fill":i=rt.fromCIMFill(t);break;case"text":i=Ot.fromCIMText(t)}return this._cimTemplateCache.set(e,i),i}_createPrimitiveMeshTemplates(t,e,i){switch(e.type){case"esriSMS":return Bt(t,this._createSMS(e));case"esriPMS":return Bt(t,this._createPMS(e));case"esriSFS":return Bt(t,this._createSFS(e,i));case"line-marker":return Bt(t,this._createLMS(e));case"esriPFS":return Bt(t,this._createPFS(e,i));case"esriSLS":return Bt(t,this._createSLS(e,!1));case"esriTS":return Bt(t,this._createTS(e));default:return Zt.error("Unable to create mesh template for unknown symbol type {: $ }{symbol.type}"),t}}_createMeshTemplates(t,e,i){if(-1!==e.type.indexOf("3d"))return Zt.error("3D symbols are not supported with MapView"),t;if("expanded-cim"===e.type){for(const i of e.layers)"function"==typeof i.materialHash?t.push(this._createDynamicCIM(i)):Bt(t,this._createCIM(i));return t}if("composite-symbol"===e.type){for(const s of e.layers)this._createPrimitiveMeshTemplates(t,s,i);return t}return"cim"===e.type||"label"===e.type||"web-style"===e.type?t:this._createPrimitiveMeshTemplates(t,e,i)}}},37521:(t,e,i)=>{"use strict";i.d(e,{Z:()=>f});var s=i(96071),r=i(32651),n=i(84767),o=i(9709),a=i(51482),l=i(34635),h=i(60733);class c extends((0,l.Z)(h.Z)){constructor(t,e,i,n,a,l,h,c,f,u,m,d,p,y,_,x,g,M=!1){super(),this._xOffset=(0,s.F2)(d),this._yOffset=(0,s.F2)(p),this._decoration=f||"none",this._color=n,this._haloColor=a,this._haloSize=Math.min(Math.floor(5*(0,s.F2)((0,s.t_)(i))),127),this._size=Math.min(Math.round((0,s.F2)(e)),127);const b=Math.min(Math.round((0,s.F2)(e)),127);this._referenceSize=Math.round(Math.sqrt(256*b)),this._scale=this._size/24,this._angle=m,this._justify=(0,r.Hd)(l||"center"),this._xAlignD=(0,r.kH)(l||"center"),this._yAlignD=(0,r.b7)(h||"baseline"),this._baseline="baseline"===(h||"baseline"),this._bitset=(1===c?1:0)|(u?1:0)<<1;const w=o.m2.load(t);w.sdf=!0,this._materialKey=w.data,this._lineWidth=(0,s.F2)(y)||512,this._lineHeight=_||1,this._textPlacement=x,this.effects=g,this._isCIM=M}static fromText(t,e){const i=new c(t.materialKey,t.font.size,t.haloSize||0,t.color&&(0,a.aH)(t.color)||0,t.haloColor&&(0,a.aH)(t.haloColor)||0,t.horizontalAlignment,t.verticalAlignment,0,t.font.decoration,!1,t.angle||0,t.xoffset,t.yoffset,t.lineWidth,t.lineHeight,null,null,!1),[,s]=(0,n.E)(t.text);return i.bindTextInfo(e,s),i}static fromCIMText(t,e){const i=t.scaleFactor||1,s=new c(t.materialKey,t.size*t.sizeRatio*i,t.outlineSize*t.sizeRatio,(0,a.t2)(t.color),(0,a.t2)(t.outlineColor),t.horizontalAlignment,t.verticalAlignment,t.alignment,t.decoration,t.colorLocked,t.angle,t.offsetX*t.sizeRatio*i,t.offsetY*t.sizeRatio*i,512,1,t.markerPlacement,t.effects,!0),[,r]=(0,n.E)(t.text);return s.bindTextInfo(e,r),s}}const f=c},32307:(t,e,i)=>{"use strict";i.d(e,{ok:()=>r});var s=i(32656);function r(t,e){if(t&&"name"in t){const i=t;return e&&e.error(new s.Z(i.name,i.message,i.details)),!1}return!0}},7637:(t,e,i)=>{"use strict";i.d(e,{Z:()=>s});const s=class{constructor(t,e){this._pos=0;const i=e?this._roundToNearest(e,t.BYTES_PER_ELEMENT):40;this._array=new ArrayBuffer(i),this._buffer=new t(this._array),this._ctor=t}get length(){return this._pos}_roundToNearest(t,e){const i=Math.round(t);return i+(e-i%e)}_ensureSize(t){if(this._pos+t>=this._buffer.length){const e=this._roundToNearest(1.5*(this._array.byteLength+t*this._buffer.BYTES_PER_ELEMENT),this._buffer.BYTES_PER_ELEMENT),i=new ArrayBuffer(e),s=new this._ctor(i);s.set(this._buffer,0),this._array=i,this._buffer=s}}writeF32(t){this._ensureSize(1);const e=this._pos;return new Float32Array(this._array,4*this._pos,1)[0]=t,this._pos++,e}push(t){this._ensureSize(1);const e=this._pos;return this._buffer[this._pos++]=t,e}writeFixed(t){this._buffer[this._pos++]=t}setValue(t,e){this._buffer[t]=e}getValue(t){return this._buffer[t]}incr(t){this._buffer[t]++}decr(t){this._buffer[t]--}writeRegion(t){this._ensureSize(t.length);const e=this._pos;return this._buffer.set(t,this._pos),this._pos+=t.length,e}buffer(){const t=this._array.slice(0,4*this._pos);return this.destroy(),t}toArray(){const t=this._array,e=[];for(let i=0;i<t.byteLength/4;i++)e.push(t[i]);return e}seek(t){this._pos=t}destroy(){this._array=null,this._buffer=null}}},78787:(t,e,i)=>{"use strict";function s(t,e){if(null!==e){t.push(e.length);for(const i of e)i.serialize(t);return t}t.push(0)}function r(t,e,i){const s=t.readInt32(),r=new Array(s);for(let s=0;s<r.length;s++)r[s]=e.deserialize(t,i);return r}i.d(e,{h:()=>r,G:()=>s})},44840:(t,e,i)=>{"use strict";function s(t){const e=new Array(t.length);for(let i=0;i<t.length;i++)e[i]=t.charCodeAt(i);return e}i.d(e,{_:()=>s})}}]);
//# sourceMappingURL=8525.js.map